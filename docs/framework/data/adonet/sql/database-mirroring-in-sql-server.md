---
title: SQL Server’da Veritabanı Yansıtması
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: 89befaff-bb46-4290-8382-e67cdb0e3de9
ms.openlocfilehash: bdcdce58d78a305493bd698cf4d849e640f14ce0
ms.sourcegitcommit: 5b6d778ebb269ee6684fb57ad69a8c28b06235b9
ms.translationtype: HT
ms.contentlocale: tr-TR
ms.lasthandoff: 04/08/2019
ms.locfileid: "59230999"
---
# <a name="database-mirroring-in-sql-server"></a><span data-ttu-id="a90d4-102">SQL Server’da Veritabanı Yansıtması</span><span class="sxs-lookup"><span data-stu-id="a90d4-102">Database Mirroring in SQL Server</span></span>
<span data-ttu-id="a90d4-103">SQL Server veritabanı yansıtma, bir kopya veya yansıtma, bir yedek sunucu üzerinde bir SQL Server veritabanının tutmanızı sağlar.</span><span class="sxs-lookup"><span data-stu-id="a90d4-103">Database mirroring in SQL Server allows you to keep a copy, or mirror, of a SQL Server database on a standby server.</span></span> <span data-ttu-id="a90d4-104">Yansıtma, verilerin iki ayrı kopyasını süreleri ve yüksek düzeyde kullanılabilirlik sağladığınızdan hiç var ve veri yedekliği tamamlamak sağlar.</span><span class="sxs-lookup"><span data-stu-id="a90d4-104">Mirroring ensures that two separate copies of the data exist at all times, providing high availability and complete data redundancy.</span></span> <span data-ttu-id="a90d4-105">Geliştirici herhangi bir eylemde bulunmanız veya bir SQL Server veritabanı için yapılandırıldıktan sonra kod yazmaya gerek yoktur, böylece SQL Server için .NET veri sağlayıcısı, veritabanı yansıtması için örtük desteği sağlar.</span><span class="sxs-lookup"><span data-stu-id="a90d4-105">The .NET Data Provider for SQL Server provides implicit support for database mirroring, so that the developer does not need to take any action or write any code once it has been configured for a SQL Server database.</span></span> <span data-ttu-id="a90d4-106">Ayrıca, <xref:System.Data.SqlClient.SqlConnection> nesne destekleyen bir yük devretme iş ortağı sunucu adını sağlayan sağlayan bir açık bir bağlantı modu <xref:System.Data.SqlClient.SqlConnection.ConnectionString%2A>.</span><span class="sxs-lookup"><span data-stu-id="a90d4-106">In addition, the <xref:System.Data.SqlClient.SqlConnection> object supports an explicit connection mode that allows supplying the name of a failover partner server in the <xref:System.Data.SqlClient.SqlConnection.ConnectionString%2A>.</span></span>  
  
 <span data-ttu-id="a90d4-107">İçin Basitleştirilmiş aşağıdaki olaylar dizisi gerçekleşir bir <xref:System.Data.SqlClient.SqlConnection> yansıtma için yapılandırılmış bir veritabanını hedefler nesnesi:</span><span class="sxs-lookup"><span data-stu-id="a90d4-107">The following simplified sequence of events occurs for a <xref:System.Data.SqlClient.SqlConnection> object that targets a database configured for mirroring:</span></span>  
  
1.  <span data-ttu-id="a90d4-108">İstemci uygulaması başarıyla asıl veritabanına bağlanır ve sunucunun daha istemcide önbelleğe ortak sunucu adını geri gönderir.</span><span class="sxs-lookup"><span data-stu-id="a90d4-108">The client application successfully connects to the principal database, and the server sends back the name of the partner server, which is then cached on the client.</span></span>  
  
2.  <span data-ttu-id="a90d4-109">Asıl veritabanı içeren bir sunucu başarısız olursa veya bağlantı kesildi, bağlantı ve işlem durumu kaybolur.</span><span class="sxs-lookup"><span data-stu-id="a90d4-109">If the server containing the principal database fails or connectivity is interrupted, connection and transaction state is lost.</span></span> <span data-ttu-id="a90d4-110">İstemci uygulama, asıl veritabanına bir bağlantı kurmayı yeniden dener ve başarısız olur.</span><span class="sxs-lookup"><span data-stu-id="a90d4-110">The client application attempts to re-establish a connection to the principal database and fails.</span></span>  
  
3.  <span data-ttu-id="a90d4-111">İstemci uygulama, iş ortağı sunucusunda yansıtma veritabanına bir bağlantı kurmak şeffaf bir şekilde çalışır.</span><span class="sxs-lookup"><span data-stu-id="a90d4-111">The client application then transparently attempts to establish a connection to the mirror database on the partner server.</span></span> <span data-ttu-id="a90d4-112">Başarılı olursa, ardından yeni asıl veritabanı haline gelir yansıtma veritabanına bağlantı yönlendirilir.</span><span class="sxs-lookup"><span data-stu-id="a90d4-112">If it succeeds, the connection is redirected to the mirror database, which then becomes the new principal database.</span></span>  
  
## <a name="specifying-the-failover-partner-in-the-connection-string"></a><span data-ttu-id="a90d4-113">Yük devretme ortağı bağlantı dizesindeki belirtme</span><span class="sxs-lookup"><span data-stu-id="a90d4-113">Specifying the Failover Partner in the Connection String</span></span>  
 <span data-ttu-id="a90d4-114">Bağlantı dizesindeki bir yük devretme iş ortağı sunucu adı sağlarsanız, istemci uygulaması ilk kez bağlandığında asıl veritabanı kullanılamıyorsa istemci saydam yük devretme iş ortağı ile bağlantı dener.</span><span class="sxs-lookup"><span data-stu-id="a90d4-114">If you supply the name of a failover partner server in the connection string, the client will transparently attempt a connection with the failover partner if the principal database is unavailable when the client application first connects.</span></span>  
  
```  
";Failover Partner=PartnerServerName"  
```  
  
 <span data-ttu-id="a90d4-115">Yük devretme iş ortağı sunucunun adını çıkarın ve asıl veritabanı yoksa istemci uygulaması ilk bağlandığında sonra bir <xref:System.Data.SqlClient.SqlException> tetiklenir.</span><span class="sxs-lookup"><span data-stu-id="a90d4-115">If you omit the name of the failover partner server and the principal database is unavailable when the client application first connects then a <xref:System.Data.SqlClient.SqlException> is raised.</span></span>  
  
 <span data-ttu-id="a90d4-116">Olduğunda bir <xref:System.Data.SqlClient.SqlConnection> başarıyla açıldı, yük devretme iş ortağı adı sunucu tarafından döndürülür ve bağlantı dizesinde sağlanan herhangi bir değer yerine geçer.</span><span class="sxs-lookup"><span data-stu-id="a90d4-116">When a <xref:System.Data.SqlClient.SqlConnection> is successfully opened, the failover partner name is returned by the server and supersedes any values supplied in the connection string.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="a90d4-117">Veritabanı yansıtma senaryoları için bağlantı dizesindeki ilk kataloğun veya veritabanının adı açıkça belirtmeniz gerekir.</span><span class="sxs-lookup"><span data-stu-id="a90d4-117">You must explicitly specify the initial catalog or database name in the connection string for database mirroring scenarios.</span></span> <span data-ttu-id="a90d4-118">İstemci bir açıkça belirtilen ilk kataloğun veya veritabanının sahip olmayan bir bağlantı üzerinde yük devretme bilgileri alırsa, yük devretme bilgileri önbelleğe alınmaz ve uygulama birincil sunucu başarısız olursa, yük devretme çalışmaz.</span><span class="sxs-lookup"><span data-stu-id="a90d4-118">If the client receives failover information on a connection that doesn't have an explicitly specified initial catalog or database, the failover information is not cached and the application does not attempt to fail over if the principal server fails.</span></span> <span data-ttu-id="a90d4-119">Bir bağlantı dizesi, yük devretme iş ortağı, ancak ilk katalog veya veritabanı için bir değer için bir değer varsa bir `InvalidArgumentException` tetiklenir.</span><span class="sxs-lookup"><span data-stu-id="a90d4-119">If a connection string has a value for the failover partner, but no value for the initial catalog or database, an `InvalidArgumentException` is raised.</span></span>  
  
## <a name="retrieving-the-current-server-name"></a><span data-ttu-id="a90d4-120">Geçerli sunucu adını alma</span><span class="sxs-lookup"><span data-stu-id="a90d4-120">Retrieving the Current Server Name</span></span>  
 <span data-ttu-id="a90d4-121">Bir yük devretme durumunda, geçerli bağlantının gerçekten bağlı kullanarak sunucu adını alabilirsiniz <xref:System.Data.SqlClient.SqlConnection.DataSource%2A> özelliği bir <xref:System.Data.SqlClient.SqlConnection> nesne.</span><span class="sxs-lookup"><span data-stu-id="a90d4-121">In the event of a failover, you can retrieve the name of the server to which the current connection is actually connected by using the <xref:System.Data.SqlClient.SqlConnection.DataSource%2A> property of a <xref:System.Data.SqlClient.SqlConnection> object.</span></span> <span data-ttu-id="a90d4-122">Aşağıdaki kod parçası, bağlantı değişkeni açık başvuran varsayılarak etkin sunucunun adını alır. <xref:System.Data.SqlClient.SqlConnection>.</span><span class="sxs-lookup"><span data-stu-id="a90d4-122">The following code fragment retrieves the name of the active server, assuming that the connection variable references an open <xref:System.Data.SqlClient.SqlConnection>.</span></span>  
  
 <span data-ttu-id="a90d4-123">Bir yük devretme gerçekleştiğinde ve yansıtma sunucusu için bağlantı anahtarlanır **DataSource** özelliği yansıtma adını yansıtacak şekilde güncelleştirilir.</span><span class="sxs-lookup"><span data-stu-id="a90d4-123">When a failover event occurs and the connection is switched to the mirror server, the **DataSource** property is updated to reflect the mirror name.</span></span>  
  
```vb  
Dim activeServer As String = connection.DataSource  
```  
  
```csharp  
string activeServer = connection.DataSource;  
```  
  
## <a name="sqlclient-mirroring-behavior"></a><span data-ttu-id="a90d4-124">SqlClient yansıtmayı davranışı</span><span class="sxs-lookup"><span data-stu-id="a90d4-124">SqlClient Mirroring Behavior</span></span>  
 <span data-ttu-id="a90d4-125">İstemci, geçerli bir asıl sunucuya bağlanmak her zaman çalışır.</span><span class="sxs-lookup"><span data-stu-id="a90d4-125">The client always tries to connect to the current principal server.</span></span> <span data-ttu-id="a90d4-126">Başarısız olursa, yük devretme iş ortağı çalışır.</span><span class="sxs-lookup"><span data-stu-id="a90d4-126">If it fails, it tries the failover partner.</span></span> <span data-ttu-id="a90d4-127">Yansıtma veritabanının asıl ortak sunucu rolüne zaten geçirildi, bağlantı başarılı olur ve yeni bir yansıtma asıl eşlemesi istemciye gönderilen ve arama ömrü boyunca önbelleğe <xref:System.AppDomain>.</span><span class="sxs-lookup"><span data-stu-id="a90d4-127">If the mirror database has already been switched to the principal role on the partner server, the connection succeeds and the new principal-mirror mapping is sent to the client and cached for the lifetime of the calling <xref:System.AppDomain>.</span></span> <span data-ttu-id="a90d4-128">Kalıcı depolama alanında depolanır ve farklı bir sonraki bağlantılar için kullanılabilir değil **AppDomain** veya işlemi.</span><span class="sxs-lookup"><span data-stu-id="a90d4-128">It is not stored in persistent storage and is not available for subsequent connections in a different **AppDomain** or process.</span></span> <span data-ttu-id="a90d4-129">Ancak aynı sonraki bağlantılar için **AppDomain**.</span><span class="sxs-lookup"><span data-stu-id="a90d4-129">However, it is available for subsequent connections within the same **AppDomain**.</span></span> <span data-ttu-id="a90d4-130">Not, başka bir **AppDomain** veya kendi havuzundaki bağlantıların her zaman aynı veya farklı bir bilgisayarda çalışan işlemi vardır ve bu bağlantılar sıfırlanmadı.</span><span class="sxs-lookup"><span data-stu-id="a90d4-130">Note that another **AppDomain** or process running on the same or a different computer always has its pool of connections, and those connections are not reset.</span></span> <span data-ttu-id="a90d4-131">Her durumda, birincil veritabanı kalırsa, işlem veya **AppDomain** kez başarısız olur ve havuzu otomatik olarak temizlenir.</span><span class="sxs-lookup"><span data-stu-id="a90d4-131">In that case, if the primary database goes down, each process or **AppDomain** fails once, and the pool is automatically cleared.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="a90d4-132">Destek sunucuda yansıtma veritabanı başına temelinde yapılandırılır.</span><span class="sxs-lookup"><span data-stu-id="a90d4-132">Mirroring support on the server is configured on a per-database basis.</span></span> <span data-ttu-id="a90d4-133">Bu, başka bir veritabanına değişiklikleri hatası durumunda yayılmaz, veri işleme işlemleri çok bölümlü adlarını kullanarak ya da geçerli veritabanı değiştirerek sorumlusu/yansıtma kümesinde yer almayan diğer veritabanlarına karşı yürütülür.</span><span class="sxs-lookup"><span data-stu-id="a90d4-133">If data manipulation operations are executed against other databases not included in the principal/mirror set, either by using multipart names or by changing the current database, the changes to these other databases do not propagate in the event of failure.</span></span> <span data-ttu-id="a90d4-134">Veri yok yansıtılmış bir veritabanında değiştirildiğinde bir hata oluşturulmaz.</span><span class="sxs-lookup"><span data-stu-id="a90d4-134">No error is generated when data is modified in a database that is not mirrored.</span></span> <span data-ttu-id="a90d4-135">Geliştirici, bu işlemler olası etkisini değerlendirmeniz gerekir.</span><span class="sxs-lookup"><span data-stu-id="a90d4-135">The developer must evaluate the possible impact of such operations.</span></span>  
  
## <a name="database-mirroring-resources"></a><span data-ttu-id="a90d4-136">Veritabanı yansıtma kaynakları</span><span class="sxs-lookup"><span data-stu-id="a90d4-136">Database Mirroring Resources</span></span>  
 <span data-ttu-id="a90d4-137">Kavramsal belgeler ve yapılandırma hakkında bilgi için dağıtma ve yönetme yansıtma, SQL Server belgelerinde aşağıdaki kaynaklara bakın.</span><span class="sxs-lookup"><span data-stu-id="a90d4-137">For conceptual documentation and information on configuring, deploying and administering mirroring, see the following resources in SQL Server documentation.</span></span>  
  
|<span data-ttu-id="a90d4-138">Kaynak</span><span class="sxs-lookup"><span data-stu-id="a90d4-138">Resource</span></span>|<span data-ttu-id="a90d4-139">Açıklama</span><span class="sxs-lookup"><span data-stu-id="a90d4-139">Description</span></span>|  
|--------------|-----------------|  
|[<span data-ttu-id="a90d4-140">Veritabanı yansıtma</span><span class="sxs-lookup"><span data-stu-id="a90d4-140">Database Mirroring</span></span>](/sql/database-engine/database-mirroring/database-mirroring-sql-server)|<span data-ttu-id="a90d4-141">Ayarlama ve SQL Server yansıtma yapılandırma açıklar.</span><span class="sxs-lookup"><span data-stu-id="a90d4-141">Describes how to set up and configure mirroring in SQL Server.</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="a90d4-142">Ayrıca bkz.</span><span class="sxs-lookup"><span data-stu-id="a90d4-142">See also</span></span>

- [<span data-ttu-id="a90d4-143">ADO.NET yönetilen sağlayıcıları ve DataSet Geliştirici Merkezi</span><span class="sxs-lookup"><span data-stu-id="a90d4-143">ADO.NET Managed Providers and DataSet Developer Center</span></span>](https://go.microsoft.com/fwlink/?LinkId=217917)
