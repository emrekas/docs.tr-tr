---
title: İşlem ve Toplu Kopyalama İşlemleri
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: f6f0cbc9-f7bf-4d6e-875f-ad1ba0b4aa62
ms.openlocfilehash: f30974e020545a69ad20c03bc05ac6a28f289b01
ms.sourcegitcommit: 0be8a279af6d8a43e03141e349d3efd5d35f8767
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 04/18/2019
ms.locfileid: "59074631"
---
# <a name="transaction-and-bulk-copy-operations"></a><span data-ttu-id="7f35e-102">İşlem ve Toplu Kopyalama İşlemleri</span><span class="sxs-lookup"><span data-stu-id="7f35e-102">Transaction and Bulk Copy Operations</span></span>
<span data-ttu-id="7f35e-103">Toplu kopyalama işlemleri birden çok adım işlemlerinin bir parçası olarak veya yalıtılmış işlemleri gerçekleştirilebilir.</span><span class="sxs-lookup"><span data-stu-id="7f35e-103">Bulk copy operations can be performed as isolated operations or as part of a multiple step transaction.</span></span> <span data-ttu-id="7f35e-104">Bu ikinci seçeneği yanı sıra aynı işlem içinde birden fazla toplu kopyalama işlemini gerçekleştirmek hala işleme ya da işlemin tümü geri olmanın yanı sıra (örneğin, ekleme, güncelleştirme ve silme) diğer veritabanı işlemlerini gerçekleştirmek sağlar.</span><span class="sxs-lookup"><span data-stu-id="7f35e-104">This latter option enables you to perform more than one bulk copy operation within the same transaction, as well as perform other database operations (such as inserts, updates, and deletes) while still being able to commit or roll back the entire transaction.</span></span>  
  
 <span data-ttu-id="7f35e-105">Varsayılan olarak, toplu kopyalama işlemi, yalıtılmış bir işlem olarak gerçekleştirilir.</span><span class="sxs-lookup"><span data-stu-id="7f35e-105">By default, a bulk copy operation is performed as an isolated operation.</span></span> <span data-ttu-id="7f35e-106">Toplu kopyalama işlemi geri alma için fırsat ile işlem temelli olmayan bir şekilde gerçekleşir.</span><span class="sxs-lookup"><span data-stu-id="7f35e-106">The bulk copy operation occurs in a non-transacted way, with no opportunity for rolling it back.</span></span> <span data-ttu-id="7f35e-107">Bir hata oluştuğunda toplu kopyalama bir kısmını veya tamamını geri alma gerekiyorsa, kullanabileceğiniz bir <xref:System.Data.SqlClient.SqlBulkCopy>-yönetilen işlem, toplu kopyalama işlemi var olan bir işlem içinde ya da kayıtlı bir **System.Transactions** <xref:System.Transactions.Transaction>.</span><span class="sxs-lookup"><span data-stu-id="7f35e-107">If you need to roll back all or part of the bulk copy when an error occurs, you can use a <xref:System.Data.SqlClient.SqlBulkCopy>-managed transaction, perform the bulk copy operation within an existing transaction, or be enlisted in a **System.Transactions**<xref:System.Transactions.Transaction>.</span></span>  
  
## <a name="performing-a-non-transacted-bulk-copy-operation"></a><span data-ttu-id="7f35e-108">Bir işlem temelli olmayan toplu kopyalama işlemi gerçekleştirme</span><span class="sxs-lookup"><span data-stu-id="7f35e-108">Performing a Non-transacted Bulk Copy Operation</span></span>  
 <span data-ttu-id="7f35e-109">Aşağıdaki konsol uygulamasında, bir işlem temelli olmayan toplu kopyalama işlemi kadar işlemle bir hatayla karşılaştığında ne olacağını gösterir.</span><span class="sxs-lookup"><span data-stu-id="7f35e-109">The following Console application shows what happens when a non-transacted bulk copy operation encounters an error partway through the operation.</span></span>  
  
 <span data-ttu-id="7f35e-110">Örnekte, kaynak tablosu ve hedef tablo içeren bir `Identity` adlı sütun **ProductID**.</span><span class="sxs-lookup"><span data-stu-id="7f35e-110">In the example, the source table and destination table each include an `Identity` column named **ProductID**.</span></span> <span data-ttu-id="7f35e-111">İlk kod tüm satırları silerek hedef tablo hazırlar ve sonra tek bir ekleme, satır ayarlanmış **ProductID** kaynak tablosunda bilinmektedir.</span><span class="sxs-lookup"><span data-stu-id="7f35e-111">The code first prepares the destination table by deleting all rows and then inserting a single row whose **ProductID** is known to exist in the source table.</span></span> <span data-ttu-id="7f35e-112">Varsayılan olarak, yeni bir değer için `Identity` sütunu hedef tabloda eklenen her satır için oluşturulur.</span><span class="sxs-lookup"><span data-stu-id="7f35e-112">By default, a new value for the `Identity` column is generated in the destination table for each row added.</span></span> <span data-ttu-id="7f35e-113">Bu örnekte, bir seçenek ayarlanır, bu bağlantıyı kullanmak için toplu yükleme işlemi zorlayan açıldığında `Identity` bunun yerine kaynak tablosundan değerleri.</span><span class="sxs-lookup"><span data-stu-id="7f35e-113">In this example, an option is set when the connection is opened that forces the bulk load process to use the `Identity` values from the source table instead.</span></span>  
  
 <span data-ttu-id="7f35e-114">Toplu kopyalama işlemi ile yürütülür <xref:System.Data.SqlClient.SqlBulkCopy.BatchSize%2A> özelliği 10'a ayarlayın.</span><span class="sxs-lookup"><span data-stu-id="7f35e-114">The bulk copy operation is executed with the <xref:System.Data.SqlClient.SqlBulkCopy.BatchSize%2A> property set to 10.</span></span> <span data-ttu-id="7f35e-115">İşlemi geçersiz satır karşılaştığında, bir özel durum oluşturulur.</span><span class="sxs-lookup"><span data-stu-id="7f35e-115">When the operation encounters the invalid row, an exception is thrown.</span></span> <span data-ttu-id="7f35e-116">Bu ilk örnekte, işlem temelli olmayan toplu kopyalama işlemi.</span><span class="sxs-lookup"><span data-stu-id="7f35e-116">In this first example, the bulk copy operation is non-transacted.</span></span> <span data-ttu-id="7f35e-117">Hata noktası kadar kopyalanan tüm toplu kaydedilmiş; Yinelenen anahtar içeren toplu geri alınır ve başka bir toplu işlemler işlenmeden önce toplu kopyalama işlemi durduruldu.</span><span class="sxs-lookup"><span data-stu-id="7f35e-117">All batches copied up to the point of the error are committed; the batch containing the duplicate key is rolled back, and the bulk copy operation is halted before processing any other batches.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="7f35e-118">Bu örnekte açıklandığı gibi çalışma tabloları oluşturmadığınız sürece çalışmaz [toplu kopyalama örnek Kurulumu](../../../../../docs/framework/data/adonet/sql/bulk-copy-example-setup.md).</span><span class="sxs-lookup"><span data-stu-id="7f35e-118">This sample will not run unless you have created the work tables as described in [Bulk Copy Example Setup](../../../../../docs/framework/data/adonet/sql/bulk-copy-example-setup.md).</span></span> <span data-ttu-id="7f35e-119">Bu kodu kullanmaya ilişkin sözdizimini göstermek için sağlanan **SqlBulkCopy** yalnızca.</span><span class="sxs-lookup"><span data-stu-id="7f35e-119">This code is provided to demonstrate the syntax for using **SqlBulkCopy** only.</span></span> <span data-ttu-id="7f35e-120">Kaynak ve hedef tablo aynı SQL Server örneğinde bulunuyorsa daha kolay ve daha hızlı kullanmak için bunu bir [!INCLUDE[tsql](../../../../../includes/tsql-md.md)] `INSERT … SELECT` verileri kopyalamak için deyimi.</span><span class="sxs-lookup"><span data-stu-id="7f35e-120">If the source and destination tables are located in the same SQL Server instance, it is easier and faster to use a [!INCLUDE[tsql](../../../../../includes/tsql-md.md)]`INSERT … SELECT` statement to copy the data.</span></span>  
  
 [!code-csharp[DataWorks SqlBulkCopy.DefaultTransaction#1](../../../../../samples/snippets/csharp/VS_Snippets_ADO.NET/DataWorks SqlBulkCopy.DefaultTransaction/CS/source.cs#1)]
 [!code-vb[DataWorks SqlBulkCopy.DefaultTransaction#1](../../../../../samples/snippets/visualbasic/VS_Snippets_ADO.NET/DataWorks SqlBulkCopy.DefaultTransaction/VB/source.vb#1)]  
  
## <a name="performing-a-dedicated-bulk-copy-operation-in-a-transaction"></a><span data-ttu-id="7f35e-121">Bir işlemde bir adanmış toplu kopyalama işlemi gerçekleştirme</span><span class="sxs-lookup"><span data-stu-id="7f35e-121">Performing a Dedicated Bulk Copy Operation in a Transaction</span></span>  
 <span data-ttu-id="7f35e-122">Varsayılan olarak, toplu kopyalama işlemi kendi işlemdir.</span><span class="sxs-lookup"><span data-stu-id="7f35e-122">By default, a bulk copy operation is its own transaction.</span></span> <span data-ttu-id="7f35e-123">Adanmış toplu kopyalama işlemini gerçekleştirmek istediğinizde, yeni bir örneğini oluşturma <xref:System.Data.SqlClient.SqlBulkCopy> bağlantı dizesi ya da mevcut bir kullanım ile <xref:System.Data.SqlClient.SqlConnection> etkin bir işlem olmadan nesne.</span><span class="sxs-lookup"><span data-stu-id="7f35e-123">When you want to perform a dedicated bulk copy operation, create a new instance of <xref:System.Data.SqlClient.SqlBulkCopy> with a connection string, or use an existing <xref:System.Data.SqlClient.SqlConnection> object without an active transaction.</span></span> <span data-ttu-id="7f35e-124">Her bir senaryoda, toplu kopyalama işlemi oluşturur ve ardından kaydeder veya geri işlem yapar.</span><span class="sxs-lookup"><span data-stu-id="7f35e-124">In each scenario, the bulk copy operation creates, and then commits or rolls back the transaction.</span></span>  
  
 <span data-ttu-id="7f35e-125">Açıkça belirtebilirsiniz <xref:System.Data.SqlClient.SqlBulkCopyOptions.UseInternalTransaction> seçeneğini <xref:System.Data.SqlClient.SqlBulkCopy> sınıf oluşturucusu her toplu işin ayrı bir işlem içinde çalıştırmak için toplu kopyalama işleminin neden kendi işlemde çalıştırmak bir toplu kopyalama işlemi açıkça neden olacak.</span><span class="sxs-lookup"><span data-stu-id="7f35e-125">You can explicitly specify the <xref:System.Data.SqlClient.SqlBulkCopyOptions.UseInternalTransaction> option in the <xref:System.Data.SqlClient.SqlBulkCopy> class constructor to explicitly cause a bulk copy operation to execute in its own transaction, causing each batch of the bulk copy operation to execute within a separate transaction.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="7f35e-126">Toplu kopyalama işlemi sırasında bir hata oluşursa, farklı işlemlerde farklı toplu çalıştırıldığından, geçerli toplu işlemdeki tüm satırları geri alınır, ancak önceki toplu işlerin satırlardan veritabanında kalır.</span><span class="sxs-lookup"><span data-stu-id="7f35e-126">Since different batches are executed in different transactions, if an error occurs during the bulk copy operation, all the rows in the current batch will be rolled back, but rows from previous batches will remain in the database.</span></span>  
  
 <span data-ttu-id="7f35e-127">Aşağıdaki konsol uygulamasında, bir özel durum dışında önceki örneğe benzer: Bu örnekte, toplu kopyalama işlemi kendi işlemleri yönetir.</span><span class="sxs-lookup"><span data-stu-id="7f35e-127">The following console application is similar to the previous example, with one exception: In this example, the bulk copy operation manages its own transactions.</span></span> <span data-ttu-id="7f35e-128">Hata noktası kadar kopyalanan tüm toplu kaydedilmiş; Yinelenen anahtar içeren toplu geri alınır ve başka bir toplu işlemler işlenmeden önce toplu kopyalama işlemi durduruldu.</span><span class="sxs-lookup"><span data-stu-id="7f35e-128">All batches copied up to the point of the error are committed; the batch containing the duplicate key is rolled back, and the bulk copy operation is halted before processing any other batches.</span></span>  
  
> [!IMPORTANT]
>  <span data-ttu-id="7f35e-129">Bu örnekte açıklandığı gibi çalışma tabloları oluşturmadığınız sürece çalışmaz [toplu kopyalama örnek Kurulumu](../../../../../docs/framework/data/adonet/sql/bulk-copy-example-setup.md).</span><span class="sxs-lookup"><span data-stu-id="7f35e-129">This sample will not run unless you have created the work tables as described in [Bulk Copy Example Setup](../../../../../docs/framework/data/adonet/sql/bulk-copy-example-setup.md).</span></span> <span data-ttu-id="7f35e-130">Bu kodu kullanmaya ilişkin sözdizimini göstermek için sağlanan **SqlBulkCopy** yalnızca.</span><span class="sxs-lookup"><span data-stu-id="7f35e-130">This code is provided to demonstrate the syntax for using **SqlBulkCopy** only.</span></span> <span data-ttu-id="7f35e-131">Kaynak ve hedef tablo aynı SQL Server örneğinde bulunuyorsa daha kolay ve daha hızlı kullanmak için bunu bir [!INCLUDE[tsql](../../../../../includes/tsql-md.md)] `INSERT … SELECT` verileri kopyalamak için deyimi.</span><span class="sxs-lookup"><span data-stu-id="7f35e-131">If the source and destination tables are located in the same SQL Server instance, it is easier and faster to use a [!INCLUDE[tsql](../../../../../includes/tsql-md.md)]`INSERT … SELECT` statement to copy the data.</span></span>  
  
 [!code-csharp[DataWorks SqlBulkCopy.InternalTransaction#1](../../../../../samples/snippets/csharp/VS_Snippets_ADO.NET/DataWorks SqlBulkCopy.InternalTransaction/CS/source.cs#1)]
 [!code-vb[DataWorks SqlBulkCopy.InternalTransaction#1](../../../../../samples/snippets/visualbasic/VS_Snippets_ADO.NET/DataWorks SqlBulkCopy.InternalTransaction/VB/source.vb#1)]  
  
## <a name="using-existing-transactions"></a><span data-ttu-id="7f35e-132">Var olan işlemleri kullanma</span><span class="sxs-lookup"><span data-stu-id="7f35e-132">Using Existing Transactions</span></span>  
 <span data-ttu-id="7f35e-133">Mevcut bir belirtebilirsiniz <xref:System.Data.SqlClient.SqlTransaction> nesnesi bir parametre olarak bir <xref:System.Data.SqlClient.SqlBulkCopy> Oluşturucusu.</span><span class="sxs-lookup"><span data-stu-id="7f35e-133">You can specify an existing <xref:System.Data.SqlClient.SqlTransaction> object as a parameter in a <xref:System.Data.SqlClient.SqlBulkCopy> constructor.</span></span> <span data-ttu-id="7f35e-134">Bu durumda, var olan bir işlemde toplu kopyalama işlemi gerçekleştirilir ve işlem durumu için hiçbir değişiklik (diğer bir deyişle, kaydedilen iptal ne).</span><span class="sxs-lookup"><span data-stu-id="7f35e-134">In this situation, the bulk copy operation is performed in an existing transaction, and no change is made to the transaction state (that is, it is neither committed nor aborted).</span></span> <span data-ttu-id="7f35e-135">Bu, diğer veritabanı işlemleri ile bir işlemde toplu kopyalama işlemi eklemek bir uygulama sağlar.</span><span class="sxs-lookup"><span data-stu-id="7f35e-135">This allows an application to include the bulk copy operation in a transaction with other database operations.</span></span> <span data-ttu-id="7f35e-136">Ancak, belirtmezseniz, bir <xref:System.Data.SqlClient.SqlTransaction> nesne ve geçişi bir null başvurusu ve bağlantısı etkin bir işlem olduğundan, bir özel durum oluşturulur.</span><span class="sxs-lookup"><span data-stu-id="7f35e-136">However, if you do not specify a <xref:System.Data.SqlClient.SqlTransaction> object and pass a null reference, and the connection has an active transaction, an exception is thrown.</span></span>  
  
 <span data-ttu-id="7f35e-137">Geri almak ihtiyacınız varsa tüm toplu bir hata oluşursa veya toplu kopyalama geri alınması daha büyük bir işleminin bir parçası yürütülecek, sağlayabilir olduğundan, işlem kopyalama bir <xref:System.Data.SqlClient.SqlTransaction> nesnesini <xref:System.Data.SqlClient.SqlBulkCopy> Oluşturucusu.</span><span class="sxs-lookup"><span data-stu-id="7f35e-137">If you need to roll back the entire bulk copy operation because an error occurs, or if the bulk copy should execute as part of a larger process that can be rolled back, you can provide a <xref:System.Data.SqlClient.SqlTransaction> object to the <xref:System.Data.SqlClient.SqlBulkCopy> constructor.</span></span>  
  
 <span data-ttu-id="7f35e-138">Aşağıdaki konsol uygulamasında örneğe benzer şekilde ilk (işlem temelli olmayan), bir özel durum: Bu örnekte, bir büyük, dış işlemde toplu kopyalama işlemi dahildir.</span><span class="sxs-lookup"><span data-stu-id="7f35e-138">The following console application is similar to the first (non-transacted) example, with one exception: in this example, the bulk copy operation is included in a larger, external transaction.</span></span> <span data-ttu-id="7f35e-139">Birincil anahtar ihlali hatası oluştuğunda, işlemin tümü geri alınır ve hiçbir satırları hedef tabloya eklenir.</span><span class="sxs-lookup"><span data-stu-id="7f35e-139">When the primary key violation error occurs, the entire transaction is rolled back and no rows are added to the destination table.</span></span>  
  
> [!IMPORTANT]
>  <span data-ttu-id="7f35e-140">Bu örnekte açıklandığı gibi çalışma tabloları oluşturmadığınız sürece çalışmaz [toplu kopyalama örnek Kurulumu](../../../../../docs/framework/data/adonet/sql/bulk-copy-example-setup.md).</span><span class="sxs-lookup"><span data-stu-id="7f35e-140">This sample will not run unless you have created the work tables as described in [Bulk Copy Example Setup](../../../../../docs/framework/data/adonet/sql/bulk-copy-example-setup.md).</span></span> <span data-ttu-id="7f35e-141">Bu kodu kullanmaya ilişkin sözdizimini göstermek için sağlanan **SqlBulkCopy** yalnızca.</span><span class="sxs-lookup"><span data-stu-id="7f35e-141">This code is provided to demonstrate the syntax for using **SqlBulkCopy** only.</span></span> <span data-ttu-id="7f35e-142">Kaynak ve hedef tablo aynı SQL Server örneğinde bulunuyorsa daha kolay ve daha hızlı kullanmak için bunu bir [!INCLUDE[tsql](../../../../../includes/tsql-md.md)] `INSERT … SELECT` verileri kopyalamak için deyimi.</span><span class="sxs-lookup"><span data-stu-id="7f35e-142">If the source and destination tables are located in the same SQL Server instance, it is easier and faster to use a [!INCLUDE[tsql](../../../../../includes/tsql-md.md)]`INSERT … SELECT` statement to copy the data.</span></span>  
  
 [!code-csharp[DataWorks SqlBulkCopy.SqlTransaction#1](../../../../../samples/snippets/csharp/VS_Snippets_ADO.NET/DataWorks SqlBulkCopy.SqlTransaction/CS/source.cs#1)]
 [!code-vb[DataWorks SqlBulkCopy.SqlTransaction#1](../../../../../samples/snippets/visualbasic/VS_Snippets_ADO.NET/DataWorks SqlBulkCopy.SqlTransaction/VB/source.vb#1)]  
  
## <a name="see-also"></a><span data-ttu-id="7f35e-143">Ayrıca bkz.</span><span class="sxs-lookup"><span data-stu-id="7f35e-143">See also</span></span>

- [<span data-ttu-id="7f35e-144">SQL Server’da Toplu Kopyalama İşlemleri</span><span class="sxs-lookup"><span data-stu-id="7f35e-144">Bulk Copy Operations in SQL Server</span></span>](../../../../../docs/framework/data/adonet/sql/bulk-copy-operations-in-sql-server.md)
- [<span data-ttu-id="7f35e-145">ADO.NET yönetilen sağlayıcıları ve DataSet Geliştirici Merkezi</span><span class="sxs-lookup"><span data-stu-id="7f35e-145">ADO.NET Managed Providers and DataSet Developer Center</span></span>](https://go.microsoft.com/fwlink/?LinkId=217917)
