---
title: Windows Kimlik Doğrulama Hatalarını Ayıklama
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- WCF, authentication
- WCF, Windows authentication
ms.assetid: 181be4bd-79b1-4a66-aee2-931887a6d7cc
ms.openlocfilehash: a68a291b1974e86c9a4f16f9d90a879649076533
ms.sourcegitcommit: 6b308cf6d627d78ee36dbbae8972a310ac7fd6c8
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 01/23/2019
ms.locfileid: "54595142"
---
# <a name="debugging-windows-authentication-errors"></a><span data-ttu-id="81c04-102">Windows Kimlik Doğrulama Hatalarını Ayıklama</span><span class="sxs-lookup"><span data-stu-id="81c04-102">Debugging Windows Authentication Errors</span></span>
<span data-ttu-id="81c04-103">Windows kimlik doğrulaması, bir güvenlik mekanizması olarak kullanırken, Güvenlik Desteği Sağlayıcısı Arabirimi (SSPI), güvenlik işlemlerini işler.</span><span class="sxs-lookup"><span data-stu-id="81c04-103">When using Windows authentication as a security mechanism, the Security Support Provider Interface (SSPI) handles security processes.</span></span> <span data-ttu-id="81c04-104">SSPI katmanında güvenlik hatası meydana geldiğinde, Windows Communication Foundation (WCF) tarafından takip edilir.</span><span class="sxs-lookup"><span data-stu-id="81c04-104">When security errors occur at the SSPI layer, they are surfaced by Windows Communication Foundation (WCF).</span></span> <span data-ttu-id="81c04-105">Bu konu, çerçeve ve hataları tanılamak üzere soruları sağlar.</span><span class="sxs-lookup"><span data-stu-id="81c04-105">This topic provides a framework and set of questions to help diagnose the errors.</span></span>  
  
 <span data-ttu-id="81c04-106">Kerberos protokolü genel bakış için bkz. [Kerberos açıklanan](https://go.microsoft.com/fwlink/?LinkID=86946); SSPI, genel bir bakış için bkz [SSPI](https://go.microsoft.com/fwlink/?LinkId=88941).</span><span class="sxs-lookup"><span data-stu-id="81c04-106">For an overview of the Kerberos protocol, see [Kerberos Explained](https://go.microsoft.com/fwlink/?LinkID=86946); for an overview of SSPI, see [SSPI](https://go.microsoft.com/fwlink/?LinkId=88941).</span></span>  
  
 <span data-ttu-id="81c04-107">WCF genellikle Windows kimlik doğrulaması için kullandığı *anlaş* Kerberos hizmet ve istemci arasında karşılıklı kimlik doğrulaması gerçekleştiren Güvenlik Desteği Sağlayıcısı'ne (SSP).</span><span class="sxs-lookup"><span data-stu-id="81c04-107">For Windows authentication, WCF typically uses the *Negotiate* Security Support Provider (SSP), which performs Kerberos mutual authentication between the client and service.</span></span> <span data-ttu-id="81c04-108">Kerberos protokolü, kullanılabilir durumda değilse, varsayılan olarak WCF NT LAN Manager (NTLM) geri döner.</span><span class="sxs-lookup"><span data-stu-id="81c04-108">If the Kerberos protocol is not available, by default WCF falls back to NT LAN Manager (NTLM).</span></span> <span data-ttu-id="81c04-109">Ancak, WCF yalnızca Kerberos protokolünü kullanma (ve Kerberos mevcut değilse bir özel durum) yapılandırabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="81c04-109">However, you can configure WCF to use only the Kerberos protocol (and to throw an exception if Kerberos is not available).</span></span> <span data-ttu-id="81c04-110">Ayrıca kısıtlı Kerberos protokolü biçimlerinin kullanmak için WCF yapılandırabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="81c04-110">You can also configure WCF to use restricted forms of the Kerberos protocol.</span></span>  
  
## <a name="debugging-methodology"></a><span data-ttu-id="81c04-111">Hata ayıklama yöntemi</span><span class="sxs-lookup"><span data-stu-id="81c04-111">Debugging Methodology</span></span>  
 <span data-ttu-id="81c04-112">Temel yöntem aşağıdaki gibidir:</span><span class="sxs-lookup"><span data-stu-id="81c04-112">The basic method is as follows:</span></span>  
  
1.  <span data-ttu-id="81c04-113">Windows kimlik doğrulaması kullandığınızı belirleyin.</span><span class="sxs-lookup"><span data-stu-id="81c04-113">Determine whether you are using Windows authentication.</span></span> <span data-ttu-id="81c04-114">Başka bir düzen kullanıyorsanız, bu konuda geçerli değildir.</span><span class="sxs-lookup"><span data-stu-id="81c04-114">If you are using any other scheme, this topic does not apply.</span></span>  
  
2.  <span data-ttu-id="81c04-115">Windows kimlik doğrulaması kullanıyorsanız eminseniz, WCF yapılandırma doğrudan Kerberos veya anlaşma kullanıp kullanmadığını belirleyin.</span><span class="sxs-lookup"><span data-stu-id="81c04-115">If you are sure you are using Windows authentication, determine whether your WCF configuration uses Kerberos direct or Negotiate.</span></span>  
  
3.  <span data-ttu-id="81c04-116">Yapılandırmanızı NTLM ve Kerberos protokolünü kullanıp kullanmadığını belirledikten sonra hata iletileri doğru bağlamda anlayabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="81c04-116">Once you have determined whether your configuration is using the Kerberos protocol or NTLM, you can understand error messages in the correct context.</span></span>  
  
### <a name="availability-of-the-kerberos-protocol-and-ntlm"></a><span data-ttu-id="81c04-117">NTLM ve Kerberos protokolü kullanılabilirliği</span><span class="sxs-lookup"><span data-stu-id="81c04-117">Availability of the Kerberos Protocol and NTLM</span></span>  
 <span data-ttu-id="81c04-118">Kerberos SSP Kerberos Anahtar Dağıtım Merkezi (KDC) olarak görev yapacak bir etki alanı denetleyicisi gerektirir.</span><span class="sxs-lookup"><span data-stu-id="81c04-118">The Kerberos SSP requires a domain controller to act as the Kerberos Key Distribution Center (KDC).</span></span> <span data-ttu-id="81c04-119">Kerberos protokolü, yalnızca etki alanı kimlikleri hem istemci hem de hizmet kullanırken kullanılabilir.</span><span class="sxs-lookup"><span data-stu-id="81c04-119">The Kerberos protocol is available only when both the client and service are using domain identities.</span></span> <span data-ttu-id="81c04-120">Diğer hesap birleşimler, NTLM, aşağıdaki tabloda özetlendiği gibi kullanılır.</span><span class="sxs-lookup"><span data-stu-id="81c04-120">In other account combinations, NTLM is used, as summarized in the following table.</span></span>  
  
 <span data-ttu-id="81c04-121">Olası hesap türleri için sunucu tarafından kullanılan tablo üst bilgileri gösterin.</span><span class="sxs-lookup"><span data-stu-id="81c04-121">The table headers show possible account types used by the server.</span></span> <span data-ttu-id="81c04-122">Sol sütunda, istemci tarafından kullanılan olası hesap türleri gösterir.</span><span class="sxs-lookup"><span data-stu-id="81c04-122">The left column shows possible account types used by the client.</span></span>  
  
||<span data-ttu-id="81c04-123">Yerel kullanıcı</span><span class="sxs-lookup"><span data-stu-id="81c04-123">Local User</span></span>|<span data-ttu-id="81c04-124">Yerel Sistem</span><span class="sxs-lookup"><span data-stu-id="81c04-124">Local System</span></span>|<span data-ttu-id="81c04-125">Domain User</span><span class="sxs-lookup"><span data-stu-id="81c04-125">Domain User</span></span>|<span data-ttu-id="81c04-126">Domain Machine</span><span class="sxs-lookup"><span data-stu-id="81c04-126">Domain Machine</span></span>|  
|-|----------------|------------------|-----------------|--------------------|  
|<span data-ttu-id="81c04-127">Yerel kullanıcı</span><span class="sxs-lookup"><span data-stu-id="81c04-127">Local User</span></span>|<span data-ttu-id="81c04-128">NTLM</span><span class="sxs-lookup"><span data-stu-id="81c04-128">NTLM</span></span>|<span data-ttu-id="81c04-129">NTLM</span><span class="sxs-lookup"><span data-stu-id="81c04-129">NTLM</span></span>|<span data-ttu-id="81c04-130">NTLM</span><span class="sxs-lookup"><span data-stu-id="81c04-130">NTLM</span></span>|<span data-ttu-id="81c04-131">NTLM</span><span class="sxs-lookup"><span data-stu-id="81c04-131">NTLM</span></span>|  
|<span data-ttu-id="81c04-132">Yerel Sistem</span><span class="sxs-lookup"><span data-stu-id="81c04-132">Local System</span></span>|<span data-ttu-id="81c04-133">Anonim NTLM</span><span class="sxs-lookup"><span data-stu-id="81c04-133">Anonymous NTLM</span></span>|<span data-ttu-id="81c04-134">Anonim NTLM</span><span class="sxs-lookup"><span data-stu-id="81c04-134">Anonymous NTLM</span></span>|<span data-ttu-id="81c04-135">Anonim NTLM</span><span class="sxs-lookup"><span data-stu-id="81c04-135">Anonymous NTLM</span></span>|<span data-ttu-id="81c04-136">Anonim NTLM</span><span class="sxs-lookup"><span data-stu-id="81c04-136">Anonymous NTLM</span></span>|  
|<span data-ttu-id="81c04-137">Domain User</span><span class="sxs-lookup"><span data-stu-id="81c04-137">Domain User</span></span>|<span data-ttu-id="81c04-138">NTLM</span><span class="sxs-lookup"><span data-stu-id="81c04-138">NTLM</span></span>|<span data-ttu-id="81c04-139">NTLM</span><span class="sxs-lookup"><span data-stu-id="81c04-139">NTLM</span></span>|<span data-ttu-id="81c04-140">Kerberos</span><span class="sxs-lookup"><span data-stu-id="81c04-140">Kerberos</span></span>|<span data-ttu-id="81c04-141">Kerberos</span><span class="sxs-lookup"><span data-stu-id="81c04-141">Kerberos</span></span>|  
|<span data-ttu-id="81c04-142">Domain Machine</span><span class="sxs-lookup"><span data-stu-id="81c04-142">Domain Machine</span></span>|<span data-ttu-id="81c04-143">NTLM</span><span class="sxs-lookup"><span data-stu-id="81c04-143">NTLM</span></span>|<span data-ttu-id="81c04-144">NTLM</span><span class="sxs-lookup"><span data-stu-id="81c04-144">NTLM</span></span>|<span data-ttu-id="81c04-145">Kerberos</span><span class="sxs-lookup"><span data-stu-id="81c04-145">Kerberos</span></span>|<span data-ttu-id="81c04-146">Kerberos</span><span class="sxs-lookup"><span data-stu-id="81c04-146">Kerberos</span></span>|  
  
 <span data-ttu-id="81c04-147">Özellikle, dört hesap türleri şunlardır:</span><span class="sxs-lookup"><span data-stu-id="81c04-147">Specifically, the four account types include:</span></span>  
  
-   <span data-ttu-id="81c04-148">Yerel kullanıcı: Yalnızca makine kullanıcı profili.</span><span class="sxs-lookup"><span data-stu-id="81c04-148">Local User: Machine-only user profile.</span></span> <span data-ttu-id="81c04-149">Örneğin: `MachineName\Administrator` veya `MachineName\ProfileName`.</span><span class="sxs-lookup"><span data-stu-id="81c04-149">For example: `MachineName\Administrator` or `MachineName\ProfileName`.</span></span>  
  
-   <span data-ttu-id="81c04-150">Yerel sistemi: Bir etki alanına katılmamış bir makinede yerleşik hesap sistem.</span><span class="sxs-lookup"><span data-stu-id="81c04-150">Local System: The built-in account SYSTEM on a machine that is not joined to a domain.</span></span>  
  
-   <span data-ttu-id="81c04-151">Etki alanı kullanıcısı: Bir Windows etki alanı kullanıcı hesabı.</span><span class="sxs-lookup"><span data-stu-id="81c04-151">Domain User: A user account on a Windows domain.</span></span> <span data-ttu-id="81c04-152">Örneğin: `DomainName\ProfileName`</span><span class="sxs-lookup"><span data-stu-id="81c04-152">For example: `DomainName\ProfileName`.</span></span>  
  
-   <span data-ttu-id="81c04-153">Makine etki alanı: Makine kimliğini bir Windows etki alanına katılmış bir makinede çalışan bir işlem.</span><span class="sxs-lookup"><span data-stu-id="81c04-153">Domain Machine: A process with machine identity running on a machine joined to a Windows domain.</span></span> <span data-ttu-id="81c04-154">Örneğin: `MachineName\Network Service`</span><span class="sxs-lookup"><span data-stu-id="81c04-154">For example: `MachineName\Network Service`.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="81c04-155">Hizmet kimlik bilgisi yakalanan olduğunda <xref:System.ServiceModel.ICommunicationObject.Open%2A> yöntemi <xref:System.ServiceModel.ServiceHost> sınıfı çağrılır.</span><span class="sxs-lookup"><span data-stu-id="81c04-155">The service credential is captured when the <xref:System.ServiceModel.ICommunicationObject.Open%2A> method of the <xref:System.ServiceModel.ServiceHost> class is called.</span></span> <span data-ttu-id="81c04-156">İstemci kimlik bilgilerini okuma her istemciye bir ileti gönderir.</span><span class="sxs-lookup"><span data-stu-id="81c04-156">The client credential is read whenever the client sends a message.</span></span>  
  
## <a name="common-windows-authentication-problems"></a><span data-ttu-id="81c04-157">Ortak Windows kimlik doğrulama sorunları</span><span class="sxs-lookup"><span data-stu-id="81c04-157">Common Windows Authentication Problems</span></span>  
 <span data-ttu-id="81c04-158">Bu bölümde, bazı ortak Windows kimlik doğrulama sorunları ve olası çözümler ele alınmaktadır.</span><span class="sxs-lookup"><span data-stu-id="81c04-158">This section discusses some common Windows authentication problems and possible remedies.</span></span>  
  
### <a name="kerberos-protocol"></a><span data-ttu-id="81c04-159">Kerberos protokolü</span><span class="sxs-lookup"><span data-stu-id="81c04-159">Kerberos Protocol</span></span>  
  
#### <a name="spnupn-problems-with-the-kerberos-protocol"></a><span data-ttu-id="81c04-160">Kerberos protokolü SPN/UPN sorunları</span><span class="sxs-lookup"><span data-stu-id="81c04-160">SPN/UPN Problems with the Kerberos Protocol</span></span>  
 <span data-ttu-id="81c04-161">Windows kimlik doğrulaması ve Kerberos protokolü kullanılan ya da SSPI tarafından anlaşılan kullanırken, istemci uç noktası kullandığı URL'yi hizmetin ana bilgisayar hizmeti URL içinde tam etki alanı adı içermelidir.</span><span class="sxs-lookup"><span data-stu-id="81c04-161">When using Windows authentication, and the Kerberos protocol is used or negotiated by SSPI, the URL the client endpoint uses must include the fully qualified domain name of the service's host inside the service URL.</span></span> <span data-ttu-id="81c04-162">Bu hizmetin altında çalıştığı hesabın altında hizmete çalıştırarak en yaygın olarak yapılır Active Directory etki alanına bilgisayar eklendiğinde, oluşturulan makine (varsayılan) hizmet asıl adı (SPN) anahtarı erişimi olduğunu varsayar. Ağ hizmeti hesabı.</span><span class="sxs-lookup"><span data-stu-id="81c04-162">This assumes that the account under which the service is running has access to the machine (default) service principal name (SPN) key that is created when the computer is added to the Active Directory domain, which is most commonly done by running the service under the Network Service account.</span></span> <span data-ttu-id="81c04-163">Hizmet makine SPN anahtarına erişimi yoksa, hizmet, istemcinin uç nokta kimliğinde çalıştırıldığı hesabın doğru SPN veya kullanıcı asıl adı (UPN) sağlamanız gerekir.</span><span class="sxs-lookup"><span data-stu-id="81c04-163">If the service does not have access to the machine SPN key, you must supply the correct SPN or user principal name (UPN) of the account under which the service is running in the client's endpoint identity.</span></span> <span data-ttu-id="81c04-164">WCF SPN ve UPN ile nasıl çalıştığı hakkında daha fazla bilgi için bkz. [kimlik doğrulama ile hizmet kimliği](../../../../docs/framework/wcf/feature-details/service-identity-and-authentication.md).</span><span class="sxs-lookup"><span data-stu-id="81c04-164">For more information about how WCF works with SPN and UPN, see [Service Identity and Authentication](../../../../docs/framework/wcf/feature-details/service-identity-and-authentication.md).</span></span>  
  
 <span data-ttu-id="81c04-165">Yük Dengeleme, Web grupları veya Web bahçelerinde gibi senaryoları yaygın bir uygulamadır her uygulama için benzersiz bir hesabı tanımlamak, SPN'yi ilgili hesabı atama ve bu hesapta bulunan tüm uygulama hizmetlerini çalıştırdığınızdan emin olun.</span><span class="sxs-lookup"><span data-stu-id="81c04-165">In load-balancing scenarios, such as Web farms or Web gardens, a common practice is to define a unique account for each application, assign an SPN to that account, and ensure that all of the application's services run in that account.</span></span>  
  
 <span data-ttu-id="81c04-166">Hizmet hesabı için bir SPN elde etmek için bir Active Directory etki alanı yöneticisi olmanız gerekir.</span><span class="sxs-lookup"><span data-stu-id="81c04-166">To obtain an SPN for your service's account, you need to be an Active Directory domain administrator.</span></span> <span data-ttu-id="81c04-167">Daha fazla bilgi için [Kerberos teknik ek Windows için](https://go.microsoft.com/fwlink/?LinkID=88330).</span><span class="sxs-lookup"><span data-stu-id="81c04-167">For more information, see [Kerberos Technical Supplement for Windows](https://go.microsoft.com/fwlink/?LinkID=88330).</span></span>  
  
#### <a name="kerberos-protocol-direct-requires-the-service-to-run-under-a-domain-machine-account"></a><span data-ttu-id="81c04-168">Kerberos protokolü doğrudan hizmeti bir etki alanı makine hesabı altında çalıştırılacak gerektirir</span><span class="sxs-lookup"><span data-stu-id="81c04-168">Kerberos Protocol Direct Requires the Service to Run Under a Domain Machine Account</span></span>  
 <span data-ttu-id="81c04-169">Böyle durumlarda `ClientCredentialType` özelliği `Windows` ve <xref:System.ServiceModel.MessageSecurityOverHttp.NegotiateServiceCredential%2A> özelliği `false`aşağıdaki kodda gösterildiği gibi.</span><span class="sxs-lookup"><span data-stu-id="81c04-169">This occurs when the `ClientCredentialType` property is set to `Windows` and the <xref:System.ServiceModel.MessageSecurityOverHttp.NegotiateServiceCredential%2A> property is set to `false`, as shown in the following code.</span></span>  
  
 [!code-csharp[C_DebuggingWindowsAuth#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_debuggingwindowsauth/cs/source.cs#1)]
 [!code-vb[C_DebuggingWindowsAuth#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_debuggingwindowsauth/vb/source.vb#1)]  
  
 <span data-ttu-id="81c04-170">Çözümü, bir etki alanında ağ hizmeti gibi bir etki alanı makine hesabı kullanarak hizmeti çalıştırmak için makine katıldı.</span><span class="sxs-lookup"><span data-stu-id="81c04-170">To remedy, run the service using a Domain Machine account, such as Network Service, on a domain joined machine.</span></span>  
  
### <a name="delegation-requires-credential-negotiation"></a><span data-ttu-id="81c04-171">Kimlik bilgileri görüşmesi temsilci gerektirir</span><span class="sxs-lookup"><span data-stu-id="81c04-171">Delegation Requires Credential Negotiation</span></span>  
 <span data-ttu-id="81c04-172">Temsilci ile Kerberos kimlik doğrulama protokolünü kullanmak için Kerberos protokolü ile kimlik bilgileri görüşmesi (bazen "çok oluşturan" veya "çok adımlı" Kerberos denir) uygulamalıdır.</span><span class="sxs-lookup"><span data-stu-id="81c04-172">To use the Kerberos authentication protocol with delegation, you must implement the Kerberos protocol with credential negotiation (sometimes called "multi-leg" or "multi-step" Kerberos).</span></span> <span data-ttu-id="81c04-173">Kerberos kimlik doğrulaması (bazen "kesin" veya "oluşturan tek" Kerberos denir) kimlik bilgileri görüşmesi uygularsanız, bir özel durum oluşturulur.</span><span class="sxs-lookup"><span data-stu-id="81c04-173">If you implement Kerberos authentication without credential negotiation (sometimes called "one-shot" or "single-leg" Kerberos), an exception will be thrown.</span></span>  
  
 <span data-ttu-id="81c04-174">Kerberos ile kimlik bilgileri görüşmesi uygulamak için aşağıdaki adımları uygulayın:</span><span class="sxs-lookup"><span data-stu-id="81c04-174">To implement Kerberos with credential negotiation, do the following steps:</span></span>  
  
1.  <span data-ttu-id="81c04-175">Uygulama temsilcisi ayarlayarak <xref:System.ServiceModel.Security.WindowsClientCredential.AllowedImpersonationLevel%2A> için <xref:System.Security.Principal.TokenImpersonationLevel.Delegation>.</span><span class="sxs-lookup"><span data-stu-id="81c04-175">Implement delegation by setting <xref:System.ServiceModel.Security.WindowsClientCredential.AllowedImpersonationLevel%2A> to <xref:System.Security.Principal.TokenImpersonationLevel.Delegation>.</span></span>  
  
2.  <span data-ttu-id="81c04-176">SSPI anlaşması gerektirir:</span><span class="sxs-lookup"><span data-stu-id="81c04-176">Require SSPI negotiation:</span></span>  
  
    1.  <span data-ttu-id="81c04-177">Standart bağlamaları kullanıyorsanız `NegotiateServiceCredential` özelliğini `true`.</span><span class="sxs-lookup"><span data-stu-id="81c04-177">If you are using standard bindings, set the `NegotiateServiceCredential` property to `true`.</span></span>  
  
    2.  <span data-ttu-id="81c04-178">Özel bağlamalar kullanıyorsanız `AuthenticationMode` özniteliği `Security` öğesine `SspiNegotiated`.</span><span class="sxs-lookup"><span data-stu-id="81c04-178">If you are using custom bindings, set the `AuthenticationMode` attribute of the `Security` element to `SspiNegotiated`.</span></span>  
  
3.  <span data-ttu-id="81c04-179">Kerberos, NTLM kullanımını engelleyerek kullanmak için SSPI anlaşması gerektirir:</span><span class="sxs-lookup"><span data-stu-id="81c04-179">Require the SSPI negotiation to use Kerberos by disallowing the use of NTLM:</span></span>  
  
    1.  <span data-ttu-id="81c04-180">Bu kodda, aşağıdaki deyimi yapın: `ChannelFactory.Credentials.Windows.AllowNtlm = false`</span><span class="sxs-lookup"><span data-stu-id="81c04-180">Do this in code, with the following statement: `ChannelFactory.Credentials.Windows.AllowNtlm = false`</span></span>  
  
    2.  <span data-ttu-id="81c04-181">Veya yapılandırma dosyasında ayarlayarak bunu yapabilirsiniz `allowNtlm` özniteliğini `false`.</span><span class="sxs-lookup"><span data-stu-id="81c04-181">Or you can do this in the configuration file by setting the `allowNtlm` attribute to `false`.</span></span> <span data-ttu-id="81c04-182">Bu öznitelik bulunan [ \<windows >](../../../../docs/framework/configure-apps/file-schema/wcf/windows-of-clientcredentials-element.md).</span><span class="sxs-lookup"><span data-stu-id="81c04-182">This attribute is contained in the [\<windows>](../../../../docs/framework/configure-apps/file-schema/wcf/windows-of-clientcredentials-element.md).</span></span>  
  
### <a name="ntlm-protocol"></a><span data-ttu-id="81c04-183">NTLM protokolü</span><span class="sxs-lookup"><span data-stu-id="81c04-183">NTLM Protocol</span></span>  
  
#### <a name="negotiate-ssp-falls-back-to-ntlm-but-ntlm-is-disabled"></a><span data-ttu-id="81c04-184">Anlaşma geri NTLM SSP döner, ancak NTLM devre dışıdır</span><span class="sxs-lookup"><span data-stu-id="81c04-184">Negotiate SSP Falls Back to NTLM, but NTLM Is Disabled</span></span>  
 <span data-ttu-id="81c04-185"><xref:System.ServiceModel.Security.WindowsClientCredential.AllowNtlm%2A> Özelliği `false`, bir NTLM kullanılırsa, bir özel durum için mümkün olan en iyi hale getirmek için Windows Communication Foundation (WCF) neden olur.</span><span class="sxs-lookup"><span data-stu-id="81c04-185">The <xref:System.ServiceModel.Security.WindowsClientCredential.AllowNtlm%2A> property is set to `false`, which causes Windows Communication Foundation (WCF) to make a best-effort to throw an exception if NTLM is used.</span></span> <span data-ttu-id="81c04-186">Unutmayın, bu özelliği ayarlamak `false` NTLM kimlik bilgileri kablo üzerinden gönderilen engelleyemeyebilir.</span><span class="sxs-lookup"><span data-stu-id="81c04-186">Note that setting this property to `false` may not prevent NTLM credentials from being sent over the wire.</span></span>  
  
 <span data-ttu-id="81c04-187">Geri dönüş için NTLM devre dışı bırakma gösterir.</span><span class="sxs-lookup"><span data-stu-id="81c04-187">The following shows how to disable fallback to NTLM.</span></span>  
  
 [!code-csharp[C_DebuggingWindowsAuth#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_debuggingwindowsauth/cs/source.cs#4)]
 [!code-vb[C_DebuggingWindowsAuth#4](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_debuggingwindowsauth/vb/source.vb#4)]  
  
#### <a name="ntlm-logon-fails"></a><span data-ttu-id="81c04-188">NTLM oturum açma başarısız</span><span class="sxs-lookup"><span data-stu-id="81c04-188">NTLM Logon Fails</span></span>  
 <span data-ttu-id="81c04-189">İstemci kimlik bilgileri, hizmette geçerli değildir.</span><span class="sxs-lookup"><span data-stu-id="81c04-189">The client credentials are not valid on the service.</span></span> <span data-ttu-id="81c04-190">Kullanıcı adını ve parolasını doğru ayarlandığından ve hizmetin çalıştığı bilgisayarda bilinen bir hesaba karşılık denetleyin.</span><span class="sxs-lookup"><span data-stu-id="81c04-190">Check that the user name and password are correctly set and correspond to an account that is known to the computer where the service is running.</span></span> <span data-ttu-id="81c04-191">NTLM, hizmetin bilgisayarda oturum açmak için belirtilen kimlik bilgilerini kullanır.</span><span class="sxs-lookup"><span data-stu-id="81c04-191">NTLM uses the specified credentials to log on to the service's computer.</span></span> <span data-ttu-id="81c04-192">Kimlik bilgilerini istemci çalıştığı bilgisayarda geçerli olabilir, ancak kimlik bilgileri, hizmetin bilgisayarda geçerli değil. Bu oturum açma başarısız olur.</span><span class="sxs-lookup"><span data-stu-id="81c04-192">While the credentials may be valid on the computer where the client is running, this logon will fail if the credentials are not valid on the service's computer.</span></span>  
  
#### <a name="anonymous-ntlm-logon-occurs-but-anonymous-logons-are-disabled-by-default"></a><span data-ttu-id="81c04-193">Anonim bir NTLM oturum açma gerçekleşir, ancak anonim oturum açma işlemi olan varsayılan olarak devre dışı</span><span class="sxs-lookup"><span data-stu-id="81c04-193">Anonymous NTLM Logon Occurs, but Anonymous Logons Are Disabled by Default</span></span>  
 <span data-ttu-id="81c04-194">Bir istemci oluştururken <xref:System.ServiceModel.Security.WindowsClientCredential.AllowedImpersonationLevel%2A> özelliği <xref:System.Security.Principal.TokenImpersonationLevel.Anonymous>sunucu izin vermiyor anonim oturum açma işlemi aşağıdaki örnekte, ancak varsayılan olarak gösterildiği gibi.</span><span class="sxs-lookup"><span data-stu-id="81c04-194">When creating a client, the <xref:System.ServiceModel.Security.WindowsClientCredential.AllowedImpersonationLevel%2A> property is set to <xref:System.Security.Principal.TokenImpersonationLevel.Anonymous>, as shown in the following example, but by default the server disallows anonymous logons.</span></span> <span data-ttu-id="81c04-195">Bu durum oluşur varsayılan değeri <xref:System.ServiceModel.Security.WindowsServiceCredential.AllowAnonymousLogons%2A> özelliği <xref:System.ServiceModel.Security.WindowsServiceCredential> sınıfı `false`.</span><span class="sxs-lookup"><span data-stu-id="81c04-195">This occurs because the default value of the <xref:System.ServiceModel.Security.WindowsServiceCredential.AllowAnonymousLogons%2A> property of the <xref:System.ServiceModel.Security.WindowsServiceCredential> class is `false`.</span></span>  
  
 <span data-ttu-id="81c04-196">Aşağıdaki istemci kodu, anonim olarak oturum açmayı etkinleştirmeniz dener (varsayılan özellik Not `Identification`).</span><span class="sxs-lookup"><span data-stu-id="81c04-196">The following client code attempts to enable anonymous logons (note that the default property is `Identification`).</span></span>  
  
 [!code-csharp[C_DebuggingWindowsAuth#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_debuggingwindowsauth/cs/source.cs#5)]
 [!code-vb[C_DebuggingWindowsAuth#5](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_debuggingwindowsauth/vb/source.vb#5)]  
  
 <span data-ttu-id="81c04-197">Aşağıdaki hizmet kodu, sunucu tarafından anonim olarak oturum açmayı etkinleştirmeniz varsayılan değiştirir.</span><span class="sxs-lookup"><span data-stu-id="81c04-197">The following service code changes the default to enable anonymous logons by the server.</span></span>  
  
 [!code-csharp[C_DebuggingWindowsAuth#6](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_debuggingwindowsauth/cs/source.cs#6)]
 [!code-vb[C_DebuggingWindowsAuth#6](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_debuggingwindowsauth/vb/source.vb#6)]  
  
 <span data-ttu-id="81c04-198">Kimliğe bürünme hakkında daha fazla bilgi için bkz. [temsilcilik ve kimliğe bürünme](../../../../docs/framework/wcf/feature-details/delegation-and-impersonation-with-wcf.md).</span><span class="sxs-lookup"><span data-stu-id="81c04-198">For more information about impersonation, see [Delegation and Impersonation](../../../../docs/framework/wcf/feature-details/delegation-and-impersonation-with-wcf.md).</span></span>  
  
 <span data-ttu-id="81c04-199">Alternatif olarak, istemci, yerleşik sistem hesabı kullanılarak bir Windows hizmeti olarak çalıştırılır.</span><span class="sxs-lookup"><span data-stu-id="81c04-199">Alternatively, the client is running as a Windows service, using the built-in account SYSTEM.</span></span>  
  
### <a name="other-problems"></a><span data-ttu-id="81c04-200">Diğer sorunlar</span><span class="sxs-lookup"><span data-stu-id="81c04-200">Other Problems</span></span>  
  
#### <a name="client-credentials-are-not-set-correctly"></a><span data-ttu-id="81c04-201">İstemci kimlik bilgileri doğru ayarlanmadı</span><span class="sxs-lookup"><span data-stu-id="81c04-201">Client Credentials Are Not Set Correctly</span></span>  
 <span data-ttu-id="81c04-202">Windows kimlik doğrulaması kullanan <xref:System.ServiceModel.Security.WindowsClientCredential> tarafından döndürülen örnek <xref:System.ServiceModel.ClientBase%601.ClientCredentials%2A> özelliği <xref:System.ServiceModel.ClientBase%601> sınıfı değil, <xref:System.ServiceModel.Security.UserNamePasswordClientCredential>.</span><span class="sxs-lookup"><span data-stu-id="81c04-202">Windows authentication uses the <xref:System.ServiceModel.Security.WindowsClientCredential> instance returned by the <xref:System.ServiceModel.ClientBase%601.ClientCredentials%2A> property of the <xref:System.ServiceModel.ClientBase%601> class, not the <xref:System.ServiceModel.Security.UserNamePasswordClientCredential>.</span></span> <span data-ttu-id="81c04-203">Aşağıda, yanlış bir örnek gösterilmektedir.</span><span class="sxs-lookup"><span data-stu-id="81c04-203">The following shows an incorrect example.</span></span>  
  
 [!code-csharp[C_DebuggingWindowsAuth#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_debuggingwindowsauth/cs/source.cs#2)]
 [!code-vb[C_DebuggingWindowsAuth#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_debuggingwindowsauth/vb/source.vb#2)]  
  
 <span data-ttu-id="81c04-204">Doğru örnek gösterir.</span><span class="sxs-lookup"><span data-stu-id="81c04-204">The following shows the correct example.</span></span>  
  
 [!code-csharp[C_DebuggingWindowsAuth#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_debuggingwindowsauth/cs/source.cs#3)]
 [!code-vb[C_DebuggingWindowsAuth#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_debuggingwindowsauth/vb/source.vb#3)]  
  
#### <a name="sspi-is-not-available"></a><span data-ttu-id="81c04-205">SSPI kullanılamıyor</span><span class="sxs-lookup"><span data-stu-id="81c04-205">SSPI Is Not Available</span></span>  
 <span data-ttu-id="81c04-206">Aşağıdaki işletim sistemleri, bir sunucu olarak kullanıldığında Windows kimlik doğrulamasını desteklemez: [!INCLUDE[wxp](../../../../includes/wxp-md.md)] Home Edition [!INCLUDE[wxp](../../../../includes/wxp-md.md)] Media Center Edition ve [!INCLUDE[wv](../../../../includes/wv-md.md)]Home sürümleri.</span><span class="sxs-lookup"><span data-stu-id="81c04-206">The following operating systems do not support Windows authentication when used as a server: [!INCLUDE[wxp](../../../../includes/wxp-md.md)] Home Edition, [!INCLUDE[wxp](../../../../includes/wxp-md.md)] Media Center Edition, and [!INCLUDE[wv](../../../../includes/wv-md.md)]Home editions.</span></span>  
  
#### <a name="developing-and-deploying-with-different-identities"></a><span data-ttu-id="81c04-207">Geliştirme ve farklı kimlikler ile dağıtma</span><span class="sxs-lookup"><span data-stu-id="81c04-207">Developing and Deploying with Different Identities</span></span>  
 <span data-ttu-id="81c04-208">Bir makine, uygulama geliştirmek ve başka dağıtma ve farklı hesap türlerinin her makinede kimlik doğrulaması için kullanmak, farklı bir davranış karşılaşabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="81c04-208">If you develop your application on one machine, and deploy on another, and use different account types to authenticate on each machine, you may experience different behavior.</span></span> <span data-ttu-id="81c04-209">Örneğin, Windows XP Pro makine kullanarak uygulamanızı geliştirdiğiniz varsayalım `SSPI Negotiated` kimlik doğrulama modu.</span><span class="sxs-lookup"><span data-stu-id="81c04-209">For example, suppose you develop your application on a Windows XP Pro machine using the `SSPI Negotiated` authentication mode.</span></span> <span data-ttu-id="81c04-210">Kimlik doğrulaması yapmak için bir yerel kullanıcı hesabı kullanıyorsanız, NTLM protokolü kullanılır.</span><span class="sxs-lookup"><span data-stu-id="81c04-210">If you use a local user account to authenticate with, then NTLM protocol will be used.</span></span> <span data-ttu-id="81c04-211">Uygulamanın geliştirilme yöntemi sonra etki alanı hesabı altında çalıştığı Windows Server 2003 makineye hizmeti dağıtın.</span><span class="sxs-lookup"><span data-stu-id="81c04-211">Once the application is developed, you deploy the service to a Windows Server 2003 machine where it runs under a domain account.</span></span> <span data-ttu-id="81c04-212">Bu noktada istemci Kerberos ve bir etki alanı denetleyicisi kullanacak için hizmet kimlik doğrulaması mümkün olmayacaktır.</span><span class="sxs-lookup"><span data-stu-id="81c04-212">At this point the client will not be able to authenticate the service because it will be using Kerberos and a domain controller.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="81c04-213">Ayrıca bkz.</span><span class="sxs-lookup"><span data-stu-id="81c04-213">See also</span></span>
- <xref:System.ServiceModel.Security.WindowsClientCredential>
- <xref:System.ServiceModel.Security.WindowsServiceCredential>
- <xref:System.ServiceModel.Security.WindowsClientCredential>
- <xref:System.ServiceModel.ClientBase%601>
- [<span data-ttu-id="81c04-214">Temsilcilik ve Kimliğe Bürünme</span><span class="sxs-lookup"><span data-stu-id="81c04-214">Delegation and Impersonation</span></span>](../../../../docs/framework/wcf/feature-details/delegation-and-impersonation-with-wcf.md)
- [<span data-ttu-id="81c04-215">Desteklenmeyen Senaryolar</span><span class="sxs-lookup"><span data-stu-id="81c04-215">Unsupported Scenarios</span></span>](../../../../docs/framework/wcf/feature-details/unsupported-scenarios.md)
