---
title: 'Nasıl yapılır: İmzalama ve Şifreleme için Ayrı X.509 Sertifikaları Kullanma'
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- WCF, extensibility
- ClientCredentials class
- ClientCredentialsSecurityTokenManager class
ms.assetid: 0b06ce4e-7835-4d82-8baf-d525c71a0e49
ms.openlocfilehash: f95274861f58d1581e4c5439861ebf186b1b3489
ms.sourcegitcommit: 9b552addadfb57fab0b9e7852ed4f1f1b8a42f8e
ms.translationtype: HT
ms.contentlocale: tr-TR
ms.lasthandoff: 04/23/2019
ms.locfileid: "61766961"
---
# <a name="how-to-use-separate-x509-certificates-for-signing-and-encryption"></a><span data-ttu-id="12c76-102">Nasıl yapılır: İmzalama ve Şifreleme için Ayrı X.509 Sertifikaları Kullanma</span><span class="sxs-lookup"><span data-stu-id="12c76-102">How to: Use Separate X.509 Certificates for Signing and Encryption</span></span>
<span data-ttu-id="12c76-103">Bu konuda, Windows Communication Foundation (WCF) ileti imzalama ve şifreleme hem istemci hem de hizmet için farklı sertifikalar kullanmak üzere yapılandırma gösterilmektedir.</span><span class="sxs-lookup"><span data-stu-id="12c76-103">This topic shows how to configure Windows Communication Foundation (WCF) to use different certificates for message signing and encryption on both the client and service.</span></span>  
  
 <span data-ttu-id="12c76-104">WCF istemci veya hizmet birden çok sertifika ayarlamak için bir API sağlanmadığı için imzalama ve şifreleme için kullanılacak ayrı sertifikalar etkinleştirmek için özel bir istemci veya hizmet kimlik bilgilerini (veya her ikisi de) oluşturulması gerekir.</span><span class="sxs-lookup"><span data-stu-id="12c76-104">To enable separate certificates to be used for signing and encryption, a custom client or service credentials (or both) must be created because WCF does not provide an API to set multiple client or service certificates.</span></span> <span data-ttu-id="12c76-105">Ayrıca, birden çok sertifika bilgileri kullanmasına ve bir uygun güvenlik belirteci sağlayıcısı oluşturmak için anahtar kullanımı ve ileti yönü belirtilen belirteci yöneticisi sağlanmalıdır güvenlik.</span><span class="sxs-lookup"><span data-stu-id="12c76-105">Additionally, a security token manager must be provided to leverage the multiple certificates' information and to create an appropriate security token provider for specified key usage and message direction.</span></span>  
  
 <span data-ttu-id="12c76-106">Aşağıdaki diyagram, kullanılan ana sınıflarını göstermektedir, sınıfları (yukarıyı gösteren bir ok ile gösterilen) devralındığı ve dönüş türleri belirli yöntemleri ve özellikleri.</span><span class="sxs-lookup"><span data-stu-id="12c76-106">The following diagram shows the main classes used, the classes they inherit from (shown by an upward-pointing arrow), and the return types of certain methods and properties.</span></span>  
  
- <span data-ttu-id="12c76-107">`MyClientCredentials` özel bir uygulamasıdır <xref:System.ServiceModel.Description.ClientCredentials>.</span><span class="sxs-lookup"><span data-stu-id="12c76-107">`MyClientCredentials` is a custom implementation of <xref:System.ServiceModel.Description.ClientCredentials>.</span></span>  
  
    - <span data-ttu-id="12c76-108">Aşağıdaki diyagramda gösterilen tüm dönüş örneklerini özelliklerini <xref:System.Security.Cryptography.X509Certificates.X509Certificate2>.</span><span class="sxs-lookup"><span data-stu-id="12c76-108">Its properties shown in the diagram all return instances of <xref:System.Security.Cryptography.X509Certificates.X509Certificate2>.</span></span>  
  
    - <span data-ttu-id="12c76-109">Kendi yöntemi <xref:System.ServiceModel.Description.ClientCredentials.CreateSecurityTokenManager%2A> örneğini döndürür `MyClientCredentialsSecurityTokenManager`.</span><span class="sxs-lookup"><span data-stu-id="12c76-109">Its method <xref:System.ServiceModel.Description.ClientCredentials.CreateSecurityTokenManager%2A> returns an instance of `MyClientCredentialsSecurityTokenManager`.</span></span>  
  
- <span data-ttu-id="12c76-110">`MyClientCredentialsSecurityTokenManager` özel bir uygulamasıdır <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager>.</span><span class="sxs-lookup"><span data-stu-id="12c76-110">`MyClientCredentialsSecurityTokenManager` is a custom implementation of <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager>.</span></span>  
  
    - <span data-ttu-id="12c76-111">Kendi yöntemi <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager.CreateSecurityTokenProvider%2A> örneğini döndürür <xref:System.IdentityModel.Selectors.X509SecurityTokenProvider>.</span><span class="sxs-lookup"><span data-stu-id="12c76-111">Its method <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager.CreateSecurityTokenProvider%2A> returns an instance of <xref:System.IdentityModel.Selectors.X509SecurityTokenProvider>.</span></span>  
  
 <span data-ttu-id="12c76-112">![İstemci kimlik bilgileri nasıl kullanıldığını gösteren grafik](../../../../docs/framework/wcf/extending/media/e4971edd-a59f-4571-b36f-7e6b2f0d610f.gif "e4971edd-a59f-4571-b36f-7e6b2f0d610f")</span><span class="sxs-lookup"><span data-stu-id="12c76-112">![Chart showing how client credentials are used](../../../../docs/framework/wcf/extending/media/e4971edd-a59f-4571-b36f-7e6b2f0d610f.gif "e4971edd-a59f-4571-b36f-7e6b2f0d610f")</span></span>  
  
 <span data-ttu-id="12c76-113">Özel kimlik bilgileri hakkında daha fazla bilgi için bkz: [izlenecek yol: Özel istemci ve hizmet kimlik bilgilerini oluşturma](../../../../docs/framework/wcf/extending/walkthrough-creating-custom-client-and-service-credentials.md).</span><span class="sxs-lookup"><span data-stu-id="12c76-113">For more information about custom credentials, see [Walkthrough: Creating Custom Client and Service Credentials](../../../../docs/framework/wcf/extending/walkthrough-creating-custom-client-and-service-credentials.md).</span></span>  
  
 <span data-ttu-id="12c76-114">Ayrıca, bir özel kimlik doğrulayıcı oluşturma ve bir güvenlik bağlama öğesinin özel bir bağlama için bağlamanız gerekir.</span><span class="sxs-lookup"><span data-stu-id="12c76-114">In addition, you must create a custom identity verifier, and link it to a security binding element in a custom binding.</span></span> <span data-ttu-id="12c76-115">Varsayılan kimlik bilgileri yerine özel kimlik bilgilerini de kullanmanız gerekir.</span><span class="sxs-lookup"><span data-stu-id="12c76-115">You must also use the custom credentials instead of the default credentials.</span></span>  
  
 <span data-ttu-id="12c76-116">Aşağıdaki diyagramda sınıfları ilgili özel bağlama ve özel bir kimlik doğrulayıcı nasıl bağlı olduğu gösterilmektedir.</span><span class="sxs-lookup"><span data-stu-id="12c76-116">The following diagram shows the classes involved in the custom binding, and how the custom identity verifier is linked.</span></span> <span data-ttu-id="12c76-117">Her biri devral çeşitli bağlama öğesi karmaşık <xref:System.ServiceModel.Channels.BindingElement>.</span><span class="sxs-lookup"><span data-stu-id="12c76-117">There are several binding elements involved, all of which inherit from <xref:System.ServiceModel.Channels.BindingElement>.</span></span> <span data-ttu-id="12c76-118"><xref:System.ServiceModel.Channels.AsymmetricSecurityBindingElement> Sahip <xref:System.ServiceModel.Channels.LocalClientSecuritySettings> örneğini döndüren özellik <xref:System.ServiceModel.Security.IdentityVerifier>, içinden `MyIdentityVerifier` özelleştirilir.</span><span class="sxs-lookup"><span data-stu-id="12c76-118">The <xref:System.ServiceModel.Channels.AsymmetricSecurityBindingElement> has the <xref:System.ServiceModel.Channels.LocalClientSecuritySettings> property, which returns an instance of <xref:System.ServiceModel.Security.IdentityVerifier>, from which `MyIdentityVerifier` is customized.</span></span>  
  
 <span data-ttu-id="12c76-119">![Özel bağlama öğesini gösteren grafik](../../../../docs/framework/wcf/extending/media/dddea4a2-0bb4-4921-9bf4-20d4d82c3da5.gif "dddea4a2-0bb4-4921-9bf4-20d4d82c3da5")</span><span class="sxs-lookup"><span data-stu-id="12c76-119">![Chart showing a custom binding element](../../../../docs/framework/wcf/extending/media/dddea4a2-0bb4-4921-9bf4-20d4d82c3da5.gif "dddea4a2-0bb4-4921-9bf4-20d4d82c3da5")</span></span>  
  
 <span data-ttu-id="12c76-120">Özel bir kimlik doğrulayıcı oluşturma hakkında daha fazla bilgi için bkz: nasıl yapılır: [Nasıl yapılır: Özel İstemci Kimliği Doğrulayıcı oluşturma](../../../../docs/framework/wcf/extending/how-to-create-a-custom-client-identity-verifier.md).</span><span class="sxs-lookup"><span data-stu-id="12c76-120">For more information about creating a custom identity verifier, see How to: [How to: Create a Custom Client Identity Verifier](../../../../docs/framework/wcf/extending/how-to-create-a-custom-client-identity-verifier.md).</span></span>  
  
### <a name="to-use-separate-certificates-for-signing-and-encryption"></a><span data-ttu-id="12c76-121">İmzalama ve şifreleme için ayrı sertifikalar kullanmak için</span><span class="sxs-lookup"><span data-stu-id="12c76-121">To use separate certificates for signing and encryption</span></span>  
  
1. <span data-ttu-id="12c76-122">Devralan yeni bir istemci kimlik bilgileri sınıfı tanımlayın <xref:System.ServiceModel.Description.ClientCredentials> sınıfı.</span><span class="sxs-lookup"><span data-stu-id="12c76-122">Define a new client credentials class that inherits from the <xref:System.ServiceModel.Description.ClientCredentials> class.</span></span> <span data-ttu-id="12c76-123">Birden çok sertifika belirtimine izin vermek için dört yeni özellikler uygular: `ClientSigningCertificate`, `ClientEncryptingCertificate`, `ServiceSigningCertificate`, ve `ServiceEncryptingCertificate`.</span><span class="sxs-lookup"><span data-stu-id="12c76-123">Implement four new properties to allow multiple certificates specification: `ClientSigningCertificate`, `ClientEncryptingCertificate`, `ServiceSigningCertificate`, and `ServiceEncryptingCertificate`.</span></span> <span data-ttu-id="12c76-124">Ayrıca geçersiz <xref:System.ServiceModel.Description.ClientCredentials.CreateSecurityTokenManager%2A> özelleştirilmiş bir örneğini döndürülecek yöntemi <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager> sonraki adımda tanımlanan sınıfı.</span><span class="sxs-lookup"><span data-stu-id="12c76-124">Also override the <xref:System.ServiceModel.Description.ClientCredentials.CreateSecurityTokenManager%2A> method to return an instance of the customized <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager> class that is defined in the next step.</span></span>  
  
     [!code-csharp[c_FourCerts#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_fourcerts/cs/source.cs#1)]
     [!code-vb[c_FourCerts#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_fourcerts/vb/source.vb#1)]  
  
2. <span data-ttu-id="12c76-125">Devralan yeni bir istemci güvenlik belirteci yöneticisi tanımlamak <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager> sınıfı.</span><span class="sxs-lookup"><span data-stu-id="12c76-125">Define a new client security token manager that inherits from the <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager> class.</span></span> <span data-ttu-id="12c76-126">Geçersiz kılma <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager.CreateSecurityTokenProvider%2A> uygun güvenlik belirteci sağlayıcı oluşturma için yöntemi.</span><span class="sxs-lookup"><span data-stu-id="12c76-126">Override the <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager.CreateSecurityTokenProvider%2A> method to create an appropriate security token provider.</span></span> <span data-ttu-id="12c76-127">`requirement` Parametre (bir <xref:System.IdentityModel.Selectors.SecurityTokenRequirement>) ileti yönü ve anahtar kullanım sağlar.</span><span class="sxs-lookup"><span data-stu-id="12c76-127">The `requirement` parameter (a <xref:System.IdentityModel.Selectors.SecurityTokenRequirement>) provides the message direction and key usage.</span></span>  
  
     [!code-csharp[c_FourCerts#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_fourcerts/cs/source.cs#2)]
     [!code-vb[c_FourCerts#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_fourcerts/vb/source.vb#2)]  
  
3. <span data-ttu-id="12c76-128">Devralan yeni bir hizmet kimlik bilgilerini sınıfı tanımlayın <xref:System.ServiceModel.Description.ServiceCredentials> sınıfı.</span><span class="sxs-lookup"><span data-stu-id="12c76-128">Define a new service credentials class that inherits from the <xref:System.ServiceModel.Description.ServiceCredentials> class.</span></span> <span data-ttu-id="12c76-129">Birden çok sertifika belirtimine izin vermek için dört yeni özellikler uygular: `ClientSigningCertificate`, `ClientEncryptingCertificate`, `ServiceSigningCertificate`, ve `ServiceEncryptingCertificate`.</span><span class="sxs-lookup"><span data-stu-id="12c76-129">Implement four new properties to allow multiple certificates specification: `ClientSigningCertificate`, `ClientEncryptingCertificate`, `ServiceSigningCertificate`, and `ServiceEncryptingCertificate`.</span></span> <span data-ttu-id="12c76-130">Ayrıca geçersiz <xref:System.ServiceModel.Description.ServiceCredentials.CreateSecurityTokenManager%2A> özelleştirilmiş bir örneğini döndürülecek yöntemi <xref:System.ServiceModel.Security.ServiceCredentialsSecurityTokenManager> sonraki adımda tanımlanan sınıfı.</span><span class="sxs-lookup"><span data-stu-id="12c76-130">Also override the <xref:System.ServiceModel.Description.ServiceCredentials.CreateSecurityTokenManager%2A> method to return an instance of the customized <xref:System.ServiceModel.Security.ServiceCredentialsSecurityTokenManager> class that is defined in the next step.</span></span>  
  
     [!code-csharp[c_FourCerts#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_fourcerts/cs/source.cs#3)]
     [!code-vb[c_FourCerts#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_fourcerts/vb/source.vb#3)]  
  
4. <span data-ttu-id="12c76-131">Devralan yeni bir hizmet güvenlik belirteci yöneticisi tanımlamak <xref:System.ServiceModel.Security.ServiceCredentialsSecurityTokenManager> sınıfı.</span><span class="sxs-lookup"><span data-stu-id="12c76-131">Define a new service security token manager that inherits from the <xref:System.ServiceModel.Security.ServiceCredentialsSecurityTokenManager> class.</span></span> <span data-ttu-id="12c76-132">Geçersiz kılma <xref:System.ServiceModel.Security.ServiceCredentialsSecurityTokenManager.CreateSecurityTokenProvider%2A> gönderilen ileti yönü ve anahtar kullanım verilen uygun güvenlik belirteci sağlayıcı oluşturma için yöntemi.</span><span class="sxs-lookup"><span data-stu-id="12c76-132">Override the <xref:System.ServiceModel.Security.ServiceCredentialsSecurityTokenManager.CreateSecurityTokenProvider%2A> method to create an appropriate security token provider given the passed-in message direction and key usage.</span></span>  
  
     [!code-csharp[c_FourCerts#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_fourcerts/cs/source.cs#4)]
     [!code-vb[c_FourCerts#4](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_fourcerts/vb/source.vb#4)]  
  
### <a name="to-use-multiple-certificates-on-the-client"></a><span data-ttu-id="12c76-133">İstemci üzerinde birden çok sertifika kullanmak için</span><span class="sxs-lookup"><span data-stu-id="12c76-133">To use multiple certificates on the client</span></span>  
  
1. <span data-ttu-id="12c76-134">Özel bir bağlama oluşturun.</span><span class="sxs-lookup"><span data-stu-id="12c76-134">Create a custom binding.</span></span> <span data-ttu-id="12c76-135">Güvenlik bağlama öğesinin farklı güvenlik belirteci sağlayıcıları istekleri ve yanıtları için mevcut olması izin vermek için çift yönlü modda çalışmalıdır.</span><span class="sxs-lookup"><span data-stu-id="12c76-135">The security binding element must operate in duplex mode to allow different security token providers to be present for requests and responses.</span></span> <span data-ttu-id="12c76-136">Yapmanın bir yolu çift yönlü özellikli bir aktarım kullanın veya kullanmak için budur <xref:System.ServiceModel.Channels.CompositeDuplexBindingElement> aşağıdaki kodda gösterildiği gibi.</span><span class="sxs-lookup"><span data-stu-id="12c76-136">One way to do this is to use a duplex-capable transport or to use the <xref:System.ServiceModel.Channels.CompositeDuplexBindingElement> as shown in the following code.</span></span> <span data-ttu-id="12c76-137">Özelleştirilmiş bağlantı <xref:System.ServiceModel.Security.IdentityVerifier> sonraki adımda güvenlik bağlama öğesi için tanımlanmış.</span><span class="sxs-lookup"><span data-stu-id="12c76-137">Link the customized <xref:System.ServiceModel.Security.IdentityVerifier> which is defined in the next step to the security binding element.</span></span> <span data-ttu-id="12c76-138">Varsayılan istemci kimlik bilgileri, daha önce oluşturduğunuz özelleştirilmiş istemci kimlik bilgileri ile değiştirin.</span><span class="sxs-lookup"><span data-stu-id="12c76-138">Replace the default client credentials with the customized client credentials previously created.</span></span>  
  
     [!code-csharp[c_FourCerts#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_fourcerts/cs/source.cs#5)]
     [!code-vb[c_FourCerts#5](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_fourcerts/vb/source.vb#5)]  
  
2. <span data-ttu-id="12c76-139">Özel tanımlama <xref:System.ServiceModel.Security.IdentityVerifier>.</span><span class="sxs-lookup"><span data-stu-id="12c76-139">Define a custom <xref:System.ServiceModel.Security.IdentityVerifier>.</span></span> <span data-ttu-id="12c76-140">Hizmet birden çok kimlik sahip farklı bir sertifika isteği şifrelemek ve yanıt imzalamak için kullanılır.</span><span class="sxs-lookup"><span data-stu-id="12c76-140">The service has multiple identities because different certificates are used to encrypt the request and to sign the response.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="12c76-141">Aşağıdaki örnekte, tanıtım amacıyla denetimi herhangi bir uç noktası kimliği sağlanan özel bir kimlik doğrulayıcı gerçekleştirmez.</span><span class="sxs-lookup"><span data-stu-id="12c76-141">In the following sample, the provided custom identity verifier does not perform any endpoint identity checking for demonstration purposes.</span></span> <span data-ttu-id="12c76-142">Bu yöntem üretim kodu için önerilmez.</span><span class="sxs-lookup"><span data-stu-id="12c76-142">This is not recommended practice for production code.</span></span>  
  
     [!code-csharp[c_FourCerts#6](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_fourcerts/cs/source.cs#6)]
     [!code-vb[c_FourCerts#6](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_fourcerts/vb/source.vb#6)]  
  
### <a name="to-use-multiple-certificates-on-the-service"></a><span data-ttu-id="12c76-143">Hizmeti için kullanabileceğiniz birden fazla sertifika</span><span class="sxs-lookup"><span data-stu-id="12c76-143">To use multiple certificates on the service</span></span>  
  
1. <span data-ttu-id="12c76-144">Özel bir bağlama oluşturun.</span><span class="sxs-lookup"><span data-stu-id="12c76-144">Create a custom binding.</span></span> <span data-ttu-id="12c76-145">Güvenlik bağlama öğesinin farklı güvenlik belirteci sağlayıcıları istekleri ve yanıtları için mevcut olması izin vermek için bir çift yönlü modda çalışmalıdır.</span><span class="sxs-lookup"><span data-stu-id="12c76-145">The security binding element must operate in a duplex mode to allow different security token providers to be present for requests and responses.</span></span> <span data-ttu-id="12c76-146">İstemci ile çift yönlü özellikli bir aktarım kullanın veya kullanmak <xref:System.ServiceModel.Channels.CompositeDuplexBindingElement> aşağıdaki kodda gösterildiği gibi.</span><span class="sxs-lookup"><span data-stu-id="12c76-146">As with the client, use a duplex-capable transport or use <xref:System.ServiceModel.Channels.CompositeDuplexBindingElement> as shown in the following code.</span></span> <span data-ttu-id="12c76-147">Varsayılan hizmet kimlik bilgilerini, daha önce oluşturduğunuz özelleştirilmiş hizmet kimlik bilgileri ile değiştirin.</span><span class="sxs-lookup"><span data-stu-id="12c76-147">Replace the default service credentials with the customized service credentials previously created.</span></span>  
  
     [!code-csharp[c_FourCerts#7](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_fourcerts/cs/source.cs#7)]
     [!code-vb[c_FourCerts#7](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_fourcerts/vb/source.vb#7)]  
  
## <a name="see-also"></a><span data-ttu-id="12c76-148">Ayrıca bkz.</span><span class="sxs-lookup"><span data-stu-id="12c76-148">See also</span></span>

- <xref:System.ServiceModel.Description.ClientCredentials>
- <xref:System.ServiceModel.Description.ServiceCredentials>
- <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager>
- <xref:System.ServiceModel.Security.ServiceCredentialsSecurityTokenManager>
- <xref:System.ServiceModel.Security.IdentityVerifier>
- [<span data-ttu-id="12c76-149">İzlenecek yol: Özel istemci ve hizmet kimlik bilgilerini oluşturma</span><span class="sxs-lookup"><span data-stu-id="12c76-149">Walkthrough: Creating Custom Client and Service Credentials</span></span>](../../../../docs/framework/wcf/extending/walkthrough-creating-custom-client-and-service-credentials.md)
