---
title: Keşif Güvenliği Örneği
ms.date: 03/30/2017
ms.assetid: b8db01f4-b4a1-43fe-8e31-26d4e9304a65
ms.openlocfilehash: e956b9f8162d55891233a3ab664b05658d50eeab
ms.sourcegitcommit: 9b552addadfb57fab0b9e7852ed4f1f1b8a42f8e
ms.translationtype: HT
ms.contentlocale: tr-TR
ms.lasthandoff: 04/23/2019
ms.locfileid: "61773009"
---
# <a name="discovery-security-sample"></a><span data-ttu-id="b43be-102">Keşif Güvenliği Örneği</span><span class="sxs-lookup"><span data-stu-id="b43be-102">Discovery Security Sample</span></span>
<span data-ttu-id="b43be-103">Bulma belirtimi olmasını bulma işlemine katılmasını uç noktalarını güvenli gerektirmez.</span><span class="sxs-lookup"><span data-stu-id="b43be-103">The Discovery specification does not require that endpoints that participate in the discovery process to be secure.</span></span> <span data-ttu-id="b43be-104">Bulma iletileri ile güvenlik geliştirme azaltır çeşitli türdeki saldırıları (ileti değişikliğinin, hizmet reddi, yeniden yürütme, kimlik sahtekarlığı).</span><span class="sxs-lookup"><span data-stu-id="b43be-104">Enhancing the discovery messages with security mitigates various types of attacks (message alteration, denial of service, replay, spoofing).</span></span> <span data-ttu-id="b43be-105">Bu örnek, işlem ve (WS-bulma belirtiminin bölüm 8.2 içinde açıklanmıştır) compact imza biçimini kullanarak ileti imzaları doğrulamak özel kanallar uygular.</span><span class="sxs-lookup"><span data-stu-id="b43be-105">This sample implements custom channels that compute and verify message signatures using the compact signature format (described in Section 8.2 of the WS-Discovery specification).</span></span> <span data-ttu-id="b43be-106">Örnek her ikisini de destekler [2005 bulma belirtimi](https://go.microsoft.com/fwlink/?LinkId=177912) ve [1.1 sürümü](https://go.microsoft.com/fwlink/?LinkId=179677).</span><span class="sxs-lookup"><span data-stu-id="b43be-106">The sample supports both the [2005 Discovery specification](https://go.microsoft.com/fwlink/?LinkId=177912) and the [1.1 version](https://go.microsoft.com/fwlink/?LinkId=179677).</span></span>  
  
 <span data-ttu-id="b43be-107">Özel kanal, bulma ve duyuru uç noktalar için var olan kanal yığın üzerine uygulanır.</span><span class="sxs-lookup"><span data-stu-id="b43be-107">The custom channel is applied on top of the existing channel stack for Discovery and Announcement endpoints.</span></span> <span data-ttu-id="b43be-108">Bu şekilde, bir imza üst bilgisi gönderilen her ileti için uygulanır.</span><span class="sxs-lookup"><span data-stu-id="b43be-108">This way, a signature header is applied for every message sent.</span></span> <span data-ttu-id="b43be-109">İmza alınan iletiler üzerinde doğrulanır ve eşleşmiyor veya iletileri bir imzaya sahip değilse, iletileri bırakılır.</span><span class="sxs-lookup"><span data-stu-id="b43be-109">The signature is verified on received messages and when it does not match or when the messages do not have a signature, the messages are dropped.</span></span> <span data-ttu-id="b43be-110">Oturum ve iletileri doğrulamak için örnek sertifikaları kullanır.</span><span class="sxs-lookup"><span data-stu-id="b43be-110">To sign and verify messages, the sample uses certificates.</span></span>  
  
## <a name="discussion"></a><span data-ttu-id="b43be-111">Tartışma</span><span class="sxs-lookup"><span data-stu-id="b43be-111">Discussion</span></span>  
 <span data-ttu-id="b43be-112">WCF çok genişletilebilir ve kullanıcılara olasılığını kanalları istediğiniz şekilde özelleştirin.</span><span class="sxs-lookup"><span data-stu-id="b43be-112">WCF is very extensible and allows users the possibility to customize channels as desired.</span></span> <span data-ttu-id="b43be-113">Güvenli kanal oluşturan bir bulma güvenli bağlama öğesi örneği uygular.</span><span class="sxs-lookup"><span data-stu-id="b43be-113">The sample implements a discovery secure binding element that builds secure channels.</span></span> <span data-ttu-id="b43be-114">Güvenli kanal iletisi imzaları doğrulamak uygulamak ve geçerli yığının en üstünde uygulanır.</span><span class="sxs-lookup"><span data-stu-id="b43be-114">The secure channels apply and verify message signatures and are applied on top of the current stack.</span></span>  
  
 <span data-ttu-id="b43be-115">Güvenli bağlama öğesi, güvenli kanal fabrikaları ve kanal dinleyicisi oluşturur.</span><span class="sxs-lookup"><span data-stu-id="b43be-115">The secure binding element builds secure channel factories and channel listeners.</span></span>  
  
## <a name="secure-channel-factory"></a><span data-ttu-id="b43be-116">Güvenli kanal fabrikası</span><span class="sxs-lookup"><span data-stu-id="b43be-116">Secure Channel Factory</span></span>  
 <span data-ttu-id="b43be-117">Güvenli kanal fabrikası çıkış veya compact imza ileti üstbilgilerini eklemek çift yönlü kanalı oluşturur.</span><span class="sxs-lookup"><span data-stu-id="b43be-117">The secure channel factory creates output or duplex channels that add a compact signature to message headers.</span></span> <span data-ttu-id="b43be-118">İletileri compact İmza biçiminin olabildiğince küçük tutmak için kullanılır.</span><span class="sxs-lookup"><span data-stu-id="b43be-118">To keep messages as small as possible the compact signature format is used.</span></span> <span data-ttu-id="b43be-119">Aşağıdaki örnekte compact imza yapısı gösterilmektedir.</span><span class="sxs-lookup"><span data-stu-id="b43be-119">The structure of a compact signature is shown in the following example.</span></span>  
  
```xml  
<d:Security ... >   
  [<d:Sig Scheme="xs:anyURI"   
         [KeyId="xs:base64Binary"]?  
          Refs="..."  
         [PrefixList]="xs:NMTOKENS"   
          Sig="xs:base64Binary"   
          ... />]?  
  ...   
</d:Security>  
```  
  
> [!NOTE]
>  <span data-ttu-id="b43be-120">`PrefixList` 2008 bulma sürüm protokolünde eklendi.</span><span class="sxs-lookup"><span data-stu-id="b43be-120">The `PrefixList` was added in the 2008 Discovery version protocol.</span></span>  
  
 <span data-ttu-id="b43be-121">İmza hesaplamak için örnek genişletilmiş imza öğeleri belirler.</span><span class="sxs-lookup"><span data-stu-id="b43be-121">To compute the signature, the sample determines the expanded signature items.</span></span> <span data-ttu-id="b43be-122">Podpis XML (`SignedInfo`), kullanılarak oluşturulan `ds` WS-bulma belirtimi gerektirdiği gibi ad alanı öneki.</span><span class="sxs-lookup"><span data-stu-id="b43be-122">An XML signature (`SignedInfo`) is created, using the `ds` namespace prefix, as required by the WS-Discovery specification.</span></span> <span data-ttu-id="b43be-123">İle değiştirilmemesi için gövde ve bulma ve ad alanları addressing üst bilgileri imza ile başvurulur.</span><span class="sxs-lookup"><span data-stu-id="b43be-123">The body and all the headers in discovery and addressing namespaces are referenced in the signature, so they cannot be tampered with.</span></span> <span data-ttu-id="b43be-124">Başvurulan her öğenin özel Standartlaştırma kullanarak dönüştürülür (http://www.w3.org/2001/10/xml-exc-c14n# ), ve ardından bir SHA-1 Özet değer hesaplanır (http://www.w3.org/2000/09/xmldsig#sha1 ).</span><span class="sxs-lookup"><span data-stu-id="b43be-124">Each referenced element is transformed using the Exclusive Canonicalization (http://www.w3.org/2001/10/xml-exc-c14n# ), and then an SHA-1 digest value is computed (http://www.w3.org/2000/09/xmldsig#sha1 ).</span></span> <span data-ttu-id="b43be-125">Başvurulan tüm öğeleri ve Özet değerlerine bağlı olarak, imza değeri RSA algoritması kullanılarak hesaplanır (http://www.w3.org/2000/09/xmldsig#rsa-sha1 ).</span><span class="sxs-lookup"><span data-stu-id="b43be-125">Based on all referenced elements and their digest values, the signature value is computed using the RSA algorithm (http://www.w3.org/2000/09/xmldsig#rsa-sha1 ).</span></span>  
  
 <span data-ttu-id="b43be-126">İletileri, istemci tarafından belirtilen bir sertifika ile imzalanmış.</span><span class="sxs-lookup"><span data-stu-id="b43be-126">The messages are signed with a client-specified certificate.</span></span> <span data-ttu-id="b43be-127">Bağlama öğesi oluşturulduğunda, depolama konumu, adı ve sertifika konu adı belirtilmelidir.</span><span class="sxs-lookup"><span data-stu-id="b43be-127">The store location, name and the certificate subject name must be specified when the binding element is created.</span></span> <span data-ttu-id="b43be-128">`KeyId` Compact imzasında imzalama belirtecinin anahtar tanımlayıcısını temsil eder ve imzalama belirtecinin konu anahtar tanımlayıcısı (KAYAK) olan veya (KAYAK yoksa) bir ortak anahtar imzalama belirtecinin SHA-1 karması.</span><span class="sxs-lookup"><span data-stu-id="b43be-128">The `KeyId` in the compact signature represents the key identifier of the signing token and is the Subject Key Identifier (SKI) of the signing token or (if the SKI does not exist) a SHA-1 hash of the public key of the signing token.</span></span>  
  
## <a name="secure-channel-listener"></a><span data-ttu-id="b43be-129">Güvenli kanal dinleyicisi</span><span class="sxs-lookup"><span data-stu-id="b43be-129">Secure Channel Listener</span></span>  
 <span data-ttu-id="b43be-130">Güvenli kanal dinleyicisi compact imzasını alınan iletiler, giriş ya da çift yönlü kanalı oluşturur.</span><span class="sxs-lookup"><span data-stu-id="b43be-130">The secure channel listener creates input or duplex channels that verify the compact signature in received messages.</span></span> <span data-ttu-id="b43be-131">İmzayı doğrulamak için `KeyId` compact içinde belirtilen iletiye imza belirtilen deposundan bir sertifikayı seçmek için kullanılır.</span><span class="sxs-lookup"><span data-stu-id="b43be-131">To verify the signature, the `KeyId` specified in the compact signature attached to the message is used to select a certificate from the specified store.</span></span> <span data-ttu-id="b43be-132">İleti bir imzası yok veya imza denetimi başarısız olursa, iletileri bırakılır.</span><span class="sxs-lookup"><span data-stu-id="b43be-132">If the message does not have a signature or the signature check fails, the messages are dropped.</span></span> <span data-ttu-id="b43be-133">Güvenli bağlama kullanmak için özel oluşturan bir üreteci örneği tanımlar <xref:System.ServiceModel.Discovery.UdpDiscoveryEndpoint> ve <xref:System.ServiceModel.Discovery.UdpAnnouncementEndpoint> eklenen bulma güvenli bağlama öğesi.</span><span class="sxs-lookup"><span data-stu-id="b43be-133">To use the secure binding, the sample defines a factory that creates custom <xref:System.ServiceModel.Discovery.UdpDiscoveryEndpoint> and <xref:System.ServiceModel.Discovery.UdpAnnouncementEndpoint> with the added discovery secure binding element.</span></span> <span data-ttu-id="b43be-134">Bu güvenli uç noktaları, bulma duyuru dinleyicileri ve bulunabilirlik hizmetlerinde kullanılabilir.</span><span class="sxs-lookup"><span data-stu-id="b43be-134">These secure endpoints can be used in discovery announcement listeners and discoverable services.</span></span>  
  
## <a name="sample-details"></a><span data-ttu-id="b43be-135">Örnek Ayrıntıları</span><span class="sxs-lookup"><span data-stu-id="b43be-135">Sample Details</span></span>  
 <span data-ttu-id="b43be-136">Örnek, bir kitaplık ve 4 konsol uygulamaları içerir:</span><span class="sxs-lookup"><span data-stu-id="b43be-136">The sample includes a library and 4 console applications:</span></span>  
  
- <span data-ttu-id="b43be-137">**DiscoverySecurityChannels**: Güvenli bağlama sunan bir kitaplık.</span><span class="sxs-lookup"><span data-stu-id="b43be-137">**DiscoverySecurityChannels**: A library that exposes the secure binding.</span></span> <span data-ttu-id="b43be-138">Kitaplığı, hesaplar ve giden/gelen iletiler için compact imzayı doğrular.</span><span class="sxs-lookup"><span data-stu-id="b43be-138">The library computes and verifies the compact signature for outgoing/incoming messages.</span></span>  
  
- <span data-ttu-id="b43be-139">**Hizmet**: Kendi kendine barındırılan ICalculatorService sözleşmeyi doğrulamasıyla açığa çıkaran hizmet.</span><span class="sxs-lookup"><span data-stu-id="b43be-139">**Service**: A service exposing ICalculatorService contract, self hosted.</span></span> <span data-ttu-id="b43be-140">Hizmet bulunabilir işaretlenir.</span><span class="sxs-lookup"><span data-stu-id="b43be-140">The service is marked as Discoverable.</span></span> <span data-ttu-id="b43be-141">Kullanıcı depolama konumu ve adı ve konu adı veya diğer sertifika için benzersiz bir tanımlayıcı belirterek iletileri imzalamak için kullanılan sertifika ayrıntılarını belirtir ve istemci sertifikalarını nerede deposu (için kullanılan sertifikaları yer gelen iletiler için imza denetleyin).</span><span class="sxs-lookup"><span data-stu-id="b43be-141">The user specifies the details of the certificate used to sign messages by specifying the store location and name and the subject name or other unique identifier for the certificate, and the store where the client certificates are located (the certificates used to check signature for incoming messages).</span></span> <span data-ttu-id="b43be-142">Bu ayrıntılara bağlı olarak, bir UdpDiscoveryEndpoint eklenen güvenlik ile yerleşik olarak kullanılan ve.</span><span class="sxs-lookup"><span data-stu-id="b43be-142">Based on these details, a UdpDiscoveryEndpoint with added security is built and used.</span></span>  
  
- <span data-ttu-id="b43be-143">**İstemci**: Bu sınıf, bir ICalculatorService bulmak ve hizmet üzerinde yöntemleri çağırmak için çalışır.</span><span class="sxs-lookup"><span data-stu-id="b43be-143">**Client**: This class tries to discover an ICalculatorService and to call methods on the service.</span></span> <span data-ttu-id="b43be-144">Tekrar bir <xref:System.ServiceModel.Discovery.UdpDiscoveryEndpoint> ile güvenlik oluşturulur ve oturum açın ve iletileri doğrulamak için kullanılan eklendi.</span><span class="sxs-lookup"><span data-stu-id="b43be-144">Again, a <xref:System.ServiceModel.Discovery.UdpDiscoveryEndpoint> with added security is built and used to sign and verify the messages.</span></span>  
  
- <span data-ttu-id="b43be-145">**AnnouncementListener**: İçin çevrimiçi ve çevrimdışı duyuruları dinler ve güvenli bir duyuru uç noktası kullanan şirket içinde barındırılan bir hizmet.</span><span class="sxs-lookup"><span data-stu-id="b43be-145">**AnnouncementListener**: A self-hosted service that listens for online and offline announcements and uses the secure announcement endpoint.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="b43be-146">Setup.bat birden çok kez çalıştırılırsa, yinelenen sertifikalar bulunduğundan eklemek için bir sertifika seçmek için Sertifika Yöneticisi ister.</span><span class="sxs-lookup"><span data-stu-id="b43be-146">If Setup.bat is run multiple times, the certificate manager prompts you for choosing a certificate to add, as there are duplicate certificates.</span></span> <span data-ttu-id="b43be-147">Bu durumda, Setup.bat durduruldu ve yinelenen bir önceden oluşturulmuş olduğundan Cleanup.bat çağrılmalıdır.</span><span class="sxs-lookup"><span data-stu-id="b43be-147">In that case, Setup.bat should be aborted and Cleanup.bat should be called, because the duplicates have already been created.</span></span> <span data-ttu-id="b43be-148">CleanUp.bat silmek için bir sertifika seçmenizi ister.</span><span class="sxs-lookup"><span data-stu-id="b43be-148">Cleanup.bat also prompts you to choose a certificate to delete.</span></span> <span data-ttu-id="b43be-149">Listeden bir sertifika seçin ve sertifika kalan kadar Cleanup.bat yürütme devam edin.</span><span class="sxs-lookup"><span data-stu-id="b43be-149">Select a certificate from the list and continue executing Cleanup.bat until no certificates are remaining.</span></span>  
  
#### <a name="to-use-this-sample"></a><span data-ttu-id="b43be-150">Bu örneği kullanmak için</span><span class="sxs-lookup"><span data-stu-id="b43be-150">To use this sample</span></span>  
  
1. <span data-ttu-id="b43be-151">Setup.bat betiği Visual Studio için geliştirici komut isteminden çalıştırın.</span><span class="sxs-lookup"><span data-stu-id="b43be-151">Execute the Setup.bat script from a Developer Command Prompt for Visual Studio.</span></span> <span data-ttu-id="b43be-152">Örnek, oturum ve iletileri doğrulamak için sertifikaları kullanır.</span><span class="sxs-lookup"><span data-stu-id="b43be-152">The sample uses certificates to sign and verify messages.</span></span> <span data-ttu-id="b43be-153">Betik Makecert.exe ile bir sertifika oluşturur ve bunları yükler Certmgr.exe kullanarak.</span><span class="sxs-lookup"><span data-stu-id="b43be-153">The script creates the certificates using Makecert.exe and then installs them using Certmgr.exe.</span></span> <span data-ttu-id="b43be-154">Betik, yönetici ayrıcalıklarıyla çalıştırılmalıdır.</span><span class="sxs-lookup"><span data-stu-id="b43be-154">The script must be run with administrator privileges.</span></span>  
  
2. <span data-ttu-id="b43be-155">Derleme ve çalıştırma örneği için Security.sln dosyasını Visual Studio'da açın ve seçin **Rebuild All**.</span><span class="sxs-lookup"><span data-stu-id="b43be-155">To build and run the sample, open the Security.sln file in Visual Studio and choose **Rebuild All**.</span></span> <span data-ttu-id="b43be-156">Birden çok proje başlatmak için çözüm özellikleri güncelleştirin: seçin **Başlat** DiscoverySecureChannels dışındaki tüm projeler için.</span><span class="sxs-lookup"><span data-stu-id="b43be-156">Update the solution properties to start multiple projects: select **Start** for all projects except DiscoverySecureChannels.</span></span> <span data-ttu-id="b43be-157">Normalde çözümü çalıştırın.</span><span class="sxs-lookup"><span data-stu-id="b43be-157">Run the solution normally.</span></span>  
  
3. <span data-ttu-id="b43be-158">Örnek ile bitirdikten sonra bu örnek için oluşturulan sertifikalar kaldıran Cleanup.bat betiği yürütün.</span><span class="sxs-lookup"><span data-stu-id="b43be-158">After you are done with the sample, execute the Cleanup.bat script that removes the certificates created for this sample.</span></span>  
  
> [!IMPORTANT]
>  <span data-ttu-id="b43be-159">Örnekler, makinenizde zaten yüklü.</span><span class="sxs-lookup"><span data-stu-id="b43be-159">The samples may already be installed on your machine.</span></span> <span data-ttu-id="b43be-160">Devam etmeden önce şu (varsayılan) dizin denetleyin.</span><span class="sxs-lookup"><span data-stu-id="b43be-160">Check for the following (default) directory before continuing.</span></span>  
>   
>  `<InstallDrive>:\WF_WCF_Samples`  
>   
>  <span data-ttu-id="b43be-161">Bu dizin mevcut değilse Git [Windows Communication Foundation (WCF) ve .NET Framework 4 için Windows Workflow Foundation (WF) örnekleri](https://go.microsoft.com/fwlink/?LinkId=150780) tüm Windows Communication Foundation (WCF) indirmek için ve [!INCLUDE[wf1](../../../../includes/wf1-md.md)] örnekleri.</span><span class="sxs-lookup"><span data-stu-id="b43be-161">If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](https://go.microsoft.com/fwlink/?LinkId=150780) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples.</span></span> <span data-ttu-id="b43be-162">Bu örnek, şu dizinde bulunur.</span><span class="sxs-lookup"><span data-stu-id="b43be-162">This sample is located in the following directory.</span></span>  
>   
>  `<InstallDrive>:\WF_WCF_Samples\WCF\Scenario\DiscoveryScenario`  
