---
title: Sürüm 3.5 SP1’de HttpWebRequest için NTLM kimlik doğrulamasındaki değişiklikler
ms.date: 03/30/2017
ms.assetid: 8bf0b428-5a21-4299-8d6e-bf8251fd978a
ms.openlocfilehash: 388e6dc648e1fd68e24a852cb08de107f09f9c9f
ms.sourcegitcommit: 2701302a99cafbe0d86d53d540eb0fa7e9b46b36
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 04/28/2019
ms.locfileid: "64754885"
---
# <a name="changes-to-ntlm-authentication-for-httpwebrequest-in-version-35-sp1"></a><span data-ttu-id="7b12a-102">Sürüm 3.5 SP1’de HttpWebRequest için NTLM kimlik doğrulamasındaki değişiklikler</span><span class="sxs-lookup"><span data-stu-id="7b12a-102">Changes to NTLM authentication for HttpWebRequest in Version 3.5 SP1</span></span>

<span data-ttu-id="7b12a-103">Güvenlik değişiklikleri, .NET Framework sürüm 3.5 SP1 yapıldı ve tümleşik Windows kimlik doğrulaması tarafından işlenir, etkileyen daha sonra <xref:System.Net.HttpWebRequest>, <xref:System.Net.HttpListener>, <xref:System.Net.Security.NegotiateStream>, ve System.Net ad alanındaki ilgili sınıflar.</span><span class="sxs-lookup"><span data-stu-id="7b12a-103">Security changes were made in .NET Framework version 3.5 SP1 and later that affect how integrated Windows authentication is handled by the <xref:System.Net.HttpWebRequest>, <xref:System.Net.HttpListener>, <xref:System.Net.Security.NegotiateStream>, and related classes in the System.Net namespace.</span></span> <span data-ttu-id="7b12a-104">Bu değişiklikler, NTLM tabanlı Tümleşik Windows kimlik doğrulaması kullanıldığı web isteklerinde bulunmak ve yanıt almak için bu sınıfları kullanan uygulamaları etkileyebilir.</span><span class="sxs-lookup"><span data-stu-id="7b12a-104">These changes can affect applications that use these classes to make web requests and receive responses where integrated Windows authentication based on NTLM is used.</span></span> <span data-ttu-id="7b12a-105">Bu değişiklik, web sunucuları ve tümleşik Windows kimlik doğrulaması kullanmak üzere yapılandırılmış istemci uygulamaları etkileyebilir.</span><span class="sxs-lookup"><span data-stu-id="7b12a-105">This change can impact web servers and client applications that are configured to use integrated Windows authentication.</span></span>

## <a name="overview"></a><span data-ttu-id="7b12a-106">Genel Bakış</span><span class="sxs-lookup"><span data-stu-id="7b12a-106">Overview</span></span>

<span data-ttu-id="7b12a-107">Tümleşik Windows kimlik doğrulaması tasarımını bazı kimlik bilgisi yanıtlarının bunlar yeniden kullanılan veya iletilmesi yani evrensel olmasına izin verir.</span><span class="sxs-lookup"><span data-stu-id="7b12a-107">The design of integrated Windows authentication allows for some credential responses to be universal, meaning they can be re-used or forwarded.</span></span> <span data-ttu-id="7b12a-108">Ardından bu belirli tasarım özelliği gerekmiyorsa, kimlik doğrulama protokolleri kanal özgü bilgilerin yanı sıra hedef belirli bilgileri taşıyan.</span><span class="sxs-lookup"><span data-stu-id="7b12a-108">If this particular design feature is not needed, then the authentication protocols should carry target specific information as well as channel specific information.</span></span> <span data-ttu-id="7b12a-109">Hizmetleri, ardından kimlik bilgisi yanıtlarının hizmet belirli bilgileri gibi bir hizmet asıl adı (SPN) içerdiğinden emin olmak için genişletilmiş koruma sağlayabilir.</span><span class="sxs-lookup"><span data-stu-id="7b12a-109">Services can then provide extended protection to ensure that credential responses contain service specific information such as a Service Principal Name (SPN).</span></span> <span data-ttu-id="7b12a-110">Kimlik bilgisi değişimleri bu bilgilere sahip olarak Hizmetleri hatalı alındıktan kimlik bilgisi yanıtlarının kötü niyetli kullanımına karşı daha iyi koruma olanağına sahip olursunuz.</span><span class="sxs-lookup"><span data-stu-id="7b12a-110">With this information in the credential exchanges, services are able to better protect against malicious use of credential responses that might have been improperly obtained.</span></span>

<span data-ttu-id="7b12a-111">Birden çok bileşeni <xref:System.Net> ve <xref:System.Net.Security> ad alanları, çağıran bir uygulama adına tümleşik Windows kimlik doğrulaması gerçekleştirin.</span><span class="sxs-lookup"><span data-stu-id="7b12a-111">Multiple components in the <xref:System.Net> and <xref:System.Net.Security> namespaces perform integrated Windows authentication on behalf of a calling application.</span></span> <span data-ttu-id="7b12a-112">Bu bölümde, değişiklikleri genişletilmiş koruma, tümleşik Windows kimlik doğrulaması kullanımını eklemek için System.Net bileşenlerine açıklanmaktadır.</span><span class="sxs-lookup"><span data-stu-id="7b12a-112">This section describes changes to System.Net components to add extended protection in their use of integrated Windows authentication.</span></span>

## <a name="changes"></a><span data-ttu-id="7b12a-113">Değişiklikler</span><span class="sxs-lookup"><span data-stu-id="7b12a-113">Changes</span></span>

<span data-ttu-id="7b12a-114">Tümleşik Windows kimlik doğrulamasıyla NTLM kimlik doğrulama işlemi, hedef bilgisayar tarafından verilen ve istemci bilgisayarına geri gönderilen bir sınama içerir.</span><span class="sxs-lookup"><span data-stu-id="7b12a-114">The NTLM authentication process used with integrated Windows authentication includes a challenge issued by the destination computer and sent back to the client computer.</span></span> <span data-ttu-id="7b12a-115">Bir bilgisayarı kendi oluşturulan bir sınama aldığında, döngü geri bağlantının (127.0.0.1, örneğin IPv4 adresi) olmadığı sürece kimlik doğrulaması başarısız olur.</span><span class="sxs-lookup"><span data-stu-id="7b12a-115">When a computer receives a challenge it generated itself, the authentication will fail unless the connection is a loop back connection (IPv4 address 127.0.0.1, for example).</span></span>

<span data-ttu-id="7b12a-116">Bir iç Web sunucusunda çalışan bir hizmetin erişirken, benzer bir URL kullanarak hizmete erişmek için ortak `http://contoso/service` veya `https://contoso/service`.</span><span class="sxs-lookup"><span data-stu-id="7b12a-116">When accessing a service running on an internal Web server, it is common to access the service using a URL similar to `http://contoso/service` or `https://contoso/service`.</span></span> <span data-ttu-id="7b12a-117">"contoso" adı genellikle hizmet dağıtıldığı bilgisayarın bilgisayar adını değil.</span><span class="sxs-lookup"><span data-stu-id="7b12a-117">The name "contoso" is often not the computer name of the computer on which the service is deployed.</span></span> <span data-ttu-id="7b12a-118"><xref:System.Net> Ve ilgili ad alanlarını destekleyen kullanarak Active Directory, DNS, NetBIOS, yerel bilgisayarın hosts dosyasını (genellikle WINDOWS\system32\drivers\etc\hosts, örneğin) veya (genellikle WINDOWS\system32\ yerel bilgisayarın lmhosts dosyası Örneğin drivers\etc\lmhosts) adları adreslerine çözümleyebilir.</span><span class="sxs-lookup"><span data-stu-id="7b12a-118">The <xref:System.Net> and related namespaces support using Active Directory, DNS, NetBIOS, the local computer's hosts file (typically WINDOWS\system32\drivers\etc\hosts, for example), or the local computer's lmhosts file (typically WINDOWS\system32\drivers\etc\lmhosts, for example) to resolve names to addresses.</span></span> <span data-ttu-id="7b12a-119">Adı "contoso", "contoso" için gönderilen istekleri uygun sunucu bilgisayara gönderilir, böylece çözümlenir.</span><span class="sxs-lookup"><span data-stu-id="7b12a-119">The name "contoso" is resolved so that requests sent to "contoso" are sent to the appropriate server computer.</span></span>

<span data-ttu-id="7b12a-120">Büyük dağıtımlar için yapılandırıldığında, ayrıca bir tek bir sanal sunucu adı dağıtıma hiç istemci uygulamaları ve son kullanıcılar tarafından kullanılan temel alınan makine adları ile verilmesi yaygındır.</span><span class="sxs-lookup"><span data-stu-id="7b12a-120">When configured for large deployments, it is also common for a single virtual server name to be given to the deployment with the underlying machine names never used by client applications and end users.</span></span> <span data-ttu-id="7b12a-121">Örneğin, sunucunun çağırabilirsiniz `www.contoso.com`, ancak bir iç ağdaki yalnızca kullanabilirsiniz "contoso".</span><span class="sxs-lookup"><span data-stu-id="7b12a-121">For example, you might call the server `www.contoso.com`, but on an internal network simply use "contoso".</span></span> <span data-ttu-id="7b12a-122">Bu ad istemci web isteğinde ana bilgisayar üstbilgisi adı verilir.</span><span class="sxs-lookup"><span data-stu-id="7b12a-122">This name is called the Host header in the client web request.</span></span> <span data-ttu-id="7b12a-123">Belirtildiği gibi HTTP protokolü tarafından ana bilgisayar adı istek üstbilgisi alanı istenen kaynak Internet konak ve bağlantı noktası sayısını belirtir.</span><span class="sxs-lookup"><span data-stu-id="7b12a-123">As specified by the HTTP protocol, the Host request-header field specifies the Internet host and port number of the resource being requested.</span></span> <span data-ttu-id="7b12a-124">Bu bilgiler kullanıcı veya başvurulan kaynak (genellikle bir HTTP URL'si) tarafından verilen ve özgün bir URI elde edilir.</span><span class="sxs-lookup"><span data-stu-id="7b12a-124">This information is obtained from the original URI given by the user or referring resource (generally an HTTP URL).</span></span> <span data-ttu-id="7b12a-125">.NET Framework sürüm 4, bu bilgileri ayrıca kullanarak yeni istemci tarafından ayarlanabilir <xref:System.Net.HttpWebRequest.Host%2A> özelliği.</span><span class="sxs-lookup"><span data-stu-id="7b12a-125">On .NET Framework version 4, this information can also be set by the client using the new <xref:System.Net.HttpWebRequest.Host%2A> property.</span></span>

<span data-ttu-id="7b12a-126"><xref:System.Net.AuthenticationManager> Sınıfı tarafından kullanılan yönetilen kimlik doğrulama bileşenleri ("modülleri") denetler <xref:System.Net.WebRequest> türetilmiş sınıfları ve <xref:System.Net.WebClient> sınıfı.</span><span class="sxs-lookup"><span data-stu-id="7b12a-126">The <xref:System.Net.AuthenticationManager> class controls the managed authentication components ("modules") that are used by <xref:System.Net.WebRequest> derivative classes and the <xref:System.Net.WebClient> class.</span></span> <span data-ttu-id="7b12a-127"><xref:System.Net.AuthenticationManager> SAX kullanıma sunan bir özellik bir <xref:System.Net.AuthenticationManager.CustomTargetNameDictionary%2A?displayProperty=nameWithType> sağlamak üzere kimlik doğrulaması sırasında kullanılmak üzere özel bir SPN dizesi uygulamalar için URI dizesi tarafından dizine nesnesi.</span><span class="sxs-lookup"><span data-stu-id="7b12a-127">The <xref:System.Net.AuthenticationManager> class provides a property that exposes a <xref:System.Net.AuthenticationManager.CustomTargetNameDictionary%2A?displayProperty=nameWithType> object, indexed by URI string, for applications to supply a custom SPN string to be used during authentication.</span></span>

<span data-ttu-id="7b12a-128">Sürüm 3.5 SP1'i varsayılan ana bilgisayar adını belirtmek için bir SPN NTLM (NT LAN Yöneticisi) kimlik doğrulaması, istek URL'SİNDE kullanılan artık exchange <xref:System.Net.AuthenticationManager.CustomTargetNameDictionary%2A> özelliği ayarlı değil.</span><span class="sxs-lookup"><span data-stu-id="7b12a-128">Version 3.5 SP1 now defaults to specifying the host name used in the request URL in the SPN in the NTLM (NT LAN Manager) authentication exchange when the <xref:System.Net.AuthenticationManager.CustomTargetNameDictionary%2A> property is not set.</span></span> <span data-ttu-id="7b12a-129">İstek URL'SİNDE kullanılan ana bilgisayar adı belirtilen ana bilgisayar üst bilgisinden farklı <xref:System.Net.HttpRequestHeader?displayProperty=nameWithType> istemci isteğindeki.</span><span class="sxs-lookup"><span data-stu-id="7b12a-129">The host name used in the request URL may be different from the Host header specified in the <xref:System.Net.HttpRequestHeader?displayProperty=nameWithType> in the client request.</span></span> <span data-ttu-id="7b12a-130">İstek URL'SİNDE kullanılan ana bilgisayar adı, sunucunun gerçek ana bilgisayar adını, sunucu, bilgisayarın IP adresini veya geri döngü adresine makine adını farklı olabilir.</span><span class="sxs-lookup"><span data-stu-id="7b12a-130">The host name used in the request URL may be different from the actual host name of the server, the machine name of the server, the computer's IP address, or the loopback address.</span></span> <span data-ttu-id="7b12a-131">Bu durumlarda, Windows kimlik doğrulama isteği başarısız olur.</span><span class="sxs-lookup"><span data-stu-id="7b12a-131">In these cases, Windows will fail the authentication request.</span></span> <span data-ttu-id="7b12a-132">Sorunu gidermek için kullanılan ana bilgisayar adı Windows bildirmek gerekir, istemci istek URL'SİNDE ("contoso", örneğin) gerçekte yerel bilgisayar için farklı bir ad isteğidir.</span><span class="sxs-lookup"><span data-stu-id="7b12a-132">To address the issue, we need to notify Windows that the host name used in the request URL in the client request ("contoso", for example) is actually an alternate name for the local computer.</span></span>

<span data-ttu-id="7b12a-133">Bu değişikliği geçici çalışmak bir sunucu uygulaması için birkaç olası yöntem vardır.</span><span class="sxs-lookup"><span data-stu-id="7b12a-133">There are several possible methods for a server application to work around this change.</span></span> <span data-ttu-id="7b12a-134">İstek URL'si için kullanılan konak adını eşleştirmek için önerilen yaklaşımdır `BackConnectionHostNames` sunucunun kayıt defterinde anahtar.</span><span class="sxs-lookup"><span data-stu-id="7b12a-134">The recommended approach is to map the host name used in the request URL to the `BackConnectionHostNames` key in the registry on the server.</span></span> <span data-ttu-id="7b12a-135">`BackConnectionHostNames` Kayıt defteri anahtarı normalde bir ana bilgisayar adı için bir geri döngü adresine eşlemek için kullanılır.</span><span class="sxs-lookup"><span data-stu-id="7b12a-135">The `BackConnectionHostNames` registry key is normally used to map a host name to a loopback address.</span></span> <span data-ttu-id="7b12a-136">Adımları aşağıda listelenmiştir.</span><span class="sxs-lookup"><span data-stu-id="7b12a-136">The steps are listed below.</span></span>

<span data-ttu-id="7b12a-137">Geri döngü adresine eşlenir ve Web siteleri için yerel bir bilgisayara bağlanabilir, ana bilgisayar adlarını belirtmek için bu adımları izleyin:</span><span class="sxs-lookup"><span data-stu-id="7b12a-137">To specify the host names that are mapped to the loopback address and can connect to Web sites on a local computer, follow these steps:</span></span>

1. <span data-ttu-id="7b12a-138">Başlat'a tıklayın, Çalıştır'ı tıklatın, regedit yazın ve Tamam'a tıklayın.</span><span class="sxs-lookup"><span data-stu-id="7b12a-138">Click Start, click Run, type regedit, and then click OK.</span></span>

2. <span data-ttu-id="7b12a-139">Kayıt Defteri Düzenleyicisi'nde bulun ve aşağıdaki kayıt defteri anahtarı'ye tıklayın:</span><span class="sxs-lookup"><span data-stu-id="7b12a-139">In Registry Editor, locate and then click the following registry key:</span></span>

    `HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa\MSV1_0`

3. <span data-ttu-id="7b12a-140">Msv1_0 sağ tıklayın, yeni'yi işaretleyin ve çok dizeli değer'ye tıklayın.</span><span class="sxs-lookup"><span data-stu-id="7b12a-140">Right-click MSV1_0, point to New, and then click Multi-String Value.</span></span>

4. <span data-ttu-id="7b12a-141">Tür `BackConnectionHostNames`, ve ardından ENTER tuşuna basın.</span><span class="sxs-lookup"><span data-stu-id="7b12a-141">Type `BackConnectionHostNames`, and then press ENTER.</span></span>

5. <span data-ttu-id="7b12a-142">Sağ `BackConnectionHostNames`, Değiştir'i tıklatın.</span><span class="sxs-lookup"><span data-stu-id="7b12a-142">Right-click `BackConnectionHostNames`, and then click Modify.</span></span>

6. <span data-ttu-id="7b12a-143">Ana bilgisayar adı veya ana bilgisayar adlarını, yerel bilgisayarda ve Tamam'ı (istek URL'SİNDE kullanılan ana bilgisayar adı) siteler için değeri veri kutusuna yazın.</span><span class="sxs-lookup"><span data-stu-id="7b12a-143">In the Value data box, type the host name or the host names for the sites (the host name used in the request URL) that are on the local computer, and then click OK.</span></span>

7. <span data-ttu-id="7b12a-144">Kayıt Defteri Düzenleyicisi'nden çıkın ve ardından IISADMIN hizmetini yeniden başlatın ve Iısreset'i çalıştırın.</span><span class="sxs-lookup"><span data-stu-id="7b12a-144">Quit Registry Editor, and then restart the IISAdmin service and run IISReset.</span></span>

<span data-ttu-id="7b12a-145">Daha az güvenli bir iş yaklaşık döngü geri denetimi devre dışı bırakmak için açıklandığı olan <https://support.microsoft.com/kb/896861>.</span><span class="sxs-lookup"><span data-stu-id="7b12a-145">A less secure work around is to disable the loop back check, as described in <https://support.microsoft.com/kb/896861>.</span></span> <span data-ttu-id="7b12a-146">Bu yansıma saldırılara karşı koruma devre dışı bırakır.</span><span class="sxs-lookup"><span data-stu-id="7b12a-146">This disables the protection against reflection attacks.</span></span> <span data-ttu-id="7b12a-147">Bu nedenle yalnızca gerçekten kullandığınız makinenin beklediğiniz için alternatif adlar kümesini sınırlandırmak iyidir.</span><span class="sxs-lookup"><span data-stu-id="7b12a-147">So it is better to constrain the set of alternate names to only those you expect the machine to actually use.</span></span>

## <a name="see-also"></a><span data-ttu-id="7b12a-148">Ayrıca bkz.</span><span class="sxs-lookup"><span data-stu-id="7b12a-148">See also</span></span>

- <xref:System.Net.AuthenticationManager.CustomTargetNameDictionary%2A?displayProperty=nameWithType>
- <xref:System.Net.HttpRequestHeader?displayProperty=nameWithType>
- <xref:System.Net.HttpWebRequest.Host%2A?displayProperty=nameWithType>
