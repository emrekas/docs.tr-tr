---
title: Yönetilmeyen Kod İçin Güvenli Kodlama Yönergeleri
ms.date: 03/30/2017
helpviewer_keywords:
- code security, unmanaged code
- unmanaged code, securing
- security [.NET Framework], unmanaged code
- secure coding, unmanaged code
ms.assetid: a8d15139-d368-4c9c-a747-ba757781117c
author: mairaw
ms.author: mairaw
ms.openlocfilehash: cf9071f8b5c4569ace53b13f7b9b7282bf8e87c8
ms.sourcegitcommit: 6b308cf6d627d78ee36dbbae8972a310ac7fd6c8
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 01/23/2019
ms.locfileid: "54711979"
---
# <a name="secure-coding-guidelines-for-unmanaged-code"></a><span data-ttu-id="6dc72-102">Yönetilmeyen Kod İçin Güvenli Kodlama Yönergeleri</span><span class="sxs-lookup"><span data-stu-id="6dc72-102">Secure Coding Guidelines for Unmanaged Code</span></span>
<span data-ttu-id="6dc72-103">Yönetilmeyen kod (örneğin, yerel kod API'leri, Win32 gibi) çağırmak bazı kitaplık kodu gerekiyor.</span><span class="sxs-lookup"><span data-stu-id="6dc72-103">Some library code needs to call into unmanaged code (for example, native code APIs, such as Win32).</span></span> <span data-ttu-id="6dc72-104">Bu son yönetilen kod için güvenlik çevresi dışarıya gitme anlamına gelir çünkü dikkat gerekiyor.</span><span class="sxs-lookup"><span data-stu-id="6dc72-104">Because this means going outside the security perimeter for managed code, due caution is required.</span></span> <span data-ttu-id="6dc72-105">Tarafsız güvenlik kodunuz ise hem kodunuz hem de onu çağıran herhangi bir kod kod iznini yönetilmeyen gerekir (<xref:System.Security.Permissions.SecurityPermission> ile <xref:System.Security.Permissions.SecurityPermissionFlag.UnmanagedCode> belirtilmiş işareti).</span><span class="sxs-lookup"><span data-stu-id="6dc72-105">If your code is security-neutral, both your code and any code that calls it must have unmanaged code permission (<xref:System.Security.Permissions.SecurityPermission> with the <xref:System.Security.Permissions.SecurityPermissionFlag.UnmanagedCode> flag specified).</span></span>  
  
 <span data-ttu-id="6dc72-106">Ancak, genellikle, arayanın güçlü tür izinlere sahip olmasını mantıksız olur.</span><span class="sxs-lookup"><span data-stu-id="6dc72-106">However, it is often unreasonable for your caller to have such powerful permissions.</span></span> <span data-ttu-id="6dc72-107">Bu gibi durumlarda, güvenilen kod için yönetilen sarmalayıcı benzer aracılık olabilir veya kitaplık kodu açıklanan [sarmalayıcı kodunun güvenliğini sağlama](../../../docs/framework/misc/securing-wrapper-code.md).</span><span class="sxs-lookup"><span data-stu-id="6dc72-107">In such cases, your trusted code can be the go-between, similar to the managed wrapper or library code described in [Securing Wrapper Code](../../../docs/framework/misc/securing-wrapper-code.md).</span></span> <span data-ttu-id="6dc72-108">Temel alınan yönetilmeyen kod işlevselliğini tamamen güvenli olup olmadığını, doğrudan gösterilebilir; Aksi takdirde, uygun izne onay (isteğe bağlı) ilk gereklidir.</span><span class="sxs-lookup"><span data-stu-id="6dc72-108">If the underlying unmanaged code functionality is totally safe, it can be directly exposed; otherwise, a suitable permission check (demand) is required first.</span></span>  
  
 <span data-ttu-id="6dc72-109">Kodunuzu yönetilmeyen koda çağıran ancak yönetilmeyen koda erişim iznine sahip çağrı yapanların gerektirecek şekilde istemiyorsanız, bu hak onay gerekir.</span><span class="sxs-lookup"><span data-stu-id="6dc72-109">When your code calls into unmanaged code but you do not want to require your callers to have permission to access unmanaged code, you must assert that right.</span></span> <span data-ttu-id="6dc72-110">Yığın ilerlemesi, kare onaylama engeller.</span><span class="sxs-lookup"><span data-stu-id="6dc72-110">An assertion blocks the stack walk at your frame.</span></span> <span data-ttu-id="6dc72-111">Bu işlemde bir güvenlik açığı oluşturmayın dikkatli olmanız gerekir.</span><span class="sxs-lookup"><span data-stu-id="6dc72-111">You must be careful that you do not create a security hole in this process.</span></span> <span data-ttu-id="6dc72-112">Genellikle, bu, Arayanların, uygun bir izin talep ve ardından yalnızca ne izni verir ve artık gerçekleştirmek için yönetilmeyen kod kullanın anlamına gelir.</span><span class="sxs-lookup"><span data-stu-id="6dc72-112">Usually, this means that you must demand a suitable permission of your callers and then use unmanaged code to perform only what that permission allows and no more.</span></span> <span data-ttu-id="6dc72-113">Bazı durumlarda (örneğin, bir get günün saati işlevi) yönetilmeyen kod arayanlara tüm güvenlik denetimleri olmadan doğrudan sunulabilir.</span><span class="sxs-lookup"><span data-stu-id="6dc72-113">In some cases (for example, a get time-of-day function), unmanaged code can be directly exposed to callers without any security checks.</span></span> <span data-ttu-id="6dc72-114">Her iki durumda da onaylar herhangi bir kod, güvenlik sorumluluğunu üstlenmelidir.</span><span class="sxs-lookup"><span data-stu-id="6dc72-114">In any case, any code that asserts must take responsibility for security.</span></span>  
  
 <span data-ttu-id="6dc72-115">Yerel kod içine kod yolu sağlayan herhangi bir yönetilen kod için kötü amaçlı kod olası hedef olduğundan, hangi yönetilmeyen kod belirleme güvenli bir şekilde kullanılabilir ve son derece dikkatli olunmalıdır nasıl kullanılmalıdır gerektirir.</span><span class="sxs-lookup"><span data-stu-id="6dc72-115">Because any managed code that provides a code path into native code is a potential target for malicious code, determining which unmanaged code can be safely used and how it must be used requires extreme care.</span></span> <span data-ttu-id="6dc72-116">Genellikle, yönetilmeyen koda hiçbir zaman doğrudan kısmen güvenilen arayanlara açılmamalıdır.</span><span class="sxs-lookup"><span data-stu-id="6dc72-116">Generally, unmanaged code should never be directly exposed to partially trusted callers.</span></span> <span data-ttu-id="6dc72-117">Yönetilmeyen kod kısmen güvenilen kod tarafından çağrılabilir kitaplıkları kullanımda güvenliğini değerlendirme içinde iki birincil ilgili önemli noktalar vardır:</span><span class="sxs-lookup"><span data-stu-id="6dc72-117">There are two primary considerations in evaluating the safety of unmanaged code use in libraries that are callable by partially trusted code:</span></span>  
  
-   <span data-ttu-id="6dc72-118">**İşlevsellik**.</span><span class="sxs-lookup"><span data-stu-id="6dc72-118">**Functionality**.</span></span> <span data-ttu-id="6dc72-119">Yönetilmeyen API potansiyel olarak tehlikeli olabilecek işlemleri gerçekleştirmek bir çağırıcıya izin vermeyen bir işlevsellik sağlar mı?</span><span class="sxs-lookup"><span data-stu-id="6dc72-119">Does the unmanaged API provide functionality that does not allow callers to perform potentially dangerous operations?</span></span> <span data-ttu-id="6dc72-120">Kod erişimi güvenliği, kaynaklara erişim de uygular, böylece API dosyaları, bir kullanıcı arabirimi kullanıp kullanmadığını göz önünde bulundurun için izinleri kullanır veya iş parçacığı, veya bilgi korumalı olup olmadığını gösterir.</span><span class="sxs-lookup"><span data-stu-id="6dc72-120">Code access security uses permissions to enforce access to resources, so consider whether the API uses files, a user interface, or threading, or whether it exposes protected information.</span></span> <span data-ttu-id="6dc72-121">Aşması durumunda, sarmalama yönetilen koda izin vermeden önce gerekli izinleri talep gerekir.</span><span class="sxs-lookup"><span data-stu-id="6dc72-121">If it does, the managed code wrapping it must demand the necessary permissions before allowing it to be entered.</span></span> <span data-ttu-id="6dc72-122">Ayrıca, bir izin tarafından korunmayan olsa da bellek erişimi için katı tür güvenliği sýnýrlandýrýlmasýna gerekir.</span><span class="sxs-lookup"><span data-stu-id="6dc72-122">Additionally, while not protected by a permission, memory access must be confined to strict type safety.</span></span>  
  
-   <span data-ttu-id="6dc72-123">**Parametre denetimi**.</span><span class="sxs-lookup"><span data-stu-id="6dc72-123">**Parameter checking**.</span></span> <span data-ttu-id="6dc72-124">Yaygın bir saldırı geçişleri beklenmeyen parametreleri belirtimi dışında çalışmasına neden girişimi API yönetilmeyen kod yöntemleri açığa.</span><span class="sxs-lookup"><span data-stu-id="6dc72-124">A common attack passes unexpected parameters to exposed unmanaged code API methods in an attempt to cause them to operate out of specification.</span></span> <span data-ttu-id="6dc72-125">Aralık dışı dizin kullanarak arabellek taşmasına neden veya arka plandaki kod bir hata yararlanabilir herhangi bir parametre olarak uzaklık değerleri bu tür saldırılar, yaygın bir örneği değil.</span><span class="sxs-lookup"><span data-stu-id="6dc72-125">Buffer overruns using out-of-range index or offset values are one common example of this type of attack, as are any parameters that might exploit a bug in the underlying code.</span></span> <span data-ttu-id="6dc72-126">Yönetilmeyen kod API (sonra gerekli taleplerini) kısmen güvenilen için işlevsel olarak güvenli olsa bile, bu nedenle, çağıranlar, yönetilen gerekir ayrıca olsak da istenmeyen çağrı kötü amaçlı koddan yönetilen kullanarak mümkün olduğundan emin olmak için onay parametresi geçerlilik kod kod sarmalayıcı katmanı.</span><span class="sxs-lookup"><span data-stu-id="6dc72-126">Thus, even if the unmanaged code API is functionally safe (after necessary demands) for partially trusted callers, managed code must also check parameter validity exhaustively to ensure that no unintended calls are possible from malicious code using the managed code wrapper layer.</span></span>  
  
## <a name="using-suppressunmanagedcodesecurityattribute"></a><span data-ttu-id="6dc72-127">SuppressUnmanagedCodeSecurityAttribute Kullanma</span><span class="sxs-lookup"><span data-stu-id="6dc72-127">Using SuppressUnmanagedCodeSecurityAttribute</span></span>  
 <span data-ttu-id="6dc72-128">Sunduğundan ve ardından yönetilmeyen kod çağırmak için bir performans en boy yoktur.</span><span class="sxs-lookup"><span data-stu-id="6dc72-128">There is a performance aspect to asserting and then calling unmanaged code.</span></span> <span data-ttu-id="6dc72-129">Böyle her bir çağrı için güvenlik sistem otomatik olarak her zaman içinde bir yığın ilerlemesi kaynaklanan yönetilmeyen kod iznine ihtiyaç duyar.</span><span class="sxs-lookup"><span data-stu-id="6dc72-129">For every such call, the security system automatically demands unmanaged code permission, resulting in a stack walk each time.</span></span> <span data-ttu-id="6dc72-130">Assert ve hemen yönetilmeyen kod çağırmak, yığın ilerlemesi anlamsız olabilir:, onay ve yönetilmeyen kod aramanız oluşur.</span><span class="sxs-lookup"><span data-stu-id="6dc72-130">If you assert and immediately call unmanaged code, the stack walk can be meaningless: it consists of your assert and your unmanaged code call.</span></span>  
  
 <span data-ttu-id="6dc72-131">Özel bir öznitelik adında <xref:System.Security.SuppressUnmanagedCodeSecurityAttribute> talepleri normal güvenlik denetimi devre dışı bırakmak için yönetilmeyen kod giriş noktaları için uygulanabilir <xref:System.Security.Permissions.SecurityPermission> ile <xref:System.Security.Permissions.SecurityPermissionFlag.UnmanagedCode> belirtilen izni.</span><span class="sxs-lookup"><span data-stu-id="6dc72-131">A custom attribute called <xref:System.Security.SuppressUnmanagedCodeSecurityAttribute> can be applied to unmanaged code entry points to disable the normal security check that demands <xref:System.Security.Permissions.SecurityPermission> with the <xref:System.Security.Permissions.SecurityPermissionFlag.UnmanagedCode> permission specified.</span></span> <span data-ttu-id="6dc72-132">Son derece dikkatli olun, her zaman bu eylem, hiçbir çalışma zamanı güvenlik ile yönetilmeyen koda açık bir kapı oluşturduğundan, böylece denetlerken atılmalıdır.</span><span class="sxs-lookup"><span data-stu-id="6dc72-132">Extreme caution must always be taken when doing this, because this action creates an open door into unmanaged code with no runtime security checks.</span></span> <span data-ttu-id="6dc72-133">Not edilmesi gereken olsa da, **SuppressUnmanagedCodeSecurityAttribute** uygulanan, just-in-time (JIT) derleme şu anki çağırıcı çağırma izni olduğundan emin olmak için gerçekleşen tek seferlik güvenlik denetimi yok yönetilmeyen kod.</span><span class="sxs-lookup"><span data-stu-id="6dc72-133">It should be noted that even with **SuppressUnmanagedCodeSecurityAttribute** applied, there is a one-time security check that happens at just-in-time (JIT) compilation to ensure that the immediate caller has permission to call unmanaged code.</span></span>  
  
 <span data-ttu-id="6dc72-134">Kullanırsanız **SuppressUnmanagedCodeSecurityAttribute**, şu noktaları kontrol edin:</span><span class="sxs-lookup"><span data-stu-id="6dc72-134">If you use the **SuppressUnmanagedCodeSecurityAttribute**, check the following points:</span></span>  
  
-   <span data-ttu-id="6dc72-135">Yönetilmeyen kod girişi noktası iç ya da aksi takdirde, kodunuz dışında erişilemez olun.</span><span class="sxs-lookup"><span data-stu-id="6dc72-135">Make the unmanaged code entry point internal or otherwise inaccessible outside your code.</span></span>  
  
-   <span data-ttu-id="6dc72-136">Tüm çağrıların yönetilmeyen koda olası bir güvenlik açığı var.</span><span class="sxs-lookup"><span data-stu-id="6dc72-136">Any call into unmanaged code is a potential security hole.</span></span> <span data-ttu-id="6dc72-137">Kodunuzu dolaylı olarak yönetilmeyen koda çağrı ve güvenlik denetimi önlemek için kötü amaçlı kod için bir portal olmadığından emin olun.</span><span class="sxs-lookup"><span data-stu-id="6dc72-137">Make sure your code is not a portal for malicious code to indirectly call into unmanaged code and avoid a security check.</span></span> <span data-ttu-id="6dc72-138">Uygun izinleri talep.</span><span class="sxs-lookup"><span data-stu-id="6dc72-138">Demand permissions, if appropriate.</span></span>  
  
-   <span data-ttu-id="6dc72-139">Aşağıdaki bölümde açıklandığı gibi yönetilmeyen koda tehlikeli yol oluştururken açıkça tanımlamak için bir adlandırma kuralı kullanmak...</span><span class="sxs-lookup"><span data-stu-id="6dc72-139">Use a naming convention to explicitly identify when you are creating a dangerous path into unmanaged code, as described in the section below..</span></span>  
  
## <a name="naming-convention-for-unmanaged-code-methods"></a><span data-ttu-id="6dc72-140">Yönetilmeyen kod yöntemleri için adlandırma kuralı</span><span class="sxs-lookup"><span data-stu-id="6dc72-140">Naming convention for unmanaged code methods</span></span>  
 <span data-ttu-id="6dc72-141">Yönetilmeyen kod yöntemleri adlandırmak için kullanışlı ve yüksek oranda önerilen kuralı kuruldu.</span><span class="sxs-lookup"><span data-stu-id="6dc72-141">A useful and highly recommended convention has been established for naming unmanaged code methods.</span></span> <span data-ttu-id="6dc72-142">Tüm yönetilmeyen kod yöntemleri üç kategoriye ayrılır: **güvenli**, **yerel**, ve **güvenli**.</span><span class="sxs-lookup"><span data-stu-id="6dc72-142">All unmanaged code methods are separated into three categories: **safe**, **native**, and **unsafe**.</span></span> <span data-ttu-id="6dc72-143">Bu anahtar sözcükler çeşitli giriş noktaları yönetilmeyen kod içinde tanımlanmış sınıf adları kullanılabilir.</span><span class="sxs-lookup"><span data-stu-id="6dc72-143">These keywords can be used as class names within which the various kinds of unmanaged code entry points are defined.</span></span> <span data-ttu-id="6dc72-144">Kaynak kodunda bu anahtar sözcükler sınıf adı olarak eklenmesi gereken `Safe.GetTimeOfDay`, `Native.Xyz`, veya `Unsafe.DangerousAPI`, örneğin.</span><span class="sxs-lookup"><span data-stu-id="6dc72-144">In source code, these keywords should be added to the class name, as in `Safe.GetTimeOfDay`, `Native.Xyz`, or `Unsafe.DangerousAPI`, for example.</span></span> <span data-ttu-id="6dc72-145">Aşağıdaki tabloda açıklandığı gibi her bu anahtar sözcüklerden biri bu sınıfı kullanan geliştiriciler için yararlı bir güvenlik bilgileri sağlar.</span><span class="sxs-lookup"><span data-stu-id="6dc72-145">Each of these keywords provides useful security information for developers using that class, as described in the following table.</span></span>  
  
|<span data-ttu-id="6dc72-146">Anahtar sözcüğü</span><span class="sxs-lookup"><span data-stu-id="6dc72-146">Keyword</span></span>|<span data-ttu-id="6dc72-147">Güvenlik konuları</span><span class="sxs-lookup"><span data-stu-id="6dc72-147">Security considerations</span></span>|  
|-------------|-----------------------------|  
|<span data-ttu-id="6dc72-148">**Güvenli**</span><span class="sxs-lookup"><span data-stu-id="6dc72-148">**safe**</span></span>|<span data-ttu-id="6dc72-149">Tamamen herhangi kod için çağrılacak bile kötü amaçlı kod zararsız.</span><span class="sxs-lookup"><span data-stu-id="6dc72-149">Completely harmless for any code, even malicious code, to call.</span></span> <span data-ttu-id="6dc72-150">Yalnızca diğer yönetilen kod gibi kullanılabilir.</span><span class="sxs-lookup"><span data-stu-id="6dc72-150">Can be used just like other managed code.</span></span> <span data-ttu-id="6dc72-151">Örneğin, günün saatini alır bir işlev genellikle güvenlidir.</span><span class="sxs-lookup"><span data-stu-id="6dc72-151">For example, a function that gets the time of day is typically safe.</span></span>|  
|<span data-ttu-id="6dc72-152">**Yerel**</span><span class="sxs-lookup"><span data-stu-id="6dc72-152">**native**</span></span>|<span data-ttu-id="6dc72-153">Güvenlik-nötr; diğer bir deyişle, gerektiren yönetilmeyen kod çağırmak için kod iznini yönetilmeyen.</span><span class="sxs-lookup"><span data-stu-id="6dc72-153">Security-neutral; that is, unmanaged code that requires unmanaged code permission to call.</span></span> <span data-ttu-id="6dc72-154">Güvenlik, yetkisiz bir çağıranın vermemeye denetlenir.</span><span class="sxs-lookup"><span data-stu-id="6dc72-154">Security is checked, which stops an unauthorized caller.</span></span>|  
|<span data-ttu-id="6dc72-155">**unsafe**</span><span class="sxs-lookup"><span data-stu-id="6dc72-155">**unsafe**</span></span>|<span data-ttu-id="6dc72-156">Giriş noktasıyla gizlenen güvenlik tehlikeli yönetilmeyen kod.</span><span class="sxs-lookup"><span data-stu-id="6dc72-156">Potentially dangerous unmanaged code entry point with security suppressed.</span></span> <span data-ttu-id="6dc72-157">Geliştiricilerin en dikkat gibi yönetilmeyen kod kullanarak başka bir güvenlik açığını önlemek için korumaların emin emin kullanması gerekir.</span><span class="sxs-lookup"><span data-stu-id="6dc72-157">Developers should use the greatest caution when using such unmanaged code, making sure that other protections are in place to prevent a security vulnerability.</span></span> <span data-ttu-id="6dc72-158">Bu anahtar sözcük güvenlik sistemi geçersiz kılar. geliştiriciler sorumlu olması gerekir.</span><span class="sxs-lookup"><span data-stu-id="6dc72-158">Developers must be responsible, as this keyword overrides the security system.</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="6dc72-159">Ayrıca bkz.</span><span class="sxs-lookup"><span data-stu-id="6dc72-159">See also</span></span>
- [<span data-ttu-id="6dc72-160">Güvenli Kodlama Yönergeleri</span><span class="sxs-lookup"><span data-stu-id="6dc72-160">Secure Coding Guidelines</span></span>](../../../docs/standard/security/secure-coding-guidelines.md)
