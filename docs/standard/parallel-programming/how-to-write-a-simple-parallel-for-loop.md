---
title: 'Nasıl yapılır: Basit bir Parallel.For Döngüsü Yazma'
ms.date: 03/30/2017
ms.technology: dotnet-standard
dev_langs:
- csharp
- vb
helpviewer_keywords:
- Parallel.For, How to Write
- for loop, parallel construction in .NET
- parallel for loops, how to use
ms.assetid: 9029ba7f-a9d1-4526-8c84-c88716dba5d4
author: rpetrusha
ms.author: ronpet
ms.openlocfilehash: f2070562ba0910b5cac951e925bd9c5f0e7f68fb
ms.sourcegitcommit: 9b552addadfb57fab0b9e7852ed4f1f1b8a42f8e
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 04/23/2019
ms.locfileid: "61769193"
---
# <a name="how-to-write-a-simple-parallelfor-loop"></a><span data-ttu-id="2ded5-102">Nasıl yapılır: Basit bir Parallel.For Döngüsü Yazma</span><span class="sxs-lookup"><span data-stu-id="2ded5-102">How to: Write a Simple Parallel.For Loop</span></span>

<span data-ttu-id="2ded5-103">Bu konuda gösteren iki örnek içeren <xref:System.Threading.Tasks.Parallel.For%2A?displayProperty=nameWithType> yöntemi.</span><span class="sxs-lookup"><span data-stu-id="2ded5-103">This topic contains two examples that illustrate the <xref:System.Threading.Tasks.Parallel.For%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="2ded5-104">İlk kullandığı <xref:System.Threading.Tasks.Parallel.For%28System.Int64%2CSystem.Int64%2CSystem.Action%7BSystem.Int64%7D%29?displayProperty=nameWithType> yöntemi aşırı yüklemesini ve ikinci kullandığı <xref:System.Threading.Tasks.Parallel.For%28System.Int32%2CSystem.Int32%2CSystem.Action%7BSystem.Int32%7D%29?displayProperty=nameWithType> aşırı yüklemesi, iki basit aşırı yüklemeleri <xref:System.Threading.Tasks.Parallel.For%2A?displayProperty=nameWithType> yöntemi.</span><span class="sxs-lookup"><span data-stu-id="2ded5-104">The first uses the <xref:System.Threading.Tasks.Parallel.For%28System.Int64%2CSystem.Int64%2CSystem.Action%7BSystem.Int64%7D%29?displayProperty=nameWithType> method overload, and the second uses the <xref:System.Threading.Tasks.Parallel.For%28System.Int32%2CSystem.Int32%2CSystem.Action%7BSystem.Int32%7D%29?displayProperty=nameWithType> overload, the two simplest overloads of the <xref:System.Threading.Tasks.Parallel.For%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="2ded5-105">Bu iki aşırı yüklemesini kullanabilirsiniz <xref:System.Threading.Tasks.Parallel.For%2A?displayProperty=nameWithType> döngü iptal etmek gerekmediğinde yöntemi sonu dışında döngü yinelemesi veya herhangi bir iş parçacığı-yerel durumu korumak.</span><span class="sxs-lookup"><span data-stu-id="2ded5-105">You can use these two overloads of the <xref:System.Threading.Tasks.Parallel.For%2A?displayProperty=nameWithType> method when you do not need to cancel the loop, break out of the loop iterations, or maintain any thread-local state.</span></span>

> [!NOTE]
> <span data-ttu-id="2ded5-106">TPL'de temsilciler tanımlamak için bu belgede lambda ifadeleri kullanılır.</span><span class="sxs-lookup"><span data-stu-id="2ded5-106">This documentation uses lambda expressions to define delegates in TPL.</span></span> <span data-ttu-id="2ded5-107">C# veya Visual Basic'te lambda ifadelerine aşina değilseniz bkz [PLINQ ve TPL'deki Lambda ifadeleri](../../../docs/standard/parallel-programming/lambda-expressions-in-plinq-and-tpl.md).</span><span class="sxs-lookup"><span data-stu-id="2ded5-107">If you are not familiar with lambda expressions in C# or Visual Basic, see [Lambda Expressions in PLINQ and TPL](../../../docs/standard/parallel-programming/lambda-expressions-in-plinq-and-tpl.md).</span></span>

<span data-ttu-id="2ded5-108">İlk örnek, tek bir dizindeki dosyaların boyutunu hesaplar.</span><span class="sxs-lookup"><span data-stu-id="2ded5-108">The first example calculates the size of files in a single directory.</span></span> <span data-ttu-id="2ded5-109">İkinci iki matrislerde çarpımını hesaplar.</span><span class="sxs-lookup"><span data-stu-id="2ded5-109">The second computes the product of two matrices.</span></span>

## <a name="directory-size-example"></a><span data-ttu-id="2ded5-110">Dizin boyutu örneği</span><span class="sxs-lookup"><span data-stu-id="2ded5-110">Directory size example</span></span>

<span data-ttu-id="2ded5-111">Bu örnek, bir dizindeki dosyaların toplam boyutu hesaplar basit bir komut satırı yardımcı programıdır.</span><span class="sxs-lookup"><span data-stu-id="2ded5-111">This example is a simple command-line utility that calculates the total size of files in a directory.</span></span> <span data-ttu-id="2ded5-112">Bağımsız değişken olarak tek bir dizin yolu bekliyor ve sayısı ve bu dizindeki dosyaların toplam boyutu raporlar.</span><span class="sxs-lookup"><span data-stu-id="2ded5-112">It expects a single directory path as an argument, and reports the number and total size of the files in that directory.</span></span> <span data-ttu-id="2ded5-113">Dizinin mevcut olduğunu doğruladıktan sonra bunu kullanan <xref:System.Threading.Tasks.Parallel.For%2A?displayProperty=nameWithType> dizindeki dosyaları numaralandırma ve kendi dosya boyutunu belirlemek için yöntem.</span><span class="sxs-lookup"><span data-stu-id="2ded5-113">After verifying that the directory exists, it uses the <xref:System.Threading.Tasks.Parallel.For%2A?displayProperty=nameWithType> method to enumerate the files in the directory and determine their file sizes.</span></span> <span data-ttu-id="2ded5-114">Her bir dosya boyutu daha sonra eklenen `totalSize` değişkeni.</span><span class="sxs-lookup"><span data-stu-id="2ded5-114">Each file size is then added to the `totalSize` variable.</span></span> <span data-ttu-id="2ded5-115">Ayrıca çağrılarak gerçekleştirilir Not <xref:System.Threading.Interlocked.Add%2A?displayProperty=nameWithType> böylece ek bir atomik işlem olarak gerçekleştirilir.</span><span class="sxs-lookup"><span data-stu-id="2ded5-115">Note that the addition is performed by calling the <xref:System.Threading.Interlocked.Add%2A?displayProperty=nameWithType> so that the addition is performed as an atomic operation.</span></span> <span data-ttu-id="2ded5-116">Aksi takdirde, birden çok görevi güncelleştirmek çalışabilir `totalSize` değişken aynı anda.</span><span class="sxs-lookup"><span data-stu-id="2ded5-116">Otherwise, multiple tasks could try to update the `totalSize` variable simultaneously.</span></span>

[!code-csharp[Conceptual.Parallel.For#1](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.parallel.for/cs/for1.cs#1)]
[!code-vb[Conceptual.Parallel.For#1](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.parallel.for/vb/for1.vb#1)]

## <a name="matrix-and-stopwatch-example"></a><span data-ttu-id="2ded5-117">Matris ve kronometre örneği</span><span class="sxs-lookup"><span data-stu-id="2ded5-117">Matrix and stopwatch example</span></span>

<span data-ttu-id="2ded5-118">Bu örnekte <xref:System.Threading.Tasks.Parallel.For%2A?displayProperty=nameWithType> iki matrislerde çarpımını için yöntemi.</span><span class="sxs-lookup"><span data-stu-id="2ded5-118">This example uses the <xref:System.Threading.Tasks.Parallel.For%2A?displayProperty=nameWithType> method to compute the product of two matrices.</span></span> <span data-ttu-id="2ded5-119">Ayrıca nasıl kullanılacağını gösterir <xref:System.Diagnostics.Stopwatch?displayProperty=nameWithType> paralel olmayan döngü ile paralel bir döngüden performansını karşılaştırmak için sınıf.</span><span class="sxs-lookup"><span data-stu-id="2ded5-119">It also shows how to use the <xref:System.Diagnostics.Stopwatch?displayProperty=nameWithType> class to compare the performance of a parallel loop with a non-parallel loop.</span></span> <span data-ttu-id="2ded5-120">Çıkış büyük hacimli oluşturabileceğinden, örnek çıkış bir dosyaya yönlendirilmesi verdiğini unutmayın.</span><span class="sxs-lookup"><span data-stu-id="2ded5-120">Note that, because it can generate a large volume of output, the example allows output to be redirected to a file.</span></span>

[!code-csharp[TPL_Parallel#01](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl_parallel/cs/simpleparallelfor.cs#01)]
[!code-vb[TPL_Parallel#01](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_parallel/vb/simpleparallelfor.vb#01)]

<span data-ttu-id="2ded5-121">Döngüler, dahil olmak üzere herhangi bir kod paralelleştirmek önemli amaçlarından burada herhangi bir performans avantaj paralel işleme yükü olumsuz duruma getirir noktasına paralelleştirmek üzerinden işlemci olmadan mümkün olduğunca yararlanmak için andır.</span><span class="sxs-lookup"><span data-stu-id="2ded5-121">When parallelizing any code, including loops, one important goal is to utilize the processors as much as possible without over parallelizing to the point where the overhead for parallel processing negates any performance benefits.</span></span> <span data-ttu-id="2ded5-122">Bu örnekte, iç döngü içinde gerçekleştirilen çok iş olmadığından yalnızca dış döngü paralelleştirildi.</span><span class="sxs-lookup"><span data-stu-id="2ded5-122">In this particular example, only the outer loop is parallelized because there is not very much work performed in the inner loop.</span></span> <span data-ttu-id="2ded5-123">Az miktarda iş ve istenmeyen önbellek etkileri birleşimi iç içe geçmiş paralel Döngülerde performans düşüşüne neden olabilir.</span><span class="sxs-lookup"><span data-stu-id="2ded5-123">The combination of a small amount of work and undesirable cache effects can result in performance degradation in nested parallel loops.</span></span> <span data-ttu-id="2ded5-124">Bu nedenle, dış döngü paralelleştirmek yalnızca çoğu sistemde yararlarını en üst düzeye çıkarmak için en iyi yoludur.</span><span class="sxs-lookup"><span data-stu-id="2ded5-124">Therefore, parallelizing the outer loop only is the best way to maximize the benefits of concurrency on most systems.</span></span>

## <a name="the-delegate"></a><span data-ttu-id="2ded5-125">Temsilci</span><span class="sxs-lookup"><span data-stu-id="2ded5-125">The Delegate</span></span>

<span data-ttu-id="2ded5-126">Bu aşırı yüklemesi, üçüncü parametresinin <xref:System.Threading.Tasks.Parallel.For%2A> bir temsilci türü `Action<int>` C# veya `Action(Of Integer)` Visual Basic'te.</span><span class="sxs-lookup"><span data-stu-id="2ded5-126">The third parameter of this overload of <xref:System.Threading.Tasks.Parallel.For%2A> is a delegate of type `Action<int>` in C# or `Action(Of Integer)` in Visual Basic.</span></span> <span data-ttu-id="2ded5-127">Bir `Action` temsilcisi, sıfır, bir veya altı tür parametreleri, sahip olup olmadığını her zaman döndürür void.</span><span class="sxs-lookup"><span data-stu-id="2ded5-127">An `Action` delegate, whether it has zero, one or sixteen type parameters, always returns void.</span></span> <span data-ttu-id="2ded5-128">Visual Basic'te davranışını bir `Action` ile tanımlanmış bir `Sub`.</span><span class="sxs-lookup"><span data-stu-id="2ded5-128">In Visual Basic, the behavior of an `Action` is defined with a `Sub`.</span></span> <span data-ttu-id="2ded5-129">Örnek, bir temsilci oluşturmak için bir lambda ifadesi kullanır. ancak, temsilci başka yöntemlerle de oluşturabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="2ded5-129">The example uses a lambda expression to create the delegate, but you can create the delegate in other ways as well.</span></span> <span data-ttu-id="2ded5-130">Daha fazla bilgi için [PLINQ ve TPL'deki Lambda ifadeleri](../../../docs/standard/parallel-programming/lambda-expressions-in-plinq-and-tpl.md).</span><span class="sxs-lookup"><span data-stu-id="2ded5-130">For more information, see [Lambda Expressions in PLINQ and TPL](../../../docs/standard/parallel-programming/lambda-expressions-in-plinq-and-tpl.md).</span></span>

## <a name="the-iteration-value"></a><span data-ttu-id="2ded5-131">Yineleme değeri</span><span class="sxs-lookup"><span data-stu-id="2ded5-131">The Iteration Value</span></span>

<span data-ttu-id="2ded5-132">Temsilci geçerli yineleme değeri olan tek bir giriş parametresi alır.</span><span class="sxs-lookup"><span data-stu-id="2ded5-132">The delegate takes a single input parameter whose value is the current iteration.</span></span> <span data-ttu-id="2ded5-133">Bu yineleme değeri çalışma zamanı tarafından sağlanan ve başlangıç değeri geçerli iş parçacığı üzerinde işlenmekte olan kaynağı segmentine (bölüm) ilk öğenin dizinidir.</span><span class="sxs-lookup"><span data-stu-id="2ded5-133">This iteration value is supplied by the runtime and its starting value is the index of the first element on the segment (partition) of the source that is being processed on the current thread.</span></span>

<span data-ttu-id="2ded5-134">Eşzamanlılık düzeyi hakkında daha fazla denetime ihtiyacınız varsa, alan aşırı kullanan bir <xref:System.Threading.Tasks.ParallelOptions?displayProperty=nameWithType> gibi giriş parametresi: <xref:System.Threading.Tasks.Parallel.For%28System.Int32%2CSystem.Int32%2CSystem.Threading.Tasks.ParallelOptions%2CSystem.Action%7BSystem.Int32%2CSystem.Threading.Tasks.ParallelLoopState%7D%29?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="2ded5-134">If you require more control over the concurrency level, use one of the overloads that takes a <xref:System.Threading.Tasks.ParallelOptions?displayProperty=nameWithType> input parameter, such as: <xref:System.Threading.Tasks.Parallel.For%28System.Int32%2CSystem.Int32%2CSystem.Threading.Tasks.ParallelOptions%2CSystem.Action%7BSystem.Int32%2CSystem.Threading.Tasks.ParallelLoopState%7D%29?displayProperty=nameWithType>.</span></span>

## <a name="return-value-and-exception-handling"></a><span data-ttu-id="2ded5-135">Dönüş değeri ve özel durum işleme</span><span class="sxs-lookup"><span data-stu-id="2ded5-135">Return Value and Exception Handling</span></span>

<span data-ttu-id="2ded5-136"><xref:System.Threading.Tasks.Parallel.For%2A> döndürür bir <xref:System.Threading.Tasks.ParallelLoopResult?displayProperty=nameWithType> tüm iş parçacıklarının tamamladıktan sonra nesne.</span><span class="sxs-lookup"><span data-stu-id="2ded5-136"><xref:System.Threading.Tasks.Parallel.For%2A> returns a <xref:System.Threading.Tasks.ParallelLoopResult?displayProperty=nameWithType> object when all threads have completed.</span></span> <span data-ttu-id="2ded5-137">Bu dönüş değeri olduğundan yararlı, durdurma veya kesme döngü yinelemesi el ile <xref:System.Threading.Tasks.ParallelLoopResult> tamamlanmak üzere çalıştığı son yineleme gibi bilgileri depolar.</span><span class="sxs-lookup"><span data-stu-id="2ded5-137">This return value is useful when you are stopping or breaking loop iteration manually, because the <xref:System.Threading.Tasks.ParallelLoopResult> stores information such as the last iteration that ran to completion.</span></span> <span data-ttu-id="2ded5-138">Bir iş parçacığı üzerinde bir veya daha fazla özel durum oluşursa bir <xref:System.AggregateException?displayProperty=nameWithType> oluşturulur.</span><span class="sxs-lookup"><span data-stu-id="2ded5-138">If one or more exceptions occur on one of the threads, a <xref:System.AggregateException?displayProperty=nameWithType> will be thrown.</span></span>

<span data-ttu-id="2ded5-139">Bu örnekte, dönüş değeri koddaki <xref:System.Threading.Tasks.Parallel.For%2A> kullanılmaz.</span><span class="sxs-lookup"><span data-stu-id="2ded5-139">In the code in this example, the return value of <xref:System.Threading.Tasks.Parallel.For%2A> is not used.</span></span>

## <a name="analysis-and-performance"></a><span data-ttu-id="2ded5-140">Analiz ve performans</span><span class="sxs-lookup"><span data-stu-id="2ded5-140">Analysis and Performance</span></span>

<span data-ttu-id="2ded5-141">Performans Sihirbazı, bilgisayarınızda CPU kullanımı görüntülemek için kullanabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="2ded5-141">You can use the Performance Wizard to view CPU usage on your computer.</span></span> <span data-ttu-id="2ded5-142">Bir deney sütun ve matrislerde satır sayısını artırın.</span><span class="sxs-lookup"><span data-stu-id="2ded5-142">As an experiment, increase the number of columns and rows in the matrices.</span></span> <span data-ttu-id="2ded5-143">Daha büyük matrisler, hesaplama paralel ve sıralı sürümleri arasında büyük performans farkı.</span><span class="sxs-lookup"><span data-stu-id="2ded5-143">The larger the matrices, the greater the performance difference between the parallel and sequential versions of the computation.</span></span> <span data-ttu-id="2ded5-144">Matris küçük olduğunda, paralel bir döngüden ayarlama yükü nedeniyle sıralı sürümü daha hızlı çalışır.</span><span class="sxs-lookup"><span data-stu-id="2ded5-144">When the matrix is small, the sequential version will run faster because of the overhead in setting up the parallel loop.</span></span>

<span data-ttu-id="2ded5-145">Zaman uyumlu çağrılar, konsol veya dosya sistemi gibi paylaşılan kaynaklar için önemli ölçüde paralel bir döngüden performansını bozar.</span><span class="sxs-lookup"><span data-stu-id="2ded5-145">Synchronous calls to shared resources, like the Console or the File System, will significantly degrade the performance of a parallel loop.</span></span> <span data-ttu-id="2ded5-146">Performansı ölçmek, çağrıları gibi kaçınmaya çalışın <xref:System.Console.WriteLine%2A?displayProperty=nameWithType> döngü içinde.</span><span class="sxs-lookup"><span data-stu-id="2ded5-146">When measuring performance, try to avoid calls such as <xref:System.Console.WriteLine%2A?displayProperty=nameWithType> within the loop.</span></span>

## <a name="compile-the-code"></a><span data-ttu-id="2ded5-147">Kod derleme</span><span class="sxs-lookup"><span data-stu-id="2ded5-147">Compile the Code</span></span>

<span data-ttu-id="2ded5-148">Kopyalayın ve bu kod bir Visual Studio projesine yapıştırın.</span><span class="sxs-lookup"><span data-stu-id="2ded5-148">Copy and paste this code into a Visual Studio project.</span></span>

## <a name="see-also"></a><span data-ttu-id="2ded5-149">Ayrıca bkz.</span><span class="sxs-lookup"><span data-stu-id="2ded5-149">See also</span></span>

- <xref:System.Threading.Tasks.Parallel.For%2A>
- <xref:System.Threading.Tasks.Parallel.ForEach%2A>
- [<span data-ttu-id="2ded5-150">Veri Paralelliği</span><span class="sxs-lookup"><span data-stu-id="2ded5-150">Data Parallelism</span></span>](../../../docs/standard/parallel-programming/data-parallelism-task-parallel-library.md)
- [<span data-ttu-id="2ded5-151">Paralel Programlama</span><span class="sxs-lookup"><span data-stu-id="2ded5-151">Parallel Programming</span></span>](../../../docs/standard/parallel-programming/index.md)
