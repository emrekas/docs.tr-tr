---
title: Yönetilen İş Parçacıklarında İptal
ms.date: 03/30/2017
ms.technology: dotnet-standard
dev_langs:
- csharp
- vb
helpviewer_keywords:
- cancellation in .NET, overview
ms.assetid: eea11fe5-d8b0-4314-bb5d-8a58166fb1c3
author: rpetrusha
ms.author: ronpet
ms.openlocfilehash: d0776db4d045a8e52521859b9126583558bc5b51
ms.sourcegitcommit: c7a7e1468bf0fa7f7065de951d60dfc8d5ba89f5
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 05/14/2019
ms.locfileid: "65586378"
---
# <a name="cancellation-in-managed-threads"></a><span data-ttu-id="9d5c9-102">Yönetilen İş Parçacıklarında İptal</span><span class="sxs-lookup"><span data-stu-id="9d5c9-102">Cancellation in Managed Threads</span></span>
<span data-ttu-id="9d5c9-103">İle başlayarak [!INCLUDE[net_v40_long](../../../includes/net-v40-long-md.md)], .NET Framework, ortak iptali zaman uyumsuz veya uzun süre çalışan zaman uyumlu işlemler için birleşik bir modeli kullanır.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-103">Starting with the [!INCLUDE[net_v40_long](../../../includes/net-v40-long-md.md)], the .NET Framework uses a unified model for cooperative cancellation of asynchronous or long-running synchronous operations.</span></span> <span data-ttu-id="9d5c9-104">Bu model, bir iptal belirteci adlı basit bir nesne üzerinde temel alır.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-104">This model is based on a lightweight object called a cancellation token.</span></span> <span data-ttu-id="9d5c9-105">Yeni iş parçacıkları veya görevleri oluşturarak iptal edilebilir işlemleri, bir veya daha fazla örneğin çağıran nesnesi belirteç her işlem için iletir.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-105">The object that invokes one or more cancelable operations, for example by creating new threads or tasks, passes the token to each operation.</span></span> <span data-ttu-id="9d5c9-106">Tek işlemler, diğer işlemler için belirteç kopyalarını sırayla geçirebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-106">Individual operations can in turn pass copies of the token to other operations.</span></span> <span data-ttu-id="9d5c9-107">Bazı daha sonraki bir zamanda belirteci oluşturan nesnesini bu işlemler neler yaptıklarını durdurma isteği için kullanabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-107">At some later time, the object that created the token can use it to request that the operations stop what they are doing.</span></span> <span data-ttu-id="9d5c9-108">İstekte bulunan nesne yalnızca iptal isteği gönderebilir ve her dinleyici isteği fark ve uygun ve hızlı bir şekilde yanıt sorumludur.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-108">Only the requesting object can issue the cancellation request, and each listener is responsible for noticing the request and responding to it in an appropriate and timely manner.</span></span>  
  
 <span data-ttu-id="9d5c9-109">Ortak iptali modeli uygulamada genel düzen şöyledir:</span><span class="sxs-lookup"><span data-stu-id="9d5c9-109">The general pattern for implementing the cooperative cancellation model is:</span></span>  
  
- <span data-ttu-id="9d5c9-110">Örneği bir <xref:System.Threading.CancellationTokenSource> nesne yöneten ve tek tek iptal belirteçleri iptal bildirimi gönderir.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-110">Instantiate a <xref:System.Threading.CancellationTokenSource> object, which manages and sends cancellation notification to the individual cancellation tokens.</span></span>  
  
- <span data-ttu-id="9d5c9-111">Tarafından döndürülen belirtecin geçip <xref:System.Threading.CancellationTokenSource.Token%2A?displayProperty=nameWithType> her görev veya iptal için bekleyen iş parçacığı özelliği.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-111">Pass the token returned by the <xref:System.Threading.CancellationTokenSource.Token%2A?displayProperty=nameWithType> property to each task or thread that listens for cancellation.</span></span>  
  
- <span data-ttu-id="9d5c9-112">Her görev veya iptal için yanıt vermek için iş parçacığı için bir mekanizma sağlar.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-112">Provide a mechanism for each task or thread to respond to cancellation.</span></span>  
  
- <span data-ttu-id="9d5c9-113">Çağrı <xref:System.Threading.CancellationTokenSource.Cancel%2A?displayProperty=nameWithType> iptal bildirim sağlamak için yöntemi.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-113">Call the <xref:System.Threading.CancellationTokenSource.Cancel%2A?displayProperty=nameWithType> method to provide notification of cancellation.</span></span>  
  
> [!IMPORTANT]
>  <span data-ttu-id="9d5c9-114"><xref:System.Threading.CancellationTokenSource> Sınıfının Implements <xref:System.IDisposable> arabirimi.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-114">The <xref:System.Threading.CancellationTokenSource> class implements the <xref:System.IDisposable> interface.</span></span> <span data-ttu-id="9d5c9-115">Çağırdığınızdan emin olmalıdır <xref:System.Threading.CancellationTokenSource.Dispose%2A?displayProperty=nameWithType> iptal belirteci kaynağı, tüm ücretsiz kullanmayı bitirdiğinizde yöntemi yönetilmeyen kaynakları da tutar.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-115">You should be sure to call the <xref:System.Threading.CancellationTokenSource.Dispose%2A?displayProperty=nameWithType> method when you have finished using the cancellation token source to free any unmanaged resources it holds.</span></span>  
  
 <span data-ttu-id="9d5c9-116">Aşağıdaki çizimde, bir belirteç kaynağı ve onun belirteç tüm kopyalarını arasındaki ilişkiyi gösterir.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-116">The following illustration shows the relationship between a token source and all the copies of its token.</span></span>  
  
 <span data-ttu-id="9d5c9-117">![CancellationTokenSource ve iptal belirteçlerini](../../../docs/standard/threading/media/vs-cancellationtoken.png "VS_CancellationToken")</span><span class="sxs-lookup"><span data-stu-id="9d5c9-117">![CancellationTokenSource and cancellation tokens](../../../docs/standard/threading/media/vs-cancellationtoken.png "VS_CancellationToken")</span></span>  
  
 <span data-ttu-id="9d5c9-118">Yeni iptal etme modeli iptal algılayan uygulamaları ve kitaplıkları oluşturmak kolaylaştırır ve aşağıdaki özellikleri destekler:</span><span class="sxs-lookup"><span data-stu-id="9d5c9-118">The new cancellation model makes it easier to create cancellation-aware applications and libraries, and it supports the following features:</span></span>  
  
- <span data-ttu-id="9d5c9-119">İptali ortaktır ve Dinleyicide zorunlu değildir.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-119">Cancellation is cooperative and is not forced on the listener.</span></span> <span data-ttu-id="9d5c9-120">Dinleyici düzgün bir şekilde bir iptal isteğine yanıt olarak sonlandırmak nasıl belirler.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-120">The listener determines how to gracefully terminate in response to a cancellation request.</span></span>  
  
- <span data-ttu-id="9d5c9-121">İsteyen dinleme yapması farklıdır.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-121">Requesting is distinct from listening.</span></span> <span data-ttu-id="9d5c9-122">İptal edilebilir bir işlem çağıran bir nesne, ne zaman (Şimdiye kadar değilse) İptal işlemi istendikten kontrol edebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-122">An object that invokes a cancelable operation can control when (if ever) cancellation is requested.</span></span>  
  
- <span data-ttu-id="9d5c9-123">İstenen nesne, yalnızca bir yöntem çağrısı kullanarak belirteç tüm kopyalarını iptal isteğini verir.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-123">The requesting object issues the cancellation request to all copies of the token by using just one method call.</span></span>  
  
- <span data-ttu-id="9d5c9-124">Dinleyici için birden çok belirteç aynı anda bunları birine katılarak dinleyebilirsiniz *bağlı belirteci*.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-124">A listener can listen to multiple tokens simultaneously by joining them into one *linked token*.</span></span>  
  
- <span data-ttu-id="9d5c9-125">Kullanıcı kodu dikkat edin ve kitaplık koddan iptal isteklerini yanıtlamasını ve kitaplık kodu dikkat edin ve kullanıcı kodundan iptal isteklerini yanıtlamasını.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-125">User code can notice and respond to cancellation requests from library code, and library code can notice and respond to cancellation requests from user code.</span></span>  
  
- <span data-ttu-id="9d5c9-126">Dinleyiciler, yoklama, geri çağırma kaydı ya da bekleme tanıtıcıları üzerinde bekleyen iptal isteklerini bildirilebilir.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-126">Listeners can be notified of cancellation requests by polling, callback registration, or waiting on wait handles.</span></span>  
  
## <a name="cancellation-types"></a><span data-ttu-id="9d5c9-127">İptal türleri</span><span class="sxs-lookup"><span data-stu-id="9d5c9-127">Cancellation Types</span></span>  
 <span data-ttu-id="9d5c9-128">İptal framework, aşağıdaki tabloda listelenen ilgili türleri kümesi olarak uygulanır.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-128">The cancellation framework is implemented as a set of related types, which are listed in the following table.</span></span>  
  
|<span data-ttu-id="9d5c9-129">Tür adı</span><span class="sxs-lookup"><span data-stu-id="9d5c9-129">Type name</span></span>|<span data-ttu-id="9d5c9-130">Açıklama</span><span class="sxs-lookup"><span data-stu-id="9d5c9-130">Description</span></span>|  
|---------------|-----------------|  
|<xref:System.Threading.CancellationTokenSource>|<span data-ttu-id="9d5c9-131">Bir iptal belirteci oluşturur ve ayrıca o belirteç tüm kopyalarını iptal isteği yayınlar nesne.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-131">Object that creates a cancellation token, and also issues the cancellation request for all copies of that token.</span></span>|  
|<xref:System.Threading.CancellationToken>|<span data-ttu-id="9d5c9-132">Basit değer türü, bir veya daha fazla dinleyici, genellikle bir yöntem parametresi olarak geçirildi.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-132">Lightweight value type passed to one or more listeners, typically as a method parameter.</span></span> <span data-ttu-id="9d5c9-133">Dinleyicileri izleme değerini `IsCancellationRequested` yoklama, geri çağırma ve bekleme tanıtıcısı tarafından belirteç özelliği.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-133">Listeners monitor the value of the `IsCancellationRequested` property of the token by polling, callback, or wait handle.</span></span>|  
|<xref:System.OperationCanceledException>|<span data-ttu-id="9d5c9-134">Bu özel durumun oluşturucusunu aşırı kabul bir <xref:System.Threading.CancellationToken> bir parametre olarak.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-134">Overloads of this exception's constructor accept a <xref:System.Threading.CancellationToken> as a parameter.</span></span> <span data-ttu-id="9d5c9-135">Dinleyicileri isteğe bağlı olarak iptal nedeni doğrulamak ve diğerlerinin bir iptal isteğine yanıt verdi bildirmek için bu durum oluşturabilir.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-135">Listeners can optionally throw this exception to verify the source of the cancellation and notify others that it has responded to a cancellation request.</span></span>|  
  
 <span data-ttu-id="9d5c9-136">Yeni iptal etme modeli, birden fazla .NET Framework içine tümleştirilmiştir.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-136">The new cancellation model is integrated into the .NET Framework in several types.</span></span> <span data-ttu-id="9d5c9-137">En önemli olanlardır <xref:System.Threading.Tasks.Parallel?displayProperty=nameWithType>, <xref:System.Threading.Tasks.Task?displayProperty=nameWithType>, <xref:System.Threading.Tasks.Task%601?displayProperty=nameWithType> ve <xref:System.Linq.ParallelEnumerable?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-137">The most important ones are <xref:System.Threading.Tasks.Parallel?displayProperty=nameWithType>, <xref:System.Threading.Tasks.Task?displayProperty=nameWithType>, <xref:System.Threading.Tasks.Task%601?displayProperty=nameWithType> and <xref:System.Linq.ParallelEnumerable?displayProperty=nameWithType>.</span></span> <span data-ttu-id="9d5c9-138">Bu yeni iptal etme modeli için tüm yeni kitaplık ve uygulama kodu kullanmanızı öneririz.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-138">We recommend that you use this new cancellation model for all new library and application code.</span></span>  
  
## <a name="code-example"></a><span data-ttu-id="9d5c9-139">Kod Örneği</span><span class="sxs-lookup"><span data-stu-id="9d5c9-139">Code Example</span></span>  
 <span data-ttu-id="9d5c9-140">Aşağıdaki örnekte, istekte bulunan nesneyi oluşturur bir <xref:System.Threading.CancellationTokenSource> nesne ve geçişleri kendi <xref:System.Threading.CancellationTokenSource.Token%2A> iptal edilebilir işleme özelliği.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-140">In the following example, the requesting object creates a <xref:System.Threading.CancellationTokenSource> object, and then passes its <xref:System.Threading.CancellationTokenSource.Token%2A> property to the cancelable operation.</span></span> <span data-ttu-id="9d5c9-141">İsteği aldığında işlemi değerini izler <xref:System.Threading.CancellationToken.IsCancellationRequested%2A> yoklama belirteç özelliği.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-141">The operation that receives the request monitors the value of the <xref:System.Threading.CancellationToken.IsCancellationRequested%2A> property of the token by polling.</span></span> <span data-ttu-id="9d5c9-142">Değer olduğunda `true`, uygun herhangi bir şekilde dinleyicinin sonlandırabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-142">When the value becomes `true`, the listener can terminate in whatever manner is appropriate.</span></span> <span data-ttu-id="9d5c9-143">Bu örnekte, yöntem yalnızca, çoğu durumda gerekli olduğu çıkar.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-143">In this example, the method just exits, which is all that is required in many cases.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="9d5c9-144">Örnekte <xref:System.Threading.ThreadPool.QueueUserWorkItem%2A> yeni iptalini çerçevesi eski API'leri ile uyumlu olduğunu göstermek için yöntemi.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-144">The example uses the <xref:System.Threading.ThreadPool.QueueUserWorkItem%2A> method to demonstrate that the new cancellation framework is compatible with legacy APIs.</span></span> <span data-ttu-id="9d5c9-145">Yeni kullanan bir örnek için tercih edilen <xref:System.Threading.Tasks.Task?displayProperty=nameWithType> yazın, bkz: [nasıl yapılır: Bir görevi ve alt öğelerini iptal](../../../docs/standard/parallel-programming/how-to-cancel-a-task-and-its-children.md).</span><span class="sxs-lookup"><span data-stu-id="9d5c9-145">For an example that uses the new, preferred <xref:System.Threading.Tasks.Task?displayProperty=nameWithType> type, see [How to: Cancel a Task and Its Children](../../../docs/standard/parallel-programming/how-to-cancel-a-task-and-its-children.md).</span></span>  
  
 [!code-csharp[Cancellation#1](../../../samples/snippets/csharp/VS_Snippets_Misc/cancellation/cs/cancellationex1.cs#1)]
 [!code-vb[Cancellation#1](../../../samples/snippets/visualbasic/VS_Snippets_Misc/cancellation/vb/cancellationex1.vb#1)]  
  
## <a name="operation-cancellation-versus-object-cancellation"></a><span data-ttu-id="9d5c9-146">İşlemi iptal nesnesi iptal karşılaştırması</span><span class="sxs-lookup"><span data-stu-id="9d5c9-146">Operation Cancellation Versus Object Cancellation</span></span>  
 <span data-ttu-id="9d5c9-147">Yeni iptal Framework'te İptal işlemleri, nesneleri gösterir.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-147">In the new cancellation framework, cancellation refers to operations, not objects.</span></span> <span data-ttu-id="9d5c9-148">İptal isteği, gerekli tüm temizleme işlemlerini gerçekleştirdikten sonra işlemi olabildiğince çabuk durması gerektiğini anlamına gelir.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-148">The cancellation request means that the operation should stop as soon as possible after any required cleanup is performed.</span></span> <span data-ttu-id="9d5c9-149">Bu işlem, programınızda uygulanabilir ancak bir iptal belirteci bir "iptal edilebilir işlemine," başvurmanız gerekir.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-149">One cancellation token should refer to one "cancelable operation," however that operation may be implemented in your program.</span></span> <span data-ttu-id="9d5c9-150">Sonra <xref:System.Threading.CancellationToken.IsCancellationRequested%2A> özelliği belirtecin sınıflandırmalara ayarlandığı `true`, için sıfırlanamaz `false`.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-150">After the <xref:System.Threading.CancellationToken.IsCancellationRequested%2A> property of the token has been set to `true`, it cannot be reset to `false`.</span></span> <span data-ttu-id="9d5c9-151">Bu nedenle, iptal belirteçlerini iptal edildikten sonra kullanılamayacak.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-151">Therefore, cancellation tokens cannot be reused after they have been canceled.</span></span>  
  
 <span data-ttu-id="9d5c9-152">Bir nesne iptal mekanizması ihtiyacınız varsa, bu işlemi iptal mekanizması hakkında çağırarak dayandırabilirsiniz <xref:System.Threading.CancellationToken.Register%2A?displayProperty=nameWithType> yöntemi, aşağıdaki örnekte gösterildiği gibi.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-152">If you require an object cancellation mechanism, you can base it on the operation cancellation mechanism by calling the <xref:System.Threading.CancellationToken.Register%2A?displayProperty=nameWithType> method, as shown in the following example.</span></span>  
  
 [!code-csharp[Cancellation#2](../../../samples/snippets/csharp/VS_Snippets_Misc/cancellation/cs/objectcancellation1.cs#2)]
 [!code-vb[Cancellation#2](../../../samples/snippets/visualbasic/VS_Snippets_Misc/cancellation/vb/objectcancellation1.vb#2)]  
  
 <span data-ttu-id="9d5c9-153">Bir nesne birden fazla eş zamanlı iptal edilebilir işlemi destekliyorsa, ayrı bir belirteç, her ayrı iptal edilebilir işlemi için giriş olarak geçirin.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-153">If an object supports more than one concurrent cancelable operation, pass a separate token as input to each distinct cancelable operation.</span></span> <span data-ttu-id="9d5c9-154">Bu şekilde, tek bir işlem diğerlerini etkilemeden iptal edilebilir.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-154">That way, one operation can be cancelled without affecting the others.</span></span>  
  
## <a name="listening-and-responding-to-cancellation-requests"></a><span data-ttu-id="9d5c9-155">Dinleme ve iptal isteklerini yanıtlama</span><span class="sxs-lookup"><span data-stu-id="9d5c9-155">Listening and Responding to Cancellation Requests</span></span>  
 <span data-ttu-id="9d5c9-156">Kullanıcı temsilcisiyle iptal edilebilir bir işlemin uygulayan bir iptal isteğine yanıt olarak bir işlemi sonlandırmak nasıl belirler.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-156">In the user delegate, the implementer of a cancelable operation determines how to terminate the operation in response to a cancellation request.</span></span> <span data-ttu-id="9d5c9-157">Çoğu durumda, kullanıcı temsilcisi yalnızca gerekli tüm temizleme işlemlerini gerçekleştirmek ve hemen döndürür.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-157">In many cases, the user delegate can just perform any required cleanup and then return immediately.</span></span>  
  
 <span data-ttu-id="9d5c9-158">Ancak, daha karmaşık durumlarda, kullanıcı temsilcisi iptali oluştu kitaplık kodu bildirmek gerekli olabilir.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-158">However, in more complex cases, it might be necessary for the user delegate to notify library code that cancellation has occurred.</span></span> <span data-ttu-id="9d5c9-159">Bu gibi durumlarda, işlemi sonlandırmak için doğru şekilde çağrılacak temsilci için olan <xref:System.Threading.CancellationToken.ThrowIfCancellationRequested%2A>, neden olacak yöntemi bir <xref:System.OperationCanceledException> oluşturulması için.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-159">In such cases, the correct way to terminate the operation is for the delegate to call the <xref:System.Threading.CancellationToken.ThrowIfCancellationRequested%2A>, method, which will cause an <xref:System.OperationCanceledException> to be thrown.</span></span> <span data-ttu-id="9d5c9-160">Kitaplık kodu, bu özel durum kullanıcı temsilcisi iş parçacığı üzerinde catch ve özel durumun ortak iptali veya diğer bir olağanüstü durum belirtir olup olmadığını belirlemek için özel durumun belirteci inceleyin.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-160">Library code can catch this exception on the user delegate thread and examine the exception's token to determine whether the exception indicates cooperative cancellation or some other exceptional situation.</span></span>  
  
 <span data-ttu-id="9d5c9-161"><xref:System.Threading.Tasks.Task> Sınıfı tanıtıcıları <xref:System.OperationCanceledException> bu şekilde.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-161">The <xref:System.Threading.Tasks.Task> class handles <xref:System.OperationCanceledException> in this way.</span></span> <span data-ttu-id="9d5c9-162">Daha fazla bilgi için [görev iptali](../../../docs/standard/parallel-programming/task-cancellation.md).</span><span class="sxs-lookup"><span data-stu-id="9d5c9-162">For more information, see [Task Cancellation](../../../docs/standard/parallel-programming/task-cancellation.md).</span></span>  
  
### <a name="listening-by-polling"></a><span data-ttu-id="9d5c9-163">Yoklama tarafından dinleme</span><span class="sxs-lookup"><span data-stu-id="9d5c9-163">Listening by Polling</span></span>  
 <span data-ttu-id="9d5c9-164">Uzun süre çalışan hesaplamalar için söz konusu döngü veya recurse, sizin için bir iptal isteğine değerini düzenli yoklayarak dinleyebilirsiniz <xref:System.Threading.CancellationToken.IsCancellationRequested%2A?displayProperty=nameWithType> özelliği.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-164">For long-running computations that loop or recurse, you can listen for a cancellation request by periodically polling the value of the <xref:System.Threading.CancellationToken.IsCancellationRequested%2A?displayProperty=nameWithType> property.</span></span> <span data-ttu-id="9d5c9-165">Öğenin değeri ise `true`, yöntem temizlemek ve mümkün olan en kısa sürede sonlandır.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-165">If its value is `true`, the method should clean up and terminate as quickly as possible.</span></span> <span data-ttu-id="9d5c9-166">Yoklama sıklığı en iyi uygulama türüne bağlıdır.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-166">The optimal frequency of polling depends on the type of application.</span></span> <span data-ttu-id="9d5c9-167">Bu, geliştirici yoklama sıklığı herhangi belirli bir programı için en iyi şekilde belirlemek için en fazla olur.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-167">It is up to the developer to determine the best polling frequency for any given program.</span></span> <span data-ttu-id="9d5c9-168">Kendisini yoklama performansı önemli ölçüde etkilemez.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-168">Polling itself does not significantly impact performance.</span></span> <span data-ttu-id="9d5c9-169">Aşağıdaki örnek yoklamak için olası yollarından biri gösterilmektedir.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-169">The following example shows one possible way to poll.</span></span>  
  
 [!code-csharp[Cancellation#3](../../../samples/snippets/csharp/VS_Snippets_Misc/cancellation/cs/cancellationex11.cs#3)]
 [!code-vb[Cancellation#3](../../../samples/snippets/visualbasic/VS_Snippets_Misc/cancellation/vb/cancellationex11.vb#3)]  
  
 <span data-ttu-id="9d5c9-170">Daha eksiksiz bir örnek için bkz: [nasıl yapılır: Yoklama ile iptal isteklerini dinleme](../../../docs/standard/threading/how-to-listen-for-cancellation-requests-by-polling.md).</span><span class="sxs-lookup"><span data-stu-id="9d5c9-170">For a more complete example, see [How to: Listen for Cancellation Requests by Polling](../../../docs/standard/threading/how-to-listen-for-cancellation-requests-by-polling.md).</span></span>  
  
### <a name="listening-by-registering-a-callback"></a><span data-ttu-id="9d5c9-171">Bir geri çağırma kaydederek dinleme</span><span class="sxs-lookup"><span data-stu-id="9d5c9-171">Listening by Registering a Callback</span></span>  
 <span data-ttu-id="9d5c9-172">Bazı işlemler, iptal belirteci değeri zamanında denetleyemiyor şekilde engellenmiş olur.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-172">Some operations can become blocked in such a way that they cannot check the value of the cancellation token in a timely manner.</span></span> <span data-ttu-id="9d5c9-173">Bu durumlarda, bir iptal isteğine alındığında, yöntem engellemesinin kaldırıldığı bir geri çağırma yöntemi kaydedebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-173">For these cases, you can register a callback method that unblocks the method when a cancellation request is received.</span></span>  
  
 <span data-ttu-id="9d5c9-174"><xref:System.Threading.CancellationToken.Register%2A> Yöntemi döndürür bir <xref:System.Threading.CancellationTokenRegistration> özellikle bu amaç için kullanılan nesne.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-174">The <xref:System.Threading.CancellationToken.Register%2A> method returns a <xref:System.Threading.CancellationTokenRegistration> object that is used specifically for this purpose.</span></span> <span data-ttu-id="9d5c9-175">Aşağıdaki örnek nasıl kullanılacağını gösterir <xref:System.Threading.CancellationToken.Register%2A> zaman uyumsuz bir Web isteği iptal etmek için yöntemi.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-175">The following example shows how to use the <xref:System.Threading.CancellationToken.Register%2A> method to cancel an asynchronous Web request.</span></span>  
  
 [!code-csharp[Cancellation#4](../../../samples/snippets/csharp/VS_Snippets_Misc/cancellation/cs/cancellationex4.cs#4)]
 [!code-vb[Cancellation#4](../../../samples/snippets/visualbasic/VS_Snippets_Misc/cancellation/vb/cancellationex4.vb#4)]  
  
 <span data-ttu-id="9d5c9-176"><xref:System.Threading.CancellationTokenRegistration> Nesne iş parçacığı eşitleme yönetir ve zaman içinde kesin bir noktada yürütme geri çağırma durdurur sağlar.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-176">The <xref:System.Threading.CancellationTokenRegistration> object manages thread synchronization and ensures that the callback will stop executing at a precise point in time.</span></span>  
  
 <span data-ttu-id="9d5c9-177">Sistem yanıt hızını sağlamak üzere ve kilitlenmeleri önlemek için aşağıdaki yönergeleri geri çağırmaları kaydederken gelmelidir:</span><span class="sxs-lookup"><span data-stu-id="9d5c9-177">In order to ensure system responsiveness and to avoid deadlocks, the following guidelines must be followed when registering callbacks:</span></span>  
  
- <span data-ttu-id="9d5c9-178">Zaman uyumlu ve bu nedenle çağrısı adlandırılır çünkü geri çağırma yöntemi hızlı olmalıdır <xref:System.Threading.CancellationTokenSource.Cancel%2A> geri dönene kadar döndürmez.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-178">The callback method should be fast because it is called synchronously and therefore the call to <xref:System.Threading.CancellationTokenSource.Cancel%2A> does not return until the callback returns.</span></span>  
  
- <span data-ttu-id="9d5c9-179">Eğer <xref:System.Threading.CancellationTokenRegistration.Dispose%2A> geri çağırma çalıştığından ve geri çağırma bekleyen bir kilidi tutan sırada programınızı kilitlenme.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-179">If you call <xref:System.Threading.CancellationTokenRegistration.Dispose%2A> while the callback is running, and you hold a lock that the callback is waiting on, your program can deadlock.</span></span> <span data-ttu-id="9d5c9-180">Sonra `Dispose` döndüren geri çağırma tarafından gerekli tüm kaynakları serbest bırakabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-180">After `Dispose` returns, you can free any resources required by the callback.</span></span>  
  
- <span data-ttu-id="9d5c9-181">Geri çağırmaları el ile herhangi bir iş parçacığı değil gerçekleştirmesi gereken veya <xref:System.Threading.SynchronizationContext> kullanımı bir geri çağırma.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-181">Callbacks should not perform any manual thread or <xref:System.Threading.SynchronizationContext> usage in a callback.</span></span> <span data-ttu-id="9d5c9-182">Bir geri çağırma belirli bir iş parçacığı üzerinde çalışması gerekiyorsa kullanın <xref:System.Threading.CancellationTokenRegistration?displayProperty=nameWithType> hedef syncContext, belirtmenize olanak tanıyan Oluşturucusu olan etkin <xref:System.Threading.SynchronizationContext.Current%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-182">If a callback must run on a particular thread, use the <xref:System.Threading.CancellationTokenRegistration?displayProperty=nameWithType> constructor that enables you to specify that the target syncContext is the active <xref:System.Threading.SynchronizationContext.Current%2A?displayProperty=nameWithType>.</span></span> <span data-ttu-id="9d5c9-183">El ile bir geri çağırma iş parçacığı gerçekleştirme kilitlenmeye neden olabilir.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-183">Performing manual threading in a callback can cause deadlock.</span></span>  
  
 <span data-ttu-id="9d5c9-184">Daha eksiksiz bir örnek için bkz: [nasıl yapılır: İptal isteklerini geri aramaları kaydetme](../../../docs/standard/threading/how-to-register-callbacks-for-cancellation-requests.md).</span><span class="sxs-lookup"><span data-stu-id="9d5c9-184">For a more complete example, see [How to: Register Callbacks for Cancellation Requests](../../../docs/standard/threading/how-to-register-callbacks-for-cancellation-requests.md).</span></span>  
  
### <a name="listening-by-using-a-wait-handle"></a><span data-ttu-id="9d5c9-185">Bekleme tanıtıcısı kullanarak dinleme</span><span class="sxs-lookup"><span data-stu-id="9d5c9-185">Listening by Using a Wait Handle</span></span>  
 <span data-ttu-id="9d5c9-186">İptal edilebilir bir işlemi engelliyken eşitleme gibi basit beklerken bir <xref:System.Threading.ManualResetEvent?displayProperty=nameWithType> veya <xref:System.Threading.Semaphore?displayProperty=nameWithType>, kullanabileceğiniz <xref:System.Threading.CancellationToken.WaitHandle%2A?displayProperty=nameWithType> olay hem iptal isteğini beklemeye işlemi etkinleştirmek için özelliği.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-186">When a cancelable operation can block while it waits on a synchronization primitive such as a <xref:System.Threading.ManualResetEvent?displayProperty=nameWithType> or <xref:System.Threading.Semaphore?displayProperty=nameWithType>, you can use the <xref:System.Threading.CancellationToken.WaitHandle%2A?displayProperty=nameWithType> property to enable the operation to wait on both the event and the cancellation request.</span></span> <span data-ttu-id="9d5c9-187">İptal belirteci bekleme tanıtıcısı bir iptal isteğine yanıt olarak sinyal haline ve yöntemin dönüş değerini kullanabilirsiniz <xref:System.Threading.WaitHandle.WaitAny%2A> işareti belirteç iptal olup olmadığını belirlemek için yöntemi.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-187">The wait handle of the cancellation token will become signaled in response to a cancellation request, and the method can use the return value of the <xref:System.Threading.WaitHandle.WaitAny%2A> method to determine whether it was the cancellation token that signaled.</span></span> <span data-ttu-id="9d5c9-188">İşlemi daha sonra yalnızca çıkış throw veya bir <xref:System.OperationCanceledException>uygun şekilde.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-188">The operation can then just exit, or throw a <xref:System.OperationCanceledException>, as appropriate.</span></span>  
  
 [!code-csharp[Cancellation#5](../../../samples/snippets/csharp/VS_Snippets_Misc/cancellation/cs/cancellationex9.cs#5)]
 [!code-vb[Cancellation#5](../../../samples/snippets/visualbasic/VS_Snippets_Misc/cancellation/vb/cancellationex9.vb#5)]  
  
 <span data-ttu-id="9d5c9-189">Hedefleyen yeni kodda [!INCLUDE[net_v40_long](../../../includes/net-v40-long-md.md)], <xref:System.Threading.ManualResetEventSlim?displayProperty=nameWithType> ve <xref:System.Threading.SemaphoreSlim?displayProperty=nameWithType> hem de yeni iptal framework desteği, `Wait` yöntemleri.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-189">In new code that targets the [!INCLUDE[net_v40_long](../../../includes/net-v40-long-md.md)], <xref:System.Threading.ManualResetEventSlim?displayProperty=nameWithType> and <xref:System.Threading.SemaphoreSlim?displayProperty=nameWithType> both support the new cancellation framework in their `Wait` methods.</span></span> <span data-ttu-id="9d5c9-190">Geçirebilirsiniz <xref:System.Threading.CancellationToken> yöntemine İptal işlemi istendikten sonra olay uyanır ve oluşturur ve bir <xref:System.OperationCanceledException>.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-190">You can pass the <xref:System.Threading.CancellationToken> to the method, and when the cancellation is requested, the event wakes up and throws an <xref:System.OperationCanceledException>.</span></span>  
  
 [!code-csharp[Cancellation#6](../../../samples/snippets/csharp/VS_Snippets_Misc/cancellation/cs/cancellationex10.cs#6)]
 [!code-vb[Cancellation#6](../../../samples/snippets/visualbasic/VS_Snippets_Misc/cancellation/vb/cancellationex10.vb#6)]  
  
 <span data-ttu-id="9d5c9-191">Daha eksiksiz bir örnek için bkz: [nasıl yapılır: Bekleme tanıtıcıları içeren iptal isteklerini dinleme](../../../docs/standard/threading/how-to-listen-for-cancellation-requests-that-have-wait-handles.md).</span><span class="sxs-lookup"><span data-stu-id="9d5c9-191">For a more complete example, see [How to: Listen for Cancellation Requests That Have Wait Handles](../../../docs/standard/threading/how-to-listen-for-cancellation-requests-that-have-wait-handles.md).</span></span>  
  
### <a name="listening-to-multiple-tokens-simultaneously"></a><span data-ttu-id="9d5c9-192">Aynı anda birden çok belirteç için dinleme</span><span class="sxs-lookup"><span data-stu-id="9d5c9-192">Listening to Multiple Tokens Simultaneously</span></span>  
 <span data-ttu-id="9d5c9-193">Bazı durumlarda, aynı anda birden çok iptal belirteçleri dinlemek bir dinleyici olabilir.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-193">In some cases, a listener may have to listen to multiple cancellation tokens simultaneously.</span></span> <span data-ttu-id="9d5c9-194">Örneğin, iptal edilebilir bir işlemi bir iç iptal belirteci bir belirteç dışarıdan bağımsız değişken olarak bir yöntem parametresi için geçirilen ek olarak izlemek zorunda kalabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-194">For example, a cancelable operation may have to monitor an internal cancellation token in addition to a token passed in externally as an argument to a method parameter.</span></span> <span data-ttu-id="9d5c9-195">Bunu yapmak için aşağıdaki örnekte gösterildiği gibi iki veya daha fazla belirteç bir belirteç katılabilir bağlantılı bir belirteç kaynağı oluşturun.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-195">To accomplish this, create a linked token source that can join two or more tokens into one token, as shown in the following example.</span></span>  
  
 [!code-csharp[Cancellation#7](../../../samples/snippets/csharp/VS_Snippets_Misc/cancellation/cs/cancellationex13.cs#7)]
 [!code-vb[Cancellation#7](../../../samples/snippets/visualbasic/VS_Snippets_Misc/cancellation/vb/cancellationex13.vb#7)]  
  
 <span data-ttu-id="9d5c9-196">Çağırmalısınız bildirimi `Dispose` ile işiniz bittiğinde bağlı belirteç kaynağı.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-196">Notice that you must call `Dispose` on the linked token source when you are done with it.</span></span> <span data-ttu-id="9d5c9-197">Daha eksiksiz bir örnek için bkz: [nasıl yapılır: Birden çok iptal isteğini dinleme](../../../docs/standard/threading/how-to-listen-for-multiple-cancellation-requests.md).</span><span class="sxs-lookup"><span data-stu-id="9d5c9-197">For a more complete example, see [How to: Listen for Multiple Cancellation Requests](../../../docs/standard/threading/how-to-listen-for-multiple-cancellation-requests.md).</span></span>  
  
## <a name="cooperation-between-library-code-and-user-code"></a><span data-ttu-id="9d5c9-198">Kitaplık kodu ve kullanıcı kodu arasında işbirliği</span><span class="sxs-lookup"><span data-stu-id="9d5c9-198">Cooperation Between Library Code and User Code</span></span>  
 <span data-ttu-id="9d5c9-199">Birleşik iptalini çerçevesi, kullanıcı kodu çalışılabilir bir kitaplık kodu iptal etmek ve kullanıcı kodu iptal etmek kitaplık kodu için mümkün kılar.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-199">The unified cancellation framework makes it possible for library code to cancel user code, and for user code to cancel library code in a cooperative manner.</span></span> <span data-ttu-id="9d5c9-200">Sorunsuz bir işbirliği yaparak bu yönergeleri izleyerek her bir tarafta bağlıdır:</span><span class="sxs-lookup"><span data-stu-id="9d5c9-200">Smooth cooperation depends on each side following these guidelines:</span></span>  
  
- <span data-ttu-id="9d5c9-201">Kitaplık kodu iptal edilebilir işlemleri sağlıyorsa, bir dış iptal belirtecini kabul edin ve böylece kullanıcı kodu iptal isteğinde bulunabilirsiniz genel yöntemleri de sağlamalıdır.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-201">If library code provides cancelable operations, it should also provide public methods that accept an external cancellation token so that user code can request cancellation.</span></span>  
  
- <span data-ttu-id="9d5c9-202">Kitaplık kodu kullanıcı kodu çağırırsa, kitaplık kodu bir OperationCanceledException(externalToken) olarak yorumlamak *ortak iptali*ve bir hata özel durum olarak mutlaka.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-202">If library code calls into user code, the library code should interpret an OperationCanceledException(externalToken) as *cooperative cancellation*, and not necessarily as a failure exception.</span></span>  
  
- <span data-ttu-id="9d5c9-203">Kullanıcı temsilcilerinde iptal isteklerine kitaplığı koddan zamanında yanıt vermek denemelidir.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-203">User-delegates should attempt to respond to cancellation requests from library code in a timely manner.</span></span>  
  
 <span data-ttu-id="9d5c9-204"><xref:System.Threading.Tasks.Task?displayProperty=nameWithType> ve <xref:System.Linq.ParallelEnumerable?displayProperty=nameWithType> örnekler sınıflarının aşağıdaki yönergeleri izleyin.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-204"><xref:System.Threading.Tasks.Task?displayProperty=nameWithType> and <xref:System.Linq.ParallelEnumerable?displayProperty=nameWithType> are examples of classes that follow these guidelines.</span></span> <span data-ttu-id="9d5c9-205">Daha fazla bilgi için [görev iptali](../../../docs/standard/parallel-programming/task-cancellation.md) ve [nasıl yapılır: PLINQ sorgusunu iptal etme](../../../docs/standard/parallel-programming/how-to-cancel-a-plinq-query.md).</span><span class="sxs-lookup"><span data-stu-id="9d5c9-205">For more information, see [Task Cancellation](../../../docs/standard/parallel-programming/task-cancellation.md) and [How to: Cancel a PLINQ Query](../../../docs/standard/parallel-programming/how-to-cancel-a-plinq-query.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="9d5c9-206">Ayrıca bkz.</span><span class="sxs-lookup"><span data-stu-id="9d5c9-206">See also</span></span>

- [<span data-ttu-id="9d5c9-207">Yönetilen İş Parçacığı Oluşturma Temelleri</span><span class="sxs-lookup"><span data-stu-id="9d5c9-207">Managed Threading Basics</span></span>](../../../docs/standard/threading/managed-threading-basics.md)
